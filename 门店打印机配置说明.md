# 门店打印机配置说明

## 为什么表格是空的？

门店打印机配置表格显示的是**所有自拍机设备**的配置。如果表格显示"暂无门店配置"，说明：

1. **数据库中还没有自拍机数据**
2. 需要先添加自拍机设备，然后才能在打印配置页面看到并配置

## 配置步骤

### 第一步：添加加盟商和自拍机

#### 1.1 添加加盟商账户

1. 访问：**加盟商管理** → **添加账户**
2. 填写基本信息：
   - 公司名称
   - 联系人
   - 联系电话
   - **门店名称**（必填，例如：`厦门SM商城`）
3. 保存

#### 1.2 添加自拍机设备

1. 进入加盟商详情页面：
   - 在加盟商列表中，点击某个加盟商的"查看详情"
   - 或访问：`/admin/franchisee/accounts/{加盟商ID}`
2. 点击"自拍机设备"标签页
3. 点击"添加设备"按钮
4. 填写设备信息：
   - **设备名称**：如 `SM商城-1号机`
   - **设备序列号**：如 `XMSM_001`（必须与安卓APP配置一致）
   - **设备位置**：如 `1楼大厅`（可选）
   - **备注**：（可选）
5. 保存

#### 1.3 为多个门店添加自拍机

- 如果A店和B店是不同的加盟商，需要分别创建两个加盟商账户
- 每个加盟商账户下可以添加多台自拍机
- 每台自拍机有独立的序列号

### 第二步：配置门店打印机

1. 访问：**打印配置** 页面
2. 在"门店打印机配置"部分，现在应该能看到所有自拍机了
3. 为每个自拍机配置打印机：

   **方式一：本地部署（门店电脑直接连接打印机）**
   - 填写"本地打印机路径"：`\\sm003\HP OfficeJet Pro 7730 series`
   - 留空"打印代理服务地址"

   **方式二：远程部署（通过frp内网穿透）**
   - 留空"本地打印机路径"
   - 填写"打印代理服务地址"：`http://192.168.2.54:18888`
   - 填写"API密钥"（如果设置了）

4. 点击"保存"按钮

## 配置示例

### 场景：两个门店，每个门店一台打印机

**A店（厦门SM商城）：**
- 自拍机序列号：`XMSM_001`
- 打印机路径：`\\sm003\HP OfficeJet Pro 7730 series`
- 配置：在打印配置页面，找到 `XMSM_001`，填写本地打印机路径

**B店（北京朝阳店）：**
- 自拍机序列号：`BJSM_001`
- 打印代理服务：`http://192.168.2.54:18888`
- 配置：在打印配置页面，找到 `BJSM_001`，填写打印代理服务地址

## 工作流程

```
1. 用户在小程序下单
   ↓
2. 用户到自拍机核销（安卓APP传递自拍机序列号，如：XMSM_001）
   ↓
3. 订单自动关联到自拍机（order.selfie_machine_id = XMSM_001）
   ↓
4. 用户选片完成，点击打印
   ↓
5. 系统根据 order.selfie_machine_id 查找对应的打印机配置
   ↓
6. 如果找到配置，使用门店配置；否则使用默认配置
   ↓
7. 发送到对应的打印机
```

## 快速检查

### 检查是否有自拍机数据

在管理后台：
1. 访问：**加盟商管理** → 点击任意加盟商的"查看详情"
2. 查看"自拍机设备"标签页
3. 如果有设备列表，说明有自拍机数据
4. 如果没有，需要先添加自拍机

### 检查打印配置页面

1. 访问：**打印配置** 页面
2. 查看"门店打印机配置"表格
3. 如果表格显示自拍机列表，说明数据正常
4. 如果显示"暂无门店配置"，说明没有自拍机数据

## 常见问题

### Q1: 为什么表格是空的？

**A:** 因为数据库中还没有自拍机数据。需要先：
1. 添加加盟商账户
2. 在加盟商详情页面添加自拍机设备
3. 然后打印配置页面就会显示自拍机列表

### Q2: 一个门店可以有多台自拍机吗？

**A:** 可以。在同一个加盟商账户下，可以添加多台自拍机，每台自拍机可以配置不同的打印机。

### Q3: 如果某个门店没有配置打印机会怎样？

**A:** 会使用"默认打印机配置"（打印配置页面顶部的配置）。建议为每个门店都配置独立的打印机。

### Q4: 自拍机序列号在哪里查看？

**A:** 
- 在加盟商详情页面的"自拍机设备"标签页
- 在打印配置页面的"门店打印机配置"表格中
- 必须与安卓APP中配置的序列号完全一致

## 下一步

1. ✅ 添加加盟商账户（如果还没有）
2. ✅ 在加盟商详情页面添加自拍机设备
3. ✅ 刷新打印配置页面，应该能看到自拍机列表了
4. ✅ 为每个自拍机配置打印机
5. ✅ 测试打印功能
