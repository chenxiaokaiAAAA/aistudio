# 排查打印问题

## 问题现象

显示"打印成功"，但实际没有看到打印输出。

## 可能原因

1. **打印任务在队列中但没有实际打印**
2. **打印机路径不正确**
3. **文件格式问题**（.txt 文件可能没有正确打开）
4. **打印机驱动问题**
5. **网络打印机连接问题**

## 排查步骤

### 步骤1：检查打印队列

1. **打开打印队列**
   - 按 `Win + R`，输入：`control printers`
   - 找到打印机：`HP OfficeJet Pro 7730 series`
   - 双击打开，查看是否有打印任务在队列中

2. **检查任务状态**
   - 如果有任务但显示"暂停"或"错误"，右键点击任务 → "恢复" 或 "重新启动"

### 步骤2：检查打印机连接

1. **测试打印机连接**
   ```cmd
   ping sm003
   ```

2. **检查打印机是否在线**
   - 打开"设备和打印机"
   - 查看打印机状态是否为"就绪"

### 步骤3：手动测试打印

1. **创建一个测试文件**
   - 创建一个 `test.txt` 文件，内容：`测试打印`

2. **手动打印测试**
   - 右键点击 `test.txt` → "打印"
   - 选择打印机：`HP OfficeJet Pro 7730 series`
   - 看是否能正常打印

### 步骤4：检查打印代理服务日志

查看打印代理服务窗口的详细日志：
- 是否显示"打印机连接正常"
- 是否有任何错误信息
- ShellExecute 返回码是多少（42 表示成功，但可能只是提交到队列）

### 步骤5：使用更可靠的打印方法

对于文本文件（.txt），ShellExecute 的 "print" 操作可能不够可靠。可以尝试：

1. **使用 Windows 打印命令**
   ```cmd
   notepad /p test.txt
   ```

2. **或者使用 PowerShell**
   ```powershell
   Get-Content test.txt | Out-Printer -Name "HP OfficeJet Pro 7730 series"
   ```

## 快速修复方案

### 方案1：检查并恢复打印队列

1. 打开打印队列
2. 如果有任务，右键 → "恢复"
3. 如果没有任务，重新发送打印请求

### 方案2：使用不同的打印方法

修改 `print_proxy_server.py`，对于文本文件使用更可靠的打印方法。

### 方案3：检查打印机路径

确认打印机路径是否正确：
- 当前配置：`\\sm003\HP OfficeJet Pro 7730 series`
- 在"设备和打印机"中查看实际打印机名称

## 常见问题

### Q1: ShellExecute 返回码 42 是什么意思？

A: 返回码 42 表示 ShellExecute 操作成功，文件已发送到打印队列。但实际打印可能还需要：
- 打印机在线
- 打印队列正常
- 文件格式被正确识别

### Q2: 为什么 .txt 文件没有打印？

A: .txt 文件使用 ShellExecute "print" 操作时，Windows 会：
1. 打开默认文本编辑器（如记事本）
2. 调用打印对话框
3. 如果打印对话框被取消或没有正确执行，就不会打印

### Q3: 如何确保打印任务真正执行？

A: 可以：
1. 检查打印队列，确认任务状态
2. 使用更直接的打印 API（如 win32print）
3. 对于文本文件，使用专门的文本打印方法

## 下一步

如果以上步骤都无法解决问题，请：
1. 提供打印代理服务的完整日志
2. 提供打印队列的截图
3. 说明手动打印测试的结果
