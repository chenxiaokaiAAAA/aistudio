<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘„å½±æŠ¥åç®¡ç† - {{ brand_name }}åå°</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        
        .navbar-custom {
            background: rgba(0,0,0,0.3) !important;
            backdrop-filter: blur(10px);
        }
        
        .main-content {
            margin-top: 100px;
            padding: 20px;
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        
        .card-header {
            background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px 15px 0 0 !important;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #ff5252, #26a69a);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            border: none;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #e74c3c);
            border: none;
        }
        
        .form-control {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
        }
        
        .form-control:focus {
            background: rgba(255,255,255,0.15);
            border-color: #4ecdc4;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(78, 205, 196, 0.25);
        }
        
        .form-control::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        /* Selectä¸‹æ‹‰èœå•æ ·å¼ä¼˜åŒ– */
        select.form-control {
            background: rgba(30,30,30,0.9) !important;
            color: white !important;
            border: 1px solid rgba(255,255,255,0.3) !important;
        }
        
        select.form-control option {
            background: rgba(30,30,30,0.95) !important;
            color: white !important;
            padding: 8px 12px;
        }
        
        select.form-control:focus {
            background: rgba(30,30,30,0.9) !important;
            border-color: #4ecdc4 !important;
            color: white !important;
        }
        
        /* æ‚¬åœæ•ˆæœ */
        select.form-control option:hover {
            background: rgba(78, 205, 196, 0.2) !important;
            color: white !important;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-footer {
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* è¯¦æƒ…æ¨¡æ€æ¡†å†…å®¹æ ·å¼ - é»‘åº•ç™½å­— */
        #detailModal .modal-content {
            background: #000000 !important;
            color: #ffffff !important;
        }
        
        #detailModal .modal-header {
            background: #000000 !important;
            color: #ffffff !important;
            border-bottom: 1px solid rgba(255,255,255,0.2) !important;
        }
        
        #detailModal .modal-body {
            background: #000000 !important;
            color: #ffffff !important;
        }
        
        #detailModal .modal-footer {
            background: #000000 !important;
            color: #ffffff !important;
            border-top: 1px solid rgba(255,255,255,0.2) !important;
        }
        
        #detailModal .modal-title {
            color: #ffffff !important;
        }
        
        #detailModal .close {
            color: #ffffff !important;
        }
        
        #detailModal .close:hover {
            color: #ffffff !important;
            opacity: 0.8;
        }
        
        #detailModal h6 {
            color: #ffffff !important;
        }
        
        #detailModal p {
            color: #ffffff !important;
        }
        
        #detailModal table {
            color: #ffffff !important;
            background: #000000 !important;
        }
        
        #detailModal table td {
            color: #ffffff !important;
            background: #000000 !important;
            border-color: rgba(255,255,255,0.2) !important;
        }
        
        #detailModal table strong {
            color: #ffffff !important;
        }
        
        /* ç¡®ä¿çŠ¶æ€æ ‡ç­¾åœ¨è¯¦æƒ…æ¨¡æ€æ¡†ä¸­æ­£ç¡®æ˜¾ç¤º */
        #detailModal .status-badge {
            color: #ffffff !important;
        }
        
        /* ç¡®ä¿å® ç‰©å›¾ç‰‡å®¹å™¨åœ¨è¯¦æƒ…æ¨¡æ€æ¡†ä¸­æ­£ç¡®æ˜¾ç¤º */
        #detailModal .pet-images {
            background: #000000 !important;
        }
        
        #detailModal .pet-image {
            border: 2px solid rgba(255,255,255,0.3) !important;
        }
        
        #detailModal .pet-image:hover {
            border-color: #ffffff !important;
        }
        
        .table-custom {
            color: white;
            background: rgba(255,255,255,0.05);
        }
        
        .table-custom th {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.1);
        }
        
        .table-custom td {
            border-color: rgba(255,255,255,0.1);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: #ffc107;
            color: #000;
        }
        
        .status-contacted {
            background: #17a2b8;
            color: #000;
        }
        
        .status-contact-failed {
            background: #ff9800;
            color: #fff;
        }
        
        .status-scheduled {
            background: #28a745;
            color: #fff;
        }
        
        .status-completed {
            background: #6c757d;
            color: #fff;
        }
        
        .status-cancelled {
            background: #dc3545;
            color: #fff;
        }
        
        .pet-images {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .pet-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
        border-radius: 8px;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .pet-image:hover {
            border-color: #4ecdc4;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-top: 10px;
        }
        
        .loading-spinner {
            display: none;
        }
        
        .page-link {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .page-link:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .pagination .page-item.active .page-link {
            background: #4ecdc4;
            border-color: #4ecdc4;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/admin/dashboard">{{ brand_name }}åå°</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/admin/dashboard">ç®¡ç†é¦–é¡µ</a>
                <a class="nav-link" href="/admin/homepage">é¦–é¡µé…ç½®</a>
                <a class="nav-link" href="/admin/styles">é£æ ¼ç®¡ç†</a>
                <a class="nav-link active" href="/admin/photo-signups">ğŸ“· æ‘„å½±æŠ¥å</a>
                <a class="nav-link" href="/logout">é€€å‡ºç™»å½•</a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="container">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="row mb-4">
                <div class="col-12 d-flex justify-content-between align-items-center">
                    <div>
                        <h2>ğŸ“· å® ç‰©æ‘„å½±æŠ¥åç®¡ç†</h2>
                        <p class="text-muted">æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·çš„å® ç‰©æ‘„å½±æŠ¥åä¿¡æ¯</p>
                    </div>
                    <div>
                        <button type="button" class="btn btn-success" onclick="exportSignups()">
                            ğŸ“¥ å¯¼å‡ºæ•°æ®
                        </button>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="row mb-4" id="statsRow">
                <div class="col-md-3">
                    <div class="card stats-card">
                        <div class="stats-number" id="totalApplications">-</div>
                        <div class="stats-label">æ€»æŠ¥åæ•°</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card">
                        <div class="stats-number" id="pendingApplications">-</div>
                        <div class="stats-label">å¾…å¤„ç†</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card">
                        <div class="stats-number" id="completedApplications">-</div>
                        <div class="stats-label">å·²å®Œæˆ</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card">
                        <div class="stats-number" id="thisMonthApplications">-</div>
                        <div class="stats-label">æœ¬æœˆæ–°å¢</div>
                    </div>
                </div>
            </div>

            <!-- ç­›é€‰å’Œæœç´¢ -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>ç­›é€‰æ¡ä»¶</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="form-control" id="statusFilter">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="pending">å¾…è”ç³»</option>
                                        <option value="contacted">å·²è”ç³»</option>
                                        <option value="contact_failed">ç”µè¯æœªæ‰“é€š</option>
                                        <option value="scheduled">å·²é¢„çº¦</option>
                                        <option value="completed">å·²å®Œæˆ</option>
                                        <option value="cancelled">å·²å–æ¶ˆ</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="nameFilter" placeholder="æœç´¢å§“å">
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="loadSignups()">
                                        ğŸ” æœç´¢
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŠ¥ååˆ—è¡¨ -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5>æŠ¥ååˆ—è¡¨</h5>
                            <div class="loading-spinner spinner-border text-light" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-custom">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>å§“å</th>
                                            <th>æ‰‹æœºå·</th>
                                            <th>å® ç‰©ä¿¡æ¯</th>
                                            <th>é¢„çº¦æ—¶é—´</th>
                                            <th>çŠ¶æ€</th>
                                            <th>åˆ°åº—æ—¶é—´</th>
                                            <th>æŠ¥åæ—¶é—´</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="signupsTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">åŠ è½½ä¸­...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- åˆ†é¡µ -->
                            <nav aria-label="æŠ¥ååˆ—è¡¨åˆ†é¡µ">
                                <ul class="pagination justify-content-center" id="pagination">
                                    <li class="page-item disabled">
                                        <span class="page-link">ä¸Šä¸€é¡µ</span>
                                    </li>
                                    <li class="page-item active">
                                        <span class="page-link">1</span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link">ä¸‹ä¸€é¡µ</span>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æŠ¥åè¯¦æƒ…</h5>
                    <button type="button" class="close" data-bs-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="detailModalBody">
                    <!-- è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptå¡«å…… -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€æ›´æ–°æ¨¡æ€æ¡† -->
    <div class="modal fade" id="statusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æ›´æ–°çŠ¶æ€</h5>
                    <button type="button" class="close" data-bs-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="statusForm">
                                        <input type="hidden" id="signupId">
                        <div class="mb-3">
                            <label for="newStatus" class="form-label">çŠ¶æ€</label>
                            <select class="form-control" id="newStatus" required>
                                <option value="">è¯·é€‰æ‹©çŠ¶æ€</option>
                                <option value="pending">å¾…è”ç³»</option>
                                <option value="contacted">å·²è”ç³»</option>
                                <option value="contact_failed">ç”µè¯æœªæ‰“é€š</option>
                                <option value="scheduled">å·²é¢„çº¦</option>
                                <option value="completed">å·²å®Œæˆ</option>
                                <option value="cancelled">å·²å–æ¶ˆ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="storeVisitTime" class="form-label">åˆ°åº—æ—¶é—´ <span class="text-muted small">(å¯é€‰)</span></label>
                            <input type="datetime-local" class="form-control" id="storeVisitTime" 
                                   placeholder="é€‰æ‹©å®¢æˆ·åˆ°åº—æ—¶é—´">
                            <small class="form-text text-muted">ç”¨äºè®°å½•å®¢æˆ·å®é™…åˆ°åº—çš„å…·ä½“æ—¶é—´</small>
                        </div>
                        <div class="mb-3">
                            <label for="notes" class="form-label">å¤‡æ³¨</label>
                            <textarea class="form-control" id="notes" rows="3" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="updateStatus()">æ›´æ–°çŠ¶æ€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">âš ï¸ ç¡®è®¤åˆ é™¤</h5>
                    <button type="button" class="close" data-bs-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</strong>
                    </div>
                    <p>æ‚¨ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹æŠ¥åè®°å½•å—ï¼Ÿ</p>
                    <div class="card bg-dark border-danger">
                        <div class="card-body">
                            <div id="deleteConfirmInfo">
                                <!-- åˆ é™¤ä¿¡æ¯å°†é€šè¿‡JavaScriptå¡«å…… -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-danger" onclick="deleteSignup()">
                        ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSignups();
            updateStats();
        });

        // åŠ è½½æŠ¥ååˆ—è¡¨
        function loadSignups(page = 1) {
            const status = document.getElementById('statusFilter').value;
            
            let url = `/api/photo-signup/list?page=${page}&per_page=20`;
            if (status) url += `&status=${status}`;
            
            document.querySelector('.loading-spinner').style.display = 'inline-block';
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    document.querySelector('.loading-spinner').style.display = 'none';
                    
                    if (data.success) {
                        renderSignupsTable(data.data);
                        updatePagination(data.current_page, data.pages);
                        currentPage = data.current_page;
                        totalPages = data.pages;
                        updateStats();
                    } else {
                        document.getElementById('signupsTableBody').innerHTML = 
                            '<tr><td colspan="9" class="text-center text-danger">åŠ è½½å¤±è´¥ï¼š' + data.message + '</td></tr>';
                    }
                })
                .catch(error => {
                    document.querySelector('.loading-spinner').style.display = 'none';
                    console.error('Error:', error);
                    document.getElementById('signupsTableBody').innerHTML = 
                        '<tr><td colspan="9" class="text-center text-danger">ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•</td></tr>';
                });
        }

        // æ¸²æŸ“æŠ¥åè¡¨æ ¼
        function renderSignupsTable(signups) {
            const tbody = document.getElementById('signupsTableBody');
            
            if (signups.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center text-muted">æš‚æ— æ•°æ®</td></tr>';
                return;
            }

            tbody.innerHTML = signups.map(signup => `
                <tr>
                    <td>${signup.id}</td>
                    <td>${signup.name}</td>
                    <td>
                        <a href="tel:${signup.phone}" class="text-decoration-none">
                            ${signup.phone}
                        </a>
                    </td>
                    <td>
                        <div class="small">
                            å“ç§ï¼š${signup.petBreed}<br>
                            ä½“é‡ï¼š${signup.petWeight}<br>
                            å¹´é¾„ï¼š${signup.petAge}
                        </div>
                    </td>
                    <td>${signup.availableDate || '-'}</td>
                    <td>
                        <span class="status-badge status-${signup.status}">
                            ${signup.statusText}
                        </span>
                    </td>
                    <td>${signup.storeVisitTime || '-'}</td>
                    <td>${formatDate(signup.submitTime)}</td>
                    <td>
                        <button class="btn btn-primary btn-sm me-1" onclick="viewDetails(${signup.id})">
                            æŸ¥çœ‹
                        </button>
                        <button class="btn btn-warning btn-sm me-1" onclick="updateStatusModal(${signup.id})">
                            æ›´æ–°
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${signup.id}, '${signup.name}', '${signup.phone}')">
                            åˆ é™¤
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æŸ¥çœ‹è¯¦æƒ…
        function viewDetails(signupId) {
            fetch(`/api/photo-signup/list?per_page=100`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const signup = data.data.find(s => s.id === signupId);
                        if (signup) {
                            showDetailModal(signup);
                        }
                    }
                });
        }

        // æ˜¾ç¤ºè¯¦æƒ…æ¨¡æ€æ¡†
        function showDetailModal(signup) {
            const modalBody = document.getElementById('detailModalBody');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>åŸºæœ¬ä¿¡æ¯</h6>
                        <table class="table table-sm">
                            <tr><td><strong>å§“åï¼š</strong></td><td>${signup.name}</td></tr>
                            <tr><td><strong>æ‰‹æœºå·ï¼š</strong></td><td>${signup.phone}</td></tr>
                            <tr><td><strong>æŠ¥åçŠ¶æ€ï¼š</strong></td><td>
                                <span class="status-badge status-${signup.status}">${signup.statusText}</span>
                            </td></tr>
                            <tr><td><strong>æŠ¥åæ—¶é—´ï¼š</strong></td><td>${formatDate(signup.submitTime)}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>å® ç‰©ä¿¡æ¯</h6>
                        <table class="table table-sm">
                            <tr><td><strong>å“ç§ï¼š</strong></td><td>${signup.petBreed}</td></tr>
                            <tr><td><strong>ä½“é‡ï¼š</strong></td><td>${signup.petWeight}</td></tr>
                            <tr><td><strong>å¹´é¾„ï¼š</strong></td><td>${signup.petAge}</td></tr>
                            <tr><td><strong>æ€§æ ¼ï¼š</strong></td><td>${signup.petCharacter || 'æœªå¡«å†™'}</td></tr>
                            <tr><td><strong>é¢„çº¦æ—¶é—´ï¼š</strong></td><td>${signup.availableDate || 'æœªé€‰æ‹©'}</td></tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>å¤‡æ³¨ä¿¡æ¯</h6>
                        <p>${signup.additionalNotes || 'æ— å¤‡æ³¨'}</p>
                    </div>
                </div>
                ${signup.petImages && signup.petImages.length > 0 ? `
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>å® ç‰©å›¾ç‰‡</h6>
                            <div class="pet-images">
                                ${renderPetImages(signup.petImages)}
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
            
            new bootstrap.Modal(document.getElementById('detailModal')).show();
        }

        // æ¸²æŸ“å® ç‰©å›¾ç‰‡
        function renderPetImages(images) {
            if (!images || images.length === 0) {
                return '<span class="text-muted">æ— å›¾ç‰‡</span>';
            }
            
            return images.map((image, index) => `
                <img src="${image}" alt="å® ç‰©å›¾ç‰‡${index + 1}" class="pet-image" 
                     onclick="previewImage('${image}')" title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾">
            `).join('');
        }

        // é¢„è§ˆå›¾ç‰‡
        function previewImage(imageUrl) {
            window.open(imageUrl, '_blank');
        }

        // æ‰“å¼€çŠ¶æ€æ›´æ–°æ¨¡æ€æ¡†
        function updateStatusModal(signupId) {
            document.getElementById('signupId').value = signupId;
            document.getElementById('newStatus').value = '';
            document.getElementById('storeVisitTime').value = '';
            document.getElementById('notes').value = '';
            new bootstrap.Modal(document.getElementById('statusModal')).show();
        }

        // æäº¤çŠ¶æ€æ›´æ–°
        function updateStatus() {
            const id = document.getElementById('signupId').value;
            const status = document.getElementById('newStatus').value;
            const storeVisitTime = document.getElementById('storeVisitTime').value;
            const notes = document.getElementById('notes').value;
            
            if (!status) {
                alert('è¯·é€‰æ‹©çŠ¶æ€');
                return;
            }
            
            const updateData = {
                status: status,
                notes: notes
            };
            
            if (storeVisitTime) {
                updateData.store_visit_time = storeVisitTime;
            }
            
            fetch(`/api/photo-signup/${id}/update-status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('çŠ¶æ€æ›´æ–°æˆåŠŸï¼');
                    bootstrap.Modal.getInstance(document.getElementById('statusModal')).hide();
                    loadSignups(currentPage);
                } else {
                    alert('æ›´æ–°å¤±è´¥ï¼š' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            });
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            fetch('/api/photo-signup/list?per_page=1')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('totalApplications').textContent = data.total || 0;
                        
                        // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„ç»Ÿè®¡è®¡ç®—
                        document.getElementById('pendingApplications').textContent = 'ç»Ÿè®¡ä¸­';
                        document.getElementById('completedApplications').textContent = 'ç»Ÿè®¡ä¸­';
                        document.getElementById('thisMonthApplications').textContent = 'ç»Ÿè®¡ä¸­';
                    }
                });
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination(currentPage, totalPages) {
            const pagination = document.getElementById('pagination');
            let html = '';
            
            // ä¸Šä¸€é¡µ
            html += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadSignups(${currentPage - 1})">ä¸Šä¸€é¡µ</a>
                </li>
            `;
            
            // é¡µç 
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                html += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="loadSignups(${i})">${i}</a>
                    </li>
                `;
            }
            
            // ä¸‹ä¸€é¡µ
            html += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadSignups(${currentPage + 1})">ä¸‹ä¸€é¡µ</a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleString('zh-CN');
        }

        // ç¡®è®¤åˆ é™¤
        function confirmDelete(signupId, name, phone) {
            document.getElementById('deleteConfirmInfo').innerHTML = `
                <p><strong>æŠ¥åIDï¼š</strong>${signupId}</p>
                <p><strong>å§“åï¼š</strong>${name}</p>
                <p><strong>æ‰‹æœºå·ï¼š</strong>${phone}</p>
                <p class="text-danger mt-3"><strong>âš ï¸ åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼</strong></p>
            `;
            
            // è®¾ç½®å…¨å±€å˜é‡å­˜å‚¨è¦åˆ é™¤çš„è®°å½•ID
            window.deleteSignupId = signupId;
            
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // æ‰§è¡Œåˆ é™¤æ“ä½œ
        function deleteSignup() {
            const signupId = window.deleteSignupId;
            
            if (!signupId) {
                alert('åˆ é™¤å¤±è´¥ï¼šæœªæ‰¾åˆ°è®°å½•ID');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const deleteBtn = document.querySelector('#deleteModal .btn-danger');
            const originalText = deleteBtn.innerHTML;
            deleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>åˆ é™¤ä¸­...';
            deleteBtn.disabled = true;

            // å‘é€åˆ é™¤è¯·æ±‚
            fetch(`/api/photo-signup/${signupId}/delete`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                deleteBtn.innerHTML = originalText;
                deleteBtn.disabled = false;
                
                if (data.success) {
                    // å…³é—­æ¨¡æ€æ¡†
                    bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    alert('âœ… æŠ¥åè®°å½•åˆ é™¤æˆåŠŸï¼');
                    
                    // é‡æ–°åŠ è½½å½“å‰é¡µé¢æ•°æ®
                    loadSignups(currentPage);
                    updateStats();
                } else {
                    alert('âŒ åˆ é™¤å¤±è´¥ï¼š' + data.message);
                }
            })
            .catch(error => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                deleteBtn.innerHTML = originalText;
                deleteBtn.disabled = false;
                
                console.error('Error:', error);
                alert('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            });
        }

        // å¯¼å‡ºæŠ¥åæ•°æ®
        function exportSignups() {
            // æ˜¾ç¤ºåŠ è½½æç¤º
            if (confirm('ç¡®å®šè¦å¯¼å‡ºæ‰€æœ‰æŠ¥åæ•°æ®å—ï¼Ÿ')) {
                // åˆ›å»ºä¸€ä¸ªéšè—çš„é“¾æ¥æ¥è§¦å‘ä¸‹è½½
                const link = document.createElement('a');
                link.href = '/api/photo-signup/export';
                link.download = 'photo_signups_export.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('statusFilter').addEventListener('change', () => loadSignups(1));
    </script>
</body>
</html>