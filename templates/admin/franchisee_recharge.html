<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸º {{ account.company_name }} å……å€¼ - AIæ‹ç…§ç®¡ç†ç³»ç»Ÿ</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 80px;
        }
        .navbar-custom {
            background: #0a0a0a !important;
            border-bottom: 1px solid #1a1a1a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .navbar-brand, .nav-link {
            color: #e0e0e0 !important;
        }
        .nav-link:hover {
            color: #ffffff !important;
        }
        .nav-link.active {
            color: #ffffff !important;
            font-weight: 600;
        }
        .form-container { max-width: 600px; margin: 0 auto; }
        .account-info { background: #f8f9fa; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    {% include 'admin/_navbar.html' %}

    <div class="container mt-4">
        <div class="form-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>ğŸ’° ä¸ºåŠ ç›Ÿå•†å……å€¼</h2>
                <a href="/franchisee/admin/accounts/{{ account.id }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> è¿”å›è¯¦æƒ…
                </a>
            </div>

            <!-- æ¶ˆæ¯æç¤º -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- è´¦æˆ·ä¿¡æ¯ -->
            <div class="account-info mb-4">
                <div class="row">
                    <div class="col-md-6">
                        <h5>{{ account.company_name }}</h5>
                        <p class="text-muted mb-0">{{ account.contact_person }} - {{ account.contact_phone }}</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="row">
                            <div class="col-4">
                                <div class="text-center">
                                    <h6 class="text-primary">Â¥{{ "%.2f"|format(account.total_quota) }}</h6>
                                    <small class="text-muted">æ€»é¢åº¦</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center">
                                    <h6 class="text-warning">Â¥{{ "%.2f"|format(account.used_quota) }}</h6>
                                    <small class="text-muted">å·²ä½¿ç”¨</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center">
                                    <h6 class="text-success">Â¥{{ "%.2f"|format(account.remaining_quota) }}</h6>
                                    <small class="text-muted">å‰©ä½™é¢åº¦</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å……å€¼è¡¨å• -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">å……å€¼ä¿¡æ¯</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="amount" class="form-label">å……å€¼é‡‘é¢ <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text">Â¥</span>
                                        <input type="number" class="form-control" id="amount" name="amount" 
                                               required min="0.01" step="0.01" placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢">
                                    </div>
                                    <small class="text-muted">åŠ ç›Ÿå•†å°†çœ‹åˆ°æ­¤é‡‘é¢</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="bonus_amount" class="form-label">èµ é€é‡‘é¢ <span class="text-success">â¤ï¸</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text">Â¥</span>
                                        <input type="number" class="form-control" id="bonus_amount" name="bonus_amount" 
                                               value="0" min="0" step="0.01" placeholder="èµ é€é‡‘é¢">
                                    </div>
                                    <small class="text-muted">èµ é€éƒ¨åˆ†ä¸ä¼šæ˜¾ç¤ºç»™åŠ ç›Ÿå•†</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="recharge_type" class="form-label">å……å€¼ç±»å‹</label>
                                    <select class="form-select" id="recharge_type" name="recharge_type">
                                        <option value="manual">æ‰‹åŠ¨å……å€¼</option>
                                        <option value="refund">é€€æ¬¾</option>
                                        <option value="adjustment">é¢åº¦è°ƒæ•´</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <!-- é¢„ç•™ç©ºä½ -->
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">å……å€¼è¯´æ˜</label>
                            <textarea class="form-control" id="description" name="description" rows="3" 
                                      placeholder="è¯·è¾“å…¥å……å€¼è¯´æ˜ï¼ˆå¯é€‰ï¼‰"></textarea>
                        </div>

                        <!-- å¿«é€Ÿå……å€¼æŒ‰é’® -->
                        <div class="mb-3">
                            <label class="form-label">å¿«é€Ÿå……å€¼</label>
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-primary" onclick="setAmount(100)">Â¥100</button>
                                <button type="button" class="btn btn-outline-primary" onclick="setAmount(500)">Â¥500</button>
                                <button type="button" class="btn btn-outline-primary" onclick="setAmount(1000)">Â¥1000</button>
                                <button type="button" class="btn btn-outline-primary" onclick="setAmount(5000)">Â¥5000</button>
                                <button type="button" class="btn btn-outline-primary" onclick="setAmount(10000)">Â¥10000</button>
                            </div>
                        </div>

                        <!-- å……å€¼é¢„è§ˆ -->
                        <div class="alert alert-info" id="preview" style="display: none;">
                            <h6>å……å€¼é¢„è§ˆï¼š</h6>
                            <p class="mb-1">å½“å‰å‰©ä½™é¢åº¦ï¼š<strong>Â¥{{ "%.2f"|format(account.remaining_quota) }}</strong></p>
                            <p class="mb-1">å……å€¼é‡‘é¢ï¼š<strong class="text-success" id="preview-amount">Â¥0.00</strong></p>
                            <p class="mb-1" id="preview-bonus" style="display: none;">èµ é€é‡‘é¢ï¼š<strong class="text-danger">+Â¥<span id="preview-bonus-amount">0.00</span></strong></p>
                            <p class="mb-0">å®é™…åˆ°è´¦ï¼š<strong class="text-primary" id="preview-total">Â¥{{ "%.2f"|format(account.remaining_quota) }}</strong></p>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/franchisee/admin/accounts/{{ account.id }}" class="btn btn-secondary me-md-2">å–æ¶ˆ</a>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-plus"></i> ç¡®è®¤å……å€¼
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- æœ€è¿‘å……å€¼è®°å½• -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">ğŸ“‹ æœ€è¿‘å……å€¼è®°å½•</h6>
                </div>
                <div class="card-body">
                    {% if account.recharge_records %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>é‡‘é¢</th>
                                    <th>ç±»å‹</th>
                                    <th>æ“ä½œå‘˜</th>
                                    <th>æ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in account.recharge_records[:5] %}
                                <tr>
                                    <td class="text-success">+Â¥{{ "%.2f"|format(record.amount) }}</td>
                                    <td>
                                        {% if record.recharge_type == 'manual' %}
                                            <span class="badge bg-primary">æ‰‹åŠ¨å……å€¼</span>
                                        {% elif record.recharge_type == 'refund' %}
                                            <span class="badge bg-warning">é€€æ¬¾</span>
                                        {% else %}
                                            <span class="badge bg-info">è°ƒæ•´</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ record.admin_user.username }}</td>
                                    <td>{{ record.created_at.strftime('%m-%d %H:%M') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted text-center">æš‚æ— å……å€¼è®°å½•</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script>
        function setAmount(amount) {
            document.getElementById('amount').value = amount;
            updatePreview();
        }

        function updatePreview() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const bonus = parseFloat(document.getElementById('bonus_amount').value) || 0;
            const current = {{ account.remaining_quota }};
            const total = current + amount + bonus;
            
            document.getElementById('preview-amount').textContent = 'Â¥' + amount.toFixed(2);
            document.getElementById('preview-total').textContent = 'Â¥' + total.toFixed(2);
            
            if (bonus > 0) {
                document.getElementById('preview-bonus').style.display = 'block';
                document.getElementById('preview-bonus-amount').textContent = bonus.toFixed(2);
            } else {
                document.getElementById('preview-bonus').style.display = 'none';
            }
            
            if (amount > 0) {
                document.getElementById('preview').style.display = 'block';
            } else {
                document.getElementById('preview').style.display = 'none';
            }
        }

        // ç›‘å¬é‡‘é¢è¾“å…¥
        document.getElementById('amount').addEventListener('input', updatePreview);
        document.getElementById('bonus_amount').addEventListener('input', updatePreview);
    </script>
</body>
</html>







