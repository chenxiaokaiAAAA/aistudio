// 文件：README.md
// 小程序前端修改说明

# 小程序前端访问追踪修改说明

## 修改概述

为了实现完整的用户访问追踪系统，需要在小程序前端添加访问记录功能。系统将记录：
- 用户第一次扫码进入（分配推广ID）
- 每次打开小程序
- 每次浏览页面
- 用户行为（授权、下单等）

## 需要修改的文件

### 1. 新增文件
- `utils/visitTracker.js` - 访问追踪工具类

### 2. 修改文件
- `app.js` - 小程序主入口
- `pages/index/index.js` - 首页
- `pages/product/product.js` - 商品页面
- `pages/order/order.js` - 订单页面
- `pages/profile/profile.js` - 个人中心
- `pages/promotion/promotion.js` - 推广码页面

## 修改步骤

### 步骤1：创建访问追踪工具类
1. 在 `utils` 目录下创建 `visitTracker.js` 文件
2. 复制提供的代码内容

### 步骤2：修改 app.js
1. 引入访问追踪工具类
2. 在 `onLaunch` 和 `onShow` 中添加访问记录

### 步骤3：修改各个页面
1. 在每个页面的 `onLoad` 和 `onShow` 中添加访问记录
2. 在关键用户行为中添加访问记录

## 关键功能说明

### 访问类型
- `launch` - 小程序启动
- `scan` - 扫码进入
- `auth` - 用户授权
- `browse` - 页面浏览
- `order` - 下单

### 推广码分配逻辑
1. 用户第一次扫码 → 分配临时推广码
2. 用户授权后 → 升级为正式推广码
3. 用户下单后 → 确认推广码有效性

### API接口
- 接口地址：`https://moeart.cc/api/user/visit`
- 请求方法：POST
- 请求参数：包含会话ID、用户信息、访问类型等

## 注意事项

1. **域名配置**：确保在小程序后台配置了正确的服务器域名
2. **错误处理**：访问记录失败不应影响正常业务流程
3. **性能优化**：避免频繁的API调用影响用户体验
4. **数据安全**：敏感信息需要加密传输

## 测试验证

修改完成后，可以通过以下方式验证：
1. 扫码进入小程序，检查是否分配了推广码
2. 浏览不同页面，检查是否记录了访问
3. 用户授权和下单，检查是否记录了行为
4. 查看后台管理页面，确认数据正确显示

## 常见问题

### Q: 访问记录失败怎么办？
A: 系统设计了容错机制，访问记录失败不会影响正常业务流程。

### Q: 如何查看访问数据？
A: 可以在后台管理页面的"推广用户"部分查看访问统计。

### Q: 推广码如何生成？
A: 系统会自动为用户生成唯一的推广码，格式为 PET + 6位随机字符。

## 联系支持

如有问题，请联系开发团队。








