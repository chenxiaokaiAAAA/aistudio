# 产品详情页模态框选择功能说明

## 功能概述

将产品详情页的选择功能改为模态框形式，默认只显示产品主图和描述，点击"加入购物车"或"提交订单"时弹出选择模态框。

## 交互流程

### 1. 默认状态
- ✅ 显示产品主图（轮播）
- ✅ 显示产品描述
- ❌ 不显示风格、尺寸、颜色选择

### 2. 点击按钮
- 用户点击"加入购物车"或"提交订单"
- 弹出规格选择模态框（从底部滑出）

### 3. 选择规格
- 在模态框中选择：
  - 风格（必选）
  - 尺寸（必选）
  - 颜色（如果有颜色选项，必选）

### 4. 确认操作
- 点击"确认"按钮
- 验证必填项
- 关闭模态框
- 执行相应操作（加入购物车或提交订单）

## 修改内容

### 1. 页面结构 (`product-detail.wxml`)

**移除的内容：**
- 从主页面移除了风格选择区域
- 从主页面移除了尺寸和颜色选择区域

**新增的内容：**
- 规格选择模态框组件
- 模态框包含：风格选择、尺寸选择、颜色选择
- 模态框底部：取消按钮、确认按钮

### 2. 页面逻辑 (`product-detail.js`)

**新增数据字段：**
- `showSpecModal`: 控制模态框显示/隐藏
- `pendingAction`: 记录待执行的操作（cart 或 order）

**新增方法：**
- `showSpecModal()`: 显示规格选择模态框
- `hideSpecModal()`: 隐藏规格选择模态框
- `stopPropagation()`: 阻止事件冒泡
- `confirmSpec()`: 确认规格选择并执行操作

**修改的方法：**
- `addToCart()`: 改为由 `confirmSpec()` 调用
- `submitOrder()`: 改为由 `confirmSpec()` 调用

### 3. 页面样式 (`product-detail.wxss`)

**新增样式：**
- `.spec-modal`: 模态框容器
- `.spec-modal-content`: 模态框内容
- `.spec-modal-header`: 模态框头部
- `.spec-modal-body`: 模态框主体（可滚动）
- `.spec-modal-footer`: 模态框底部按钮区域
- `.spec-modal-btn`: 模态框按钮样式

**动画效果：**
- 模态框从底部滑出动画
- 背景遮罩淡入淡出效果

## 模态框结构

```
┌─────────────────────────────────────┐
│  选择规格                    ×      │  ← 头部
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  选择风格:                   │   │
│  │  [风格卡片] [风格卡片]       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  选择尺寸:                   │   │
│  │  [尺寸1] [尺寸2] [尺寸3]     │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  选择颜色:                   │   │
│  │  [颜色1] [颜色2] [颜色3]     │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  [取消]              [确认]         │  ← 底部
└─────────────────────────────────────┘
```

## 验证逻辑

在点击"确认"按钮时，会验证：

1. ✅ **必须选择尺寸**
   - 如果没有选择，提示："请选择尺寸"

2. ✅ **如果有颜色选项，必须选择颜色**
   - 如果产品有颜色选项但未选择，提示："请选择颜色"

3. ✅ **必须选择风格**
   - 如果没有选择，提示："请选择风格"

只有所有必填项都选择后，才能执行操作。

## 用户体验优化

### 1. 模态框动画
- 从底部滑出，平滑过渡
- 背景遮罩淡入效果

### 2. 可滚动内容
- 如果内容过多，模态框主体可滚动
- 最大高度：80vh

### 3. 关闭方式
- 点击"取消"按钮
- 点击右上角"×"按钮
- 点击背景遮罩（模态框外部）

### 4. 按钮状态
- 确认按钮：未选择完整时禁用（灰色）
- 确认按钮：选择完整时可用（红色）

## 代码示例

### 显示模态框

```javascript
// 点击"加入购物车"或"提交订单"时
showSpecModal(e) {
  const action = e.currentTarget.dataset.action; // 'cart' 或 'order'
  this.setData({
    showSpecModal: true,
    pendingAction: action
  });
}
```

### 确认选择

```javascript
confirmSpec() {
  // 验证必填项
  if (!selectedSize || !selectedStyle || (colorOptions.length > 0 && !selectedColor)) {
    wx.showToast({ title: '请完成选择', icon: 'none' });
    return;
  }
  
  // 关闭模态框
  this.setData({ showSpecModal: false });
  
  // 执行操作
  if (this.data.pendingAction === 'cart') {
    this.addToCart();
  } else {
    this.submitOrder();
  }
}
```

## 注意事项

1. **选择状态保留**
   - 关闭模态框时不会清空选择
   - 下次打开时会显示之前的选择
   - 方便用户修改某个选项

2. **模态框层级**
   - z-index: 2000
   - 确保在其他元素之上

3. **安全区域适配**
   - 底部按钮区域适配 iPhone 安全区域
   - 使用 `env(safe-area-inset-bottom)`

4. **滚动性能**
   - 使用 `scroll-view` 组件
   - 设置最大高度避免内容过多

## 测试建议

1. **功能测试**
   - 测试模态框显示/隐藏
   - 测试选择功能
   - 测试验证逻辑
   - 测试加入购物车和提交订单

2. **交互测试**
   - 测试各种关闭方式
   - 测试滚动功能
   - 测试按钮状态变化

3. **边界测试**
   - 测试没有风格分类的产品
   - 测试没有颜色选项的产品
   - 测试必填项验证

## 后续优化建议

1. **选择状态提示**
   - 在模态框头部显示已选择的规格摘要

2. **价格显示**
   - 在模态框中实时显示选中规格的价格

3. **快速选择**
   - 记住用户上次的选择，快速填充

4. **动画优化**
   - 添加选择时的动画反馈
   - 优化模态框滑出动画
