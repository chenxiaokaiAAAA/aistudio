# 订单通知系统 - 完整使用指南

## 📋 功能总览

授予你三套通知方案，支持不同使用场景：

### 1. 🖥️ 浏览器通知（推荐远程使用）
- **适用场景**: 用其他电脑远程访问管理后台
- **特点**: 浏览器弹窗 + 语音播报 + 音效
- **优势**: 无需任何配置，打开网页自动生效
- **自动刷新**: 收到新订单后页面自动刷新

### 2. 💬 微信通知（最便捷）
- **适用场景**: 手机端或不在电脑前
- **特点**: 微信消息推送
- **优势**: 随时随地接收通知
- **配置**: 需要配置企业微信群机器人

### 3. 🖱️ 服务器本地通知
- **适用场景**: 在服务器电脑上操作
- **特点**: Windows桌面弹窗 + 语音播报
- **优势**: 功能最完整
- **环境**: 需安装 plyer 和 pyttsx3 库

---

## 🚀 快速开始

### 场景1：你在远程电脑访问服务器

✅ **推荐方案：浏览器通知**

1. 打开管理后台：`http://你的服务器IP:8000/admin/dashboard`
2. 浏览器会提示"允许通知" → 点击"允许"
3. 完成！有新订单时会自动：
   - 弹窗显示订单信息
   - 语音播报订单详情
   - 页面自动刷新

**无需安装任何依赖，即刻生效！**

---

### 场景2：你想在手机上接收通知

✅ **推荐方案：微信通知**

#### 第1步：注册企业微信（免费）

1. 下载企业微信APP或访问：https://work.weixin.qq.com/
2. 注册并登录

#### 第2步：创建群聊和机器人

1. 创建群聊（至少需要2个人）
2. 群聊 → 右上角"..." → 添加群机器人
3. 给机器人起名"订单通知"
4. **复制 webhook 地址**（很重要！）

#### 第3步：配置系统

编辑 `wechat_notification_config.py`：

```python
# 启用微信通知
WECHAT_NOTIFICATION_ENABLED = True

# 使用企业微信
WECHAT_TYPE = 'enterprise'

# 粘贴你复制的webhook地址
ENTERPRISE_WEBHOOK_URL = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxx'
```

#### 第4步：重启服务器

```bash
python start.py
```

完成！新订单会自动推送到你的微信。

---

### 场景3：你在服务器电脑上操作

✅ **推荐方案：本地通知**

#### 第1步：安装依赖

双击运行：`安装订单通知功能.bat`

或手动执行：
```bash
pip install plyer pyttsx3
```

#### 第2步：测试

双击运行：`测试订单通知.bat`

#### 第3步：重启服务器

```bash
python start.py
```

有新订单时会：
- Windows桌面弹窗
- 语音播报
- 系统提示音

---

## 📊 功能对比表

| 功能 | 浏览器通知 | 微信通知 | 本地通知 |
|------|-----------|---------|---------|
| **配置难度** | ⭐ 无需配置 | ⭐⭐ 需webhook | ⭐⭐ 需安装库 |
| **远程访问** | ✅ 完美支持 | ✅ 完美支持 | ❌ 不支持 |
| **语音播报** | ✅ 支持 | ❌ 不支持 | ✅ 支持 |
| **实时性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **推荐场景** | 远程电脑访问 | 手机端 | 服务器本地 |

---

## 🎯 最佳实践推荐

### 推荐组合1：手机 + 电脑双端接收

```
✅ 微信通知（手机端）
✅ 浏览器通知（电脑端）
```

这样无论你：
- 在手机上 → 微信通知
- 在电脑前 → 浏览器通知

### 推荐组合2：全面覆盖

```
✅ 服务器本地通知（服务器电脑）
✅ 微信通知（其他设备）
✅ 浏览器通知（远程访问）
```

**适合有多台设备的情况**

---

## ⚙️ 详细配置

### 浏览器通知配置

无需配置，使用 `templates/admin/dashboard.html` 中的默认设置：
- 检测间隔：5秒
- 自动刷新：收到新订单后2秒刷新页面

### 微信通知配置

编辑 `wechat_notification_config.py`：

```python
# 启用/关闭
WECHAT_NOTIFICATION_ENABLED = True  lets False

# 通知类型
WECHAT_TYPE = 'enterprise'  # 'enterprise' 或 'mp'

# webhook地址
ENTERPRISE_WEBHOOK_URL = '你的webhook'
```

### 本地通知配置

编辑 `order_notification_config.py`：

```python
# 总开关
ENABLE_NOTIFICATION = True

# 桌面通知
ENABLE_DESKTOP_NOTIFICATION = True

# 语音播报
ENABLE_VOICE_NOTIFICATION = True

# 音效提醒
ENABLE_SOUND_NOTIFICATION = True

# 语音速度（50-300）
TTS_RATE = 150

# 语音音量（0.0-1.0）
TTS_VOLUME = 1.0
```

---

## 🔍 常见问题

### Q1: 浏览器通知没有反应？

**检查清单**：
1. 确认已点击"允许通知"
2. 检查浏览器控制台（F12）是否有错误
3. 确认页面地址包含 `/admin/dashboard`
4. 刷新页面重新尝试

### Q2: 微信通知收不到？

**检查清单**：
1. 确认 `WECHAT_NOTIFICATION_ENABLED = True`
2. 检查 webhook 地址是否正确
3. 测试 webhook 是否有效
4. 查看服务器日志 `app.log`

### Q3: 如何测试微信通知？

编辑 `wechat_notification_config.py`：
```python
WECHAT_NOTIFICATION_ENABLED = True
```

运行测试：
```bash
python wechat_notification.py
```

### Q4: 可以修改通知内容吗？

**可以！**

- 浏览器通知：编辑 `templates/admin/dashboard.html` 中的JavaScript
- 微信通知：编辑 `wechat_notification.py` 中的消息模板
- 本地通知：编辑 `order_notification.py` 中的函数

### Q5: 通知太频繁？

- **浏览器通知**：修改检测间隔（默认5秒）
- **微信通知**：可以通过代码过滤只通知重要订单
- **本地通知**：关闭不需要的通知类型

---

## 🛠️ 高级功能

### 自定义通知音效

浏览器通知的音效在 `templates/admin/dashboard.html` 中：

```javascript
function playNotificationSound() {
    const audio = new Audio('自定义音效文件.mp3');
    audio.volume = 0.5;
    audio.play();
}
```

### 添加@所有人

在微信通知中@所有群成员：

```python
message = {
    "msgtype": "text",
    "text": {
        "content": f"🛒 新订单提醒\\n订单号: {order_number}\\n@all"
    }
}
```

### 通知过滤

只通知特定来源的订单：

```python
# 在订单创建时添加判断
if source == '小程序':
    wechat_notify(...)
```

---

## 📞 技术支持

- **浏览器通知问题**: 检查浏览器控制台（F12）
- **微信通知问题**: 查看日志文件 `app.log`
- **配置问题**: 参考各配置文件中的注释

---

## 📝 更新日志

- **v1.0** (2025-01-01): 初始版本
  - 浏览器通知功能
  - 微信通知功能  
  - 本地通知功能

---

**最后更新**: 2025-01-01


