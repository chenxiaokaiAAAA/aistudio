# 冲印系统测试订单创建指南

## 🎯 测试流程概述

1. **配置厂家信息** → 2. **创建测试订单** → 3. **验证发送功能** → 4. **查看发送状态**

## 📋 第一步：配置厂家信息

### 1.1 获取厂家信息
联系厂家获取：
- **shop_id**: 您的影楼编号
- **shop_name**: 您的影楼名称
- **auth_token**: API认证Token（如果需要）

### 1.2 更新配置文件
编辑 `printer_config.py`：

```python
PRINTER_SYSTEM_CONFIG = {
    'enabled': True,
    'api_base_url': 'http://xmdmsm.xicp.cn:5995/api/ODSGate',
    'api_url': 'http://xmdmsm.xicp.cn:5995/api/ODSGate/NewOrder',
    'source_app_id': 'ZPG',  # ✅ 已配置
    'shop_id': '厂家提供的影楼编号',  # ❌ 需要更新
    'shop_name': '厂家提供的影楼名称',  # ❌ 需要更新
    'auth_token': '厂家提供的认证Token',  # ❌ 如果需要
    'callback_url': 'https://dev-camera-api.photogo520.com/open/xmdm/express/notify',
    'file_access_base_url': 'http://photogooo',
    'timeout': 30,
    'retry_times': 3,
}
```

## 🚀 第二步：创建测试订单

### 方法一：使用脚本自动创建（推荐）

```bash
python create_test_order.py
```

脚本会自动：
- 创建测试订单
- 生成测试图片文件
- 测试冲印系统发送
- 显示测试结果

### 方法二：手动在管理后台创建

1. **访问管理后台**：`http://photogooo/admin/`
2. **创建新订单**：
   - 客户姓名：测试客户
   - 客户电话：13800138000
   - 产品尺寸：选择任意尺寸
3. **上传图片**：
   - 上传原图（任意图片）
   - 上传成品图（任意图片）
   - 上传高清图（任意图片）
4. **设置状态**：将订单状态设置为"待发货"

## 🔍 第三步：测试发送功能

### 3.1 触发自动发送
1. **进入订单详情页面**
2. **将订单状态改为"高清放大"**
3. **系统自动发送到冲印系统**

### 3.2 查看发送状态
在订单详情页面查看：
- **冲印系统发送状态**：显示发送进度
- **发送时间**：记录发送时间
- **响应数据**：查看厂家系统响应

## 📊 第四步：验证测试结果

### 4.1 检查发送状态
- ✅ **发送成功**：状态显示"发送成功"，订单状态变为"已发货"
- ❌ **发送失败**：状态显示"发送失败"，查看错误信息

### 4.2 查看日志
检查服务器日志：
```bash
# 查看发送日志
tail -f logs/app.log  # 如果有日志文件
```

### 4.3 厂家系统验证
联系厂家确认：
- 订单是否成功接收
- 图片文件是否可正常下载
- 数据格式是否正确

## 🛠️ 故障排查

### 常见问题及解决方案

#### 1. 配置错误
```
❌ 错误：shop_id 或 shop_name 未配置
✅ 解决：更新 printer_config.py 配置文件
```

#### 2. 网络连接问题
```
❌ 错误：网络连接失败
✅ 解决：检查网络连接，确保能访问 xmdmsm.xicp.cn:5995
```

#### 3. 文件访问问题
```
❌ 错误：图片文件不存在
✅ 解决：确保高清图片已上传且文件存在
```

#### 4. API认证失败
```
❌ 错误：认证失败
✅ 解决：检查 auth_token 配置
```

## 📝 测试检查清单

- [ ] 厂家信息已配置（shop_id, shop_name）
- [ ] 测试订单已创建
- [ ] 测试图片已上传
- [ ] 订单状态设置为"待发货"
- [ ] 状态改为"高清放大"触发发送
- [ ] 发送状态显示"发送成功"
- [ ] 厂家确认收到订单
- [ ] 回调接口正常工作

## 🎉 测试成功标志

当您看到以下情况时，说明测试成功：

1. **管理后台显示**：
   - 冲印系统发送状态：✅ 发送成功
   - 订单状态：✅ 已发货
   - 发送时间：✅ 有具体时间

2. **厂家确认**：
   - 厂家系统收到订单
   - 图片文件可正常下载
   - 订单数据格式正确

3. **系统日志**：
   - 无错误信息
   - 发送成功日志

完成测试后，您的冲印系统就完全可用了！🎊

