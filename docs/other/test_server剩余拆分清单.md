# test_server.py å‰©ä½™æ‹†åˆ†æ¸…å•

## âœ… å·²å®Œæˆæ‹†åˆ†

1. âœ… **æŠ–éŸ³ç›¸å…³ä»£ç ** - å·²åˆ é™¤ï¼ˆçº¦140è¡Œï¼‰
2. âœ… **ä¼˜æƒ åˆ¸ç®¡ç†å‡½æ•°** - å·²åˆ é™¤ï¼ˆçº¦160è¡Œï¼‰
3. âœ… **è°ƒè¯•APIè·¯ç”±** - å·²è¿ç§»åˆ° `app/routes/debug_api.py`

## ğŸ“‹ è¿˜å¯ä»¥æ‹†åˆ†çš„å†…å®¹

### 1. æ¨¡æ¿è¿‡æ»¤å™¨ï¼ˆå¯é€‰æ‹†åˆ†ï¼‰

**ä½ç½®**: `test_server.py` ç¬¬348-465è¡Œ

**å‡½æ•°åˆ—è¡¨**:
- `size_name_filter()` - å°ºå¯¸åç§°è¿‡æ»¤å™¨ï¼ˆçº¦100è¡Œï¼‰
- `from_json_filter()` - JSONè§£æè¿‡æ»¤å™¨ï¼ˆçº¦5è¡Œï¼‰
- `product_id_filter()` - äº§å“IDè¿‡æ»¤å™¨ï¼ˆçº¦3è¡Œï¼‰

**å»ºè®®**: è¿ç§»åˆ° `app/utils/template_filters.py`

**ä¼˜ç‚¹**:
- å‡å°‘ `test_server.py` æ–‡ä»¶å¤§å°
- æ¨¡æ¿è¿‡æ»¤å™¨å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- ä¾¿äºå¤ç”¨

### 2. ä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼ˆå¯é€‰æ‹†åˆ†ï¼‰

**ä½ç½®**: `test_server.py` ç¬¬171-340è¡Œ

**å‡½æ•°**:
- `inject_server_config()` - æ³¨å…¥æœåŠ¡å™¨é…ç½®åˆ°æ¨¡æ¿ï¼ˆçº¦170è¡Œï¼‰

**å»ºè®®**: å¯ä»¥ä¿ç•™åœ¨ `test_server.py` æˆ–è¿ç§»åˆ° `app/utils/template_context.py`

**è¯´æ˜**: è¿™ä¸ªå‡½æ•°éœ€è¦è®¿é—® `app` å¯¹è±¡ï¼Œä¿ç•™åœ¨ `test_server.py` ä¸­ä¹Ÿæ˜¯åˆç†çš„

### 3. è¾…åŠ©å‡½æ•°ï¼ˆå¯é€‰æ‹†åˆ†ï¼‰

**ä½ç½®**: `test_server.py` å¤šå¤„

**å‡½æ•°åˆ—è¡¨**:
- `get_order_images(order_id)` - è·å–è®¢å•å›¾ç‰‡åˆ—è¡¨ï¼ˆçº¦4è¡Œï¼‰
- `get_referrer_user_id(invitee_user_id)` - è·å–æ¨èäººIDï¼ˆçº¦20è¡Œï¼‰
- `send_subscribe_message()` - å‘é€è®¢é˜…æ¶ˆæ¯ï¼ˆçº¦60è¡Œï¼‰
- `send_order_completion_notification_auto()` - è‡ªåŠ¨å‘é€è®¢å•å®Œæˆé€šçŸ¥ï¼ˆçº¦40è¡Œï¼‰
- `send_commission_notification_auto()` - è‡ªåŠ¨å‘é€æ¨å¹¿æ”¶ç›Šé€šçŸ¥ï¼ˆçº¦30è¡Œï¼‰

**å»ºè®®**: 
- `get_order_images` â†’ `app/services/order_service.py` æˆ– `app/utils/order_helpers.py`
- `get_referrer_user_id` â†’ `app/services/promotion_service.py`
- `send_subscribe_message` â†’ `app/services/notification_service.py`
- `send_order_completion_notification_auto` â†’ `app/services/notification_service.py`
- `send_commission_notification_auto` â†’ `app/services/notification_service.py`

### 4. å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆå¯é€‰æ‹†åˆ†ï¼‰

**ä½ç½®**: `test_server.py` ç¬¬296-348è¡Œ

**å‡½æ•°åˆ—è¡¨**:
- `async_worker()` - å¼‚æ­¥å·¥ä½œçº¿ç¨‹ï¼ˆçº¦20è¡Œï¼‰
- `submit_async_task()` - æäº¤å¼‚æ­¥ä»»åŠ¡ï¼ˆçº¦30è¡Œï¼‰

**å»ºè®®**: è¿ç§»åˆ° `app/utils/async_tasks.py` æˆ– `app/services/task_service.py`

## ğŸ¯ æ‹†åˆ†ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå»ºè®®æ‹†åˆ†ï¼‰

1. **æ¨¡æ¿è¿‡æ»¤å™¨** â†’ `app/utils/template_filters.py`
   - ä»£ç æ¸…æ™°ï¼Œæ˜“äºæ‹†åˆ†
   - å‡å°‘ `test_server.py` çº¦110è¡Œ

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¯é€‰æ‹†åˆ†ï¼‰

2. **é€šçŸ¥ç›¸å…³å‡½æ•°** â†’ `app/services/notification_service.py`
   - `send_subscribe_message`
   - `send_order_completion_notification_auto`
   - `send_commission_notification_auto`
   - å‡å°‘ `test_server.py` çº¦130è¡Œ

3. **è®¢å•è¾…åŠ©å‡½æ•°** â†’ `app/services/order_service.py` æˆ–æ–°å»º `app/utils/order_helpers.py`
   - `get_order_images`
   - å‡å°‘ `test_server.py` çº¦4è¡Œ

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯ä»¥ä¿ç•™ï¼‰

4. **ä¸Šä¸‹æ–‡å¤„ç†å™¨** - å¯ä»¥ä¿ç•™åœ¨ `test_server.py`
   - éœ€è¦è®¿é—® `app` å¯¹è±¡
   - ä¿ç•™åœ¨å…¥å£æ–‡ä»¶ä¸­æ˜¯åˆç†çš„

5. **å¼‚æ­¥ä»»åŠ¡å¤„ç†** - å¯ä»¥ä¿ç•™åœ¨ `test_server.py`
   - å¦‚æœä½¿ç”¨é¢‘ç‡ä¸é«˜ï¼Œå¯ä»¥ä¿ç•™

## ğŸ“Š æ‹†åˆ†åé¢„æœŸ

### å¦‚æœæ‹†åˆ†æ‰€æœ‰å¯é€‰å†…å®¹

- **å‡å°‘è¡Œæ•°**: çº¦ 250-300 è¡Œ
- **test_server.py æœ€ç»ˆå¤§å°**: çº¦ 1,700-1,800 è¡Œ
- **æ–°å¢æ–‡ä»¶**: 2-3 ä¸ªå·¥å…·/æœåŠ¡æ–‡ä»¶

### å¦‚æœåªæ‹†åˆ†é«˜ä¼˜å…ˆçº§

- **å‡å°‘è¡Œæ•°**: çº¦ 110 è¡Œ
- **test_server.py æœ€ç»ˆå¤§å°**: çº¦ 1,900 è¡Œ
- **æ–°å¢æ–‡ä»¶**: 1 ä¸ªå·¥å…·æ–‡ä»¶

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡æ¿è¿‡æ»¤å™¨æ‹†åˆ†**:
   - éœ€è¦åœ¨ `test_server.py` ä¸­æ³¨å†Œè¿‡æ»¤å™¨
   - ä½¿ç”¨ `app.template_filter()` æ³¨å†Œ

2. **æœåŠ¡å‡½æ•°æ‹†åˆ†**:
   - éœ€è¦ç¡®ä¿å…¶ä»–æ¨¡å—å¯ä»¥æ­£ç¡®å¯¼å…¥
   - æ³¨æ„å¾ªç¯å¯¼å…¥é—®é¢˜

3. **æµ‹è¯•**:
   - æ‹†åˆ†åéœ€è¦æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
   - ç¡®ä¿æ¨¡æ¿æ¸²æŸ“æ­£å¸¸
   - ç¡®ä¿é€šçŸ¥åŠŸèƒ½æ­£å¸¸

## ğŸ¯ å»ºè®®æ‹†åˆ†é¡ºåº

1. **ç¬¬ä¸€æ­¥**: æ‹†åˆ†æ¨¡æ¿è¿‡æ»¤å™¨ï¼ˆæœ€ç®€å•ï¼Œé£é™©æœ€å°ï¼‰
2. **ç¬¬äºŒæ­¥**: æ‹†åˆ†é€šçŸ¥ç›¸å…³å‡½æ•°ï¼ˆå¦‚æœä½¿ç”¨é¢‘ç‡é«˜ï¼‰
3. **ç¬¬ä¸‰æ­¥**: æ‹†åˆ†å…¶ä»–è¾…åŠ©å‡½æ•°ï¼ˆæ ¹æ®å®é™…éœ€è¦ï¼‰

---

**æœ€åæ›´æ–°**: 2026-02-01
