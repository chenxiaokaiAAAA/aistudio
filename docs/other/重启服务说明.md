# 重启服务说明

## ✅ 需要重启的内容

### 1. 后端服务（必须重启）

**原因：**
- 修改了 `test_server.py` 中的代码
- 添加了开发模式跳过openid验证
- 修改了openid接口返回格式
- 注释掉了通知系统

**重启方法：**

#### 方法1：如果服务正在运行
1. 在运行服务的终端按 `Ctrl+C` 停止服务
2. 重新运行：
   ```bash
   cd AI-studio
   python start.py
   ```

#### 方法2：如果服务在后台运行
1. 找到Python进程并结束：
   ```bash
   # Windows PowerShell
   Get-Process python | Where-Object {$_.Path -like "*AI-studio*"} | Stop-Process
   ```
2. 重新启动：
   ```bash
   cd AI-studio
   python start.py
   ```

### 2. 小程序（必须重新编译）

**原因：**
- 修改了 `pages/payment/payment.js`
- 添加了config引用
- 添加了开发模式跳过支付
- 添加了openid容错处理

**重新编译方法：**
1. 在微信开发者工具中
2. 点击"编译"按钮（或按 `Ctrl+B`）
3. 或者点击"清除缓存" → "重新编译"

## 🔍 验证服务是否正常运行

### 检查后端服务
```bash
# 在浏览器或命令行测试
curl http://192.168.2.54:8000/api/miniprogram
```

应该返回：
```json
{
  "status": "success",
  "message": "小程序API服务正常"
}
```

### 检查openid接口（开发模式）
```bash
curl -X POST http://192.168.2.54:8000/api/user/openid \
  -H "Content-Type: application/json" \
  -d "{\"code\":\"test\"}"
```

应该返回：
```json
{
  "success": true,
  "openid": "test_openid_xxxxxxxx",
  "message": "开发模式：使用测试openid"
}
```

## 📝 重启后的测试步骤

1. **后端服务**
   - 访问：`http://192.168.2.54:8000/api/miniprogram`
   - 应该看到"小程序API服务正常"

2. **小程序**
   - 清除缓存并重新编译
   - 测试创建订单流程
   - 测试支付流程（开发模式会跳过真实支付）

3. **完整流程测试**
   - 创建证件照订单
   - 填写订单信息
   - 确认支付（开发模式直接完成）
   - 查看订单列表
   - 点击"显示二维码"

## ⚠️ 注意事项

1. **后端服务必须重启**
   - Python代码修改后必须重启才能生效
   - 如果不重启，openid接口仍然会使用旧代码

2. **小程序必须重新编译**
   - JavaScript代码修改后需要重新编译
   - 建议清除缓存后再编译

3. **开发模式已启用**
   - OpenID：使用测试openid
   - 支付：跳过真实支付
   - 方便测试完整流程

## 🚀 快速重启命令

### Windows PowerShell
```powershell
# 停止现有服务（如果有）
Get-Process python | Where-Object {$_.MainWindowTitle -like "*start.py*" -or $_.CommandLine -like "*test_server*"} | Stop-Process -Force

# 启动服务
cd AI-studio
python start.py
```

### 或者使用批处理文件
```bash
cd AI-studio
# 如果有停止脚本，先运行停止脚本
python start.py
```
