# 店员权限配置说明

## 功能说明

小程序端团购核销功能需要配置店员权限，只有被授权的店员才能在小程序中看到"团购核销"入口并进行核销操作。

## 配置方式

### 方式1：通过系统配置表（推荐）

在 `ai_configs` 表中添加一条配置记录：

```sql
INSERT INTO ai_configs (config_key, config_value, description) 
VALUES ('staff_openids', '["openid1", "openid2", "userid1"]', '店员openid列表（JSON格式）');
```

或者通过管理后台的系统配置页面添加：
- 配置键：`staff_openids`
- 配置值：JSON数组格式，例如：`["oXXXXX1", "oXXXXX2"]`
- 说明：店员openid列表

### 方式2：创建Staff表（未来扩展）

可以创建一个专门的Staff表来管理店员信息，包含更多字段如姓名、手机号、门店等。

## 使用流程

1. **配置店员权限**：在系统配置中添加店员的openid或user_id
2. **店员登录小程序**：店员使用自己的微信登录小程序
3. **查看入口**：在"我的"页面，店员可以看到"团购核销"入口（黄色背景，区别于普通功能）
4. **进行核销**：
   - 点击"团购核销"进入核销页面
   - 输入团购订单号、核销金额、客户信息
   - 点击"确认核销"
   - 系统生成随机码免拍券和二维码
   - 用户扫码即可领取优惠券

## 权限检查

- 小程序端：通过 `/api/miniprogram/groupon/check-staff` API检查权限
- 后端API：在 `/api/miniprogram/groupon/verify` 中也会进行权限验证
- 如果权限不足，会返回403错误

## 注意事项

1. 目前默认允许所有用户使用（开发阶段），生产环境需要严格配置权限
2. openid和user_id都可以用于权限验证
3. 店员列表更新后，需要重新登录小程序才能生效
