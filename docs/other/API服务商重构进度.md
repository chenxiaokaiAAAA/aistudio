# APIæœåŠ¡å•†é‡æ„è¿›åº¦

## âœ… å·²å®Œæˆï¼ˆç¬¬ä¸€é˜¶æ®µ + ç¬¬äºŒé˜¶æ®µï¼‰

### 1. åŸºç¡€æ¶æ„
- âœ… åˆ›å»º `app/services/api_providers/` ç›®å½•
- âœ… å®ç° `base.py` åŸºç¡€æŠ½è±¡ç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
- âœ… å®ç° `__init__.py` æœåŠ¡å•†æ³¨å†Œæœºåˆ¶

### 2. æ‰€æœ‰æœåŠ¡å•†å®ç°ï¼ˆ6ä¸ªï¼‰
- âœ… `nano_banana_provider.py` - nano-banana æœåŠ¡å•†
- âœ… `nano_banana_edits_provider.py` - nano-banana-edits æœåŠ¡å•†
- âœ… `gemini_native_provider.py` - gemini-native æœåŠ¡å•†
- âœ… `runninghub_rhart_edit_provider.py` - runninghub-rhart-edit æœåŠ¡å•†
- âœ… `runninghub_comfyui_workflow_provider.py` - runninghub-comfyui-workflow æœåŠ¡å•†
- âœ… `veo_video_provider.py` - veo-video æœåŠ¡å•†

### 3. å‘åå…¼å®¹
- âœ… ä¿®æ”¹ `ai_provider_service.py` çš„ `call_api_with_config` å‡½æ•°
  - ä¼˜å…ˆå°è¯•ä½¿ç”¨æ–°çš„æ¨¡å—åŒ–å®ç°
  - å¦‚æœæ–°å®ç°ä¸å¯ç”¨æˆ–å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°æ—§ä»£ç 
  - ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

## ğŸ“‹ æ–‡ä»¶ç»“æ„

```
aistudio/app/services/api_providers/
â”œâ”€â”€ __init__.py                           # æœåŠ¡å•†æ³¨å†Œæœºåˆ¶
â”œâ”€â”€ base.py                               # åŸºç¡€æŠ½è±¡ç±»
â”œâ”€â”€ nano_banana_provider.py               # nano-banana æœåŠ¡å•†å®ç° âœ…
â”œâ”€â”€ nano_banana_edits_provider.py        # nano-banana-edits æœåŠ¡å•†å®ç° âœ…
â”œâ”€â”€ gemini_native_provider.py             # gemini-native æœåŠ¡å•†å®ç° âœ…
â”œâ”€â”€ runninghub_rhart_edit_provider.py    # runninghub-rhart-edit æœåŠ¡å•†å®ç° âœ…
â”œâ”€â”€ runninghub_comfyui_workflow_provider.py  # runninghub-comfyui-workflow æœåŠ¡å•†å®ç° âœ…
â””â”€â”€ veo_video_provider.py                 # veo-video æœåŠ¡å•†å®ç° âœ…
```

## ğŸ”„ å·¥ä½œåŸç†

### è°ƒç”¨æµç¨‹
1. `call_api_with_config` å‡½æ•°è¢«è°ƒç”¨
2. æ£€æŸ¥æ˜¯å¦æ”¯æŒè¯¥æœåŠ¡å•†ç±»å‹ï¼ˆé€šè¿‡ `is_provider_supported`ï¼‰
3. å¦‚æœæ”¯æŒï¼Œä½¿ç”¨æ–°çš„æ¨¡å—åŒ–å®ç°
4. å¦‚æœä¸æ”¯æŒæˆ–å¤±è´¥ï¼Œå›é€€åˆ°æ—§ä»£ç 

### æœåŠ¡å•†æ³¨å†Œ
- æœåŠ¡å•†ç±»åœ¨ `__init__.py` ä¸­è‡ªåŠ¨æ³¨å†Œ
- é€šè¿‡ `register_provider(api_type, provider_class)` æ³¨å†Œ
- é€šè¿‡ `get_provider(api_config)` è·å–å®ä¾‹

## ğŸ“ åç»­æ­¥éª¤

### é˜¶æ®µ2ï¼šè¿ç§»å…¶ä»–æœåŠ¡å•†ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

1. âœ… **nano-banana-edits**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰- **å·²å®Œæˆ**
   - âœ… åˆ›å»º `nano_banana_edits_provider.py`
   - âœ… è¿ç§»ç¼–è¾‘APIçš„é€»è¾‘ï¼ˆmultipart/form-dataæ ¼å¼ï¼‰
   - âœ… æ”¯æŒT8Starç‰¹æ®Šå¤„ç†ï¼ˆGETè½®è¯¢ã€asyncå‚æ•°ï¼‰
   - âœ… æ”¯æŒå¤šå›¾ä¸Šä¼ 

2. âœ… **gemini-native**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰- **å·²å®Œæˆ**
   - âœ… åˆ›å»º `gemini_native_provider.py`
   - âœ… è¿ç§»GeminiåŸç”ŸAPIçš„é€»è¾‘ï¼ˆbase64å›¾ç‰‡ç¼–ç ï¼‰
   - âœ… æ”¯æŒå¤šç§æœåŠ¡å•†ï¼ˆGoogleç›´æ¥è°ƒç”¨ã€ä»£ç†æœåŠ¡å™¨ã€T8Starï¼‰
   - âœ… æ”¯æŒåŒæ­¥APIç‰¹æ®Šå¤„ç†ï¼ˆç¦ç”¨é‡è¯•ã€è¶…æ—¶è®¾ç½®ï¼‰
   - âœ… æ”¯æŒ request_data_for_log ç”¨äºå‰ç«¯æ˜¾ç¤º

3. âœ… **runninghub-rhart-edit**ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰- **å·²å®Œæˆ**
   - âœ… åˆ›å»º `runninghub_rhart_edit_provider.py`
   - âœ… è¿ç§»RunningHubå…¨èƒ½å›¾ç‰‡PROçš„é€»è¾‘
   - âœ… æ”¯æŒ imageUrls æ•°ç»„ï¼ˆæœ€å¤š10å¼ å›¾ç‰‡ï¼‰
   - âœ… æ”¯æŒæ–°æ—§ä¸¤ç§è½®è¯¢æ ¼å¼ï¼ˆ/openapi/v2/query å’Œ /task/openapi/outputsï¼‰

4. âœ… **runninghub-comfyui-workflow**ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰- **å·²å®Œæˆ**
   - âœ… åˆ›å»º `runninghub_comfyui_workflow_provider.py`
   - âœ… è¿ç§»RunningHub ComfyUIå·¥ä½œæµçš„é€»è¾‘
   - âœ… æ”¯æŒä» request_body_template æ„å»ºè¯·æ±‚ä½“
   - âœ… æ”¯æŒå ä½ç¬¦æ›¿æ¢ï¼ˆ{{image_url}}, {{prompt}}ç­‰ï¼‰
   - âœ… æ”¯æŒå·¥ä½œæµéªŒè¯é”™è¯¯è§£æï¼ˆcode: 433ï¼‰

5. âœ… **veo-video**ï¼ˆä½ä¼˜å…ˆçº§ï¼‰- **å·²å®Œæˆ**
   - âœ… åˆ›å»º `veo_video_provider.py`
   - âœ… è¿ç§»VEOè§†é¢‘ç”Ÿæˆçš„é€»è¾‘
   - âœ… æ”¯æŒæ ¹æ®æ¨¡å‹é™åˆ¶å›¾ç‰‡æ•°é‡ï¼ˆ1-3å¼ ï¼‰
   - âœ… æ”¯æŒå¼‚æ­¥æ¨¡å¼ï¼ˆT8Starï¼‰
   - âœ… æ”¯æŒ enhance_prompt å‚æ•°
   - âœ… æ”¯æŒé•¿è¶…æ—¶æ—¶é—´ï¼ˆ30-300ç§’ï¼‰

### é˜¶æ®µ3ï¼šè½®è¯¢æœåŠ¡é‡æ„

- ä¿®æ”¹ `ai_task_polling_service.py`
- ä½¿ç”¨æœåŠ¡å•†çš„ `build_polling_request` å’Œ `parse_polling_response` æ–¹æ³•
- ä¿æŒå‘åå…¼å®¹

### é˜¶æ®µ4ï¼šæ¸…ç†æ—§ä»£ç 

- æ‰€æœ‰æœåŠ¡å•†è¿ç§»å®Œæˆå
- ç§»é™¤ `ai_provider_service.py` ä¸­çš„æ—§å®ç°
- ä¿ç•™ç»Ÿä¸€å…¥å£å‡½æ•°

## ğŸ¯ ä¼˜åŠ¿

1. **æ¸è¿›å¼è¿ç§»**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½
2. **å‘åå…¼å®¹**ï¼šæ—§ä»£ç å’Œæ–°ä»£ç å¹¶å­˜
3. **æ˜“äºæµ‹è¯•**ï¼šæ¯ä¸ªæœåŠ¡å•†å¯ä»¥ç‹¬ç«‹æµ‹è¯•
4. **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°æœåŠ¡å•†åªéœ€æ–°å»ºæ–‡ä»¶

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•**ï¼šæ¯æ¬¡è¿ç§»ä¸€ä¸ªæœåŠ¡å•†åï¼Œéƒ½è¦å……åˆ†æµ‹è¯•
2. **æ—¥å¿—**ï¼šæ–°å®ç°ä¼šæ‰“å° `âœ… ä½¿ç”¨æ¨¡å—åŒ–æœåŠ¡å•†å®ç°` æ—¥å¿—
3. **å›é€€**ï¼šå¦‚æœæ–°å®ç°å¤±è´¥ï¼Œä¼šè‡ªåŠ¨å›é€€åˆ°æ—§ä»£ç 
4. **å…¼å®¹æ€§**ï¼šç¡®ä¿æ–°å®ç°çš„æ¥å£ä¸æ—§ä»£ç å…¼å®¹

## ğŸ” å¦‚ä½•éªŒè¯

1. æŸ¥çœ‹æ—¥å¿—ï¼šå¦‚æœçœ‹åˆ° `âœ… ä½¿ç”¨æ¨¡å—åŒ–æœåŠ¡å•†å®ç°: nano-banana`ï¼Œè¯´æ˜æ–°å®ç°å·²ç”Ÿæ•ˆ
2. æµ‹è¯•åŠŸèƒ½ï¼šä½¿ç”¨ nano-banana ç±»å‹çš„APIé…ç½®è¿›è¡Œæµ‹è¯•
3. æ£€æŸ¥é”™è¯¯ï¼šå¦‚æœæ–°å®ç°æœ‰é—®é¢˜ï¼Œä¼šè‡ªåŠ¨å›é€€åˆ°æ—§ä»£ç 
