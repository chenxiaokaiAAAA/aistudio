# 小程序风格/产品关联问题排查

## 现象
- 产品馆看不到分类、该分类下没有产品
- 风格库产品关联没了
- 加载慢、switchTab 超时

## 排查步骤

### 1. 运行诊断脚本
```bash
python scripts/database/check_product_style_associations.py
```
或双击 `scripts/tools/check_product_associations.bat`

脚本会输出：
- 一级/二级分类列表
- 每个产品的 category_id、subcategory_id
- 产品-风格绑定关系
- 未设置分类/未绑定风格的产品

### 2. 常见原因与修复

| 问题 | 原因 | 修复 |
|------|------|------|
| 该分类下没有产品 | 产品的 category_id/subcategory_id 未设置或与分类不匹配 | 管理后台 → 产品管理 → 编辑产品 → 选择一级/二级分类 |
| 风格关联没了 | product_style_categories 表无绑定记录 | 管理后台 → 产品管理 → 编辑产品 → 绑定风格分类 |
| 分类表为空 | product_categories 未初始化 | 运行 `python scripts/database/add_product_categories.py` |
| HTTP 图片不显示 | 本地开发用 HTTP，小程序新版本限制 | 开发者工具 → 详情 → 本地设置 → 勾选「不校验合法域名」 |
| switchTab 超时 | 首页加载慢、网络请求多 | 已加 100ms 延迟和 reLaunch 兜底；可检查首页 API 是否超时 |

### 3. 已做的代码优化
- **产品馆**：当某分类下无产品时，自动回退显示全部产品（避免空白）
- **登录跳转**：switchTab 前加 100ms 延迟，失败时自动 reLaunch
- **产品分类接口**：移除错误缓存，避免返回异常数据
