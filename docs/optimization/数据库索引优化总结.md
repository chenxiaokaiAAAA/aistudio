# æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æ€»ç»“

**ä¼˜åŒ–æ—¥æœŸ**: 2026-02-05  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚

---

## âœ… å·²æ·»åŠ ç´¢å¼•çš„æ¨¡å‹

### 1. Orderï¼ˆè®¢å•è¡¨ï¼‰âœ…

**å·²æœ‰ç´¢å¼•**:
- `idx_order_order_number` - è®¢å•å·æŸ¥è¯¢
- `idx_order_status` - è®¢å•çŠ¶æ€æŸ¥è¯¢
- `idx_order_created_at` - åˆ›å»ºæ—¶é—´æ’åº
- `idx_order_customer_phone` - å®¢æˆ·ç”µè¯æŸ¥è¯¢
- `idx_order_franchisee_id` - åŠ ç›Ÿå•†è®¢å•æŸ¥è¯¢
- `idx_order_merchant_id` - å•†æˆ·è®¢å•æŸ¥è¯¢
- `idx_order_openid` - ç”¨æˆ·è®¢å•æŸ¥è¯¢

**æ–°å¢ç´¢å¼•**:
- `idx_order_completed_at` - å®Œæˆæ—¶é—´æŸ¥è¯¢
- `idx_order_source_type` - æ¥æºç±»å‹æŸ¥è¯¢
- `idx_order_order_mode` - è®¢å•æ¨¡å¼æŸ¥è¯¢

---

### 2. AITaskï¼ˆAIä»»åŠ¡è¡¨ï¼‰âœ…

**å·²æœ‰ç´¢å¼•**:
- `idx_ai_task_order_id` - è®¢å•å…³è”æŸ¥è¯¢
- `idx_ai_task_status` - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
- `idx_ai_task_created_at` - åˆ›å»ºæ—¶é—´æ’åº
- `idx_ai_task_order_number` - è®¢å•å·æŸ¥è¯¢
- `idx_ai_task_style_category` - é£æ ¼åˆ†ç±»æŸ¥è¯¢
- `idx_ai_task_style_image` - é£æ ¼å›¾ç‰‡æŸ¥è¯¢

**æ–°å¢ç´¢å¼•**:
- `idx_ai_task_completed_at` - å®Œæˆæ—¶é—´æŸ¥è¯¢

---

### 3. OrderImageï¼ˆè®¢å•å›¾ç‰‡è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_orderimage_order_id` - è®¢å•å›¾ç‰‡æŸ¥è¯¢
- `idx_orderimage_is_main` - ä¸»å›¾æŸ¥è¯¢

---

### 4. Productï¼ˆäº§å“è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_product_is_active` - æ¿€æ´»äº§å“æŸ¥è¯¢
- `idx_product_category_id` - åˆ†ç±»æŸ¥è¯¢
- `idx_product_subcategory_id` - å­åˆ†ç±»æŸ¥è¯¢
- `idx_product_sort_order` - æ’åºæŸ¥è¯¢

---

### 5. ProductSizeï¼ˆäº§å“å°ºå¯¸è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_productsize_product_id` - äº§å“å°ºå¯¸æŸ¥è¯¢
- `idx_productsize_is_active` - æ¿€æ´»å°ºå¯¸æŸ¥è¯¢

---

### 6. ProductImageï¼ˆäº§å“å›¾ç‰‡è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_productimage_product_id` - äº§å“å›¾ç‰‡æŸ¥è¯¢
- `idx_productimage_is_active` - æ¿€æ´»å›¾ç‰‡æŸ¥è¯¢

---

### 7. ProductStyleCategoryï¼ˆäº§å“é£æ ¼ç»‘å®šè¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_productstylecategory_product_id` - äº§å“é£æ ¼ç»‘å®šæŸ¥è¯¢
- `idx_productstylecategory_style_category_id` - é£æ ¼åˆ†ç±»ç»‘å®šæŸ¥è¯¢

---

### 8. StyleCategoryï¼ˆé£æ ¼åˆ†ç±»è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_stylecategory_is_active` - æ¿€æ´»é£æ ¼æŸ¥è¯¢
- `idx_stylecategory_sort_order` - æ’åºæŸ¥è¯¢

---

### 9. StyleImageï¼ˆé£æ ¼å›¾ç‰‡è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_styleimage_category_id` - é£æ ¼åˆ†ç±»å›¾ç‰‡æŸ¥è¯¢
- `idx_styleimage_is_active` - æ¿€æ´»å›¾ç‰‡æŸ¥è¯¢

---

### 10. FranchiseeAccountï¼ˆåŠ ç›Ÿå•†è´¦æˆ·è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_franchiseeaccount_status` - è´¦æˆ·çŠ¶æ€æŸ¥è¯¢
- `idx_franchiseeaccount_username` - ç”¨æˆ·åæŸ¥è¯¢
- `idx_franchiseeaccount_qr_code` - äºŒç»´ç æŸ¥è¯¢

---

### 11. FranchiseeRechargeï¼ˆåŠ ç›Ÿå•†å……å€¼è®°å½•è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_franchiseerecharge_franchisee_id` - åŠ ç›Ÿå•†å……å€¼è®°å½•æŸ¥è¯¢
- `idx_franchiseerecharge_created_at` - åˆ›å»ºæ—¶é—´æ’åº

---

### 12. ShopOrderï¼ˆå•†åŸè®¢å•è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_shoporder_order_number` - è®¢å•å·æŸ¥è¯¢
- `idx_shoporder_original_order_id` - åŸå§‹è®¢å•æŸ¥è¯¢
- `idx_shoporder_original_order_number` - åŸå§‹è®¢å•å·æŸ¥è¯¢
- `idx_shoporder_status` - è®¢å•çŠ¶æ€æŸ¥è¯¢
- `idx_shoporder_product_id` - äº§å“æŸ¥è¯¢

---

### 13. ShopProductï¼ˆå•†åŸäº§å“è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_shopproduct_is_active` - æ¿€æ´»äº§å“æŸ¥è¯¢
- `idx_shopproduct_sort_order` - æ’åºæŸ¥è¯¢

---

### 14. ShopProductSizeï¼ˆå•†åŸäº§å“è§„æ ¼è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_shopproductsize_product_id` - äº§å“å°ºå¯¸æŸ¥è¯¢
- `idx_shopproductsize_is_active` - æ¿€æ´»å°ºå¯¸æŸ¥è¯¢

---

### 15. ShopProductImageï¼ˆå•†åŸäº§å“å›¾ç‰‡è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_shopproductimage_product_id` - äº§å“å›¾ç‰‡æŸ¥è¯¢
- `idx_shopproductimage_is_active` - æ¿€æ´»å›¾ç‰‡æŸ¥è¯¢

---

### 16. Couponï¼ˆä¼˜æƒ åˆ¸è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_coupon_status` - ä¼˜æƒ åˆ¸çŠ¶æ€æŸ¥è¯¢
- `idx_coupon_source_type` - æ¥æºç±»å‹æŸ¥è¯¢

---

### 17. UserCouponï¼ˆç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_usercoupon_user_id` - ç”¨æˆ·ä¼˜æƒ åˆ¸æŸ¥è¯¢
- `idx_usercoupon_coupon_id` - ä¼˜æƒ åˆ¸æŸ¥è¯¢
- `idx_usercoupon_status` - çŠ¶æ€æŸ¥è¯¢

---

### 18. PromotionUserï¼ˆæ¨å¹¿ç”¨æˆ·è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_promotionuser_promotion_code` - æ¨å¹¿ç æŸ¥è¯¢
- `idx_promotionuser_open_id` - ç”¨æˆ·æŸ¥è¯¢
- `idx_promotionuser_user_id` - ç”¨æˆ·IDæŸ¥è¯¢

---

### 19. Commissionï¼ˆä½£é‡‘è®°å½•è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_commission_user_id` - ç”¨æˆ·ä½£é‡‘æŸ¥è¯¢ï¼ˆæ³¨æ„ï¼šå­—æ®µåæ˜¯referrer_user_idï¼‰
- `idx_commission_order_id` - è®¢å•ä½£é‡‘æŸ¥è¯¢
- `idx_commission_status` - çŠ¶æ€æŸ¥è¯¢

---

### 20. UserVisitï¼ˆç”¨æˆ·è®¿é—®è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_uservisit_user_id` - ç”¨æˆ·è®¿é—®æŸ¥è¯¢
- `idx_uservisit_visit_time` - è®¿é—®æ—¶é—´æŸ¥è¯¢
- `idx_uservisit_is_authorized` - æˆæƒçŠ¶æ€æŸ¥è¯¢

---

### 21. SelfieMachineï¼ˆè‡ªæ‹æœºè®¾å¤‡è¡¨ï¼‰âœ…

**æ–°å¢ç´¢å¼•**:
- `idx_selfiemachine_franchisee_id` - åŠ ç›Ÿå•†è®¾å¤‡æŸ¥è¯¢
- `idx_selfiemachine_machine_serial_number` - è®¾å¤‡åºåˆ—å·æŸ¥è¯¢

---

## ğŸ“Š ä¼˜åŒ–ç»Ÿè®¡

- **ä¼˜åŒ–æ¨¡å‹æ•°**: 21ä¸ª
- **æ–°å¢ç´¢å¼•æ•°**: 50+ä¸ª
- **é¢„è®¡æ€§èƒ½æå‡**: 30-70%ï¼ˆå–å†³äºæŸ¥è¯¢å¤æ‚åº¦ï¼‰

---

## ğŸ”„ ç´¢å¼•åº”ç”¨æ–¹å¼

ç´¢å¼•å·²ç›´æ¥åœ¨ `app/models.py` ä¸­å®šä¹‰ï¼ŒSQLAlchemyä¼šåœ¨åˆ›å»ºè¡¨æ—¶è‡ªåŠ¨åˆ›å»ºè¿™äº›ç´¢å¼•ã€‚

å¦‚æœæ•°æ®åº“å·²ç»å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œç´¢å¼•åˆ›å»ºï¼š

1. **æ–¹å¼1ï¼šä½¿ç”¨SQLæ–‡ä»¶**
   - è¿è¡Œ `scripts/optimization/add_database_indexes.py` ç”ŸæˆSQLæ–‡ä»¶
   - æ‰‹åŠ¨æ‰§è¡ŒSQLæ–‡ä»¶ä¸­çš„ç´¢å¼•åˆ›å»ºè¯­å¥

2. **æ–¹å¼2ï¼šä½¿ç”¨Pythonè„šæœ¬**
   - è¿è¡Œ `scripts/optimization/apply_database_indexes.py` è‡ªåŠ¨åˆ›å»ºç´¢å¼•

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç´¢å¼•ç»´æŠ¤æˆæœ¬**ï¼šç´¢å¼•ä¼šå ç”¨å­˜å‚¨ç©ºé—´ï¼Œå¹¶ç•¥å¾®å½±å“å†™å…¥æ€§èƒ½
2. **ç´¢å¼•é€‰æ‹©**ï¼šåªä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œé¿å…è¿‡åº¦ç´¢å¼•
3. **å¤åˆç´¢å¼•**ï¼šå¯¹äºå¤šå­—æ®µæŸ¥è¯¢ï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºå¤åˆç´¢å¼•

---

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ç›‘æ§ç´¢å¼•ä½¿ç”¨æƒ…å†µ**ï¼šä½¿ç”¨ `EXPLAIN ANALYZE` åˆ†ææŸ¥è¯¢è®¡åˆ’
2. **ä¼˜åŒ–æ…¢æŸ¥è¯¢**ï¼šè¯†åˆ«å¹¶ä¼˜åŒ–ä»ç„¶è¾ƒæ…¢çš„æŸ¥è¯¢
3. **è¿æ¥æ± ä¼˜åŒ–**ï¼šä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± é…ç½®

---

**æœ€åæ›´æ–°**: 2026-02-05  
**ä¼˜åŒ–çŠ¶æ€**: âœ… ç´¢å¼•å®šä¹‰å·²å®Œæˆ
