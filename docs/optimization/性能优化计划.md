# 性能优化计划

**开始日期**: 2026-02-04  
**状态**: 📋 进行中

---

## 🎯 优化目标

1. **API响应优化**: 减少响应时间，提升用户体验
2. **数据库查询优化**: 减少查询次数，优化查询性能
3. **图片处理优化**: 压缩、缩略图、CDN

---

## 📋 优化任务清单

### 任务1: API分页优化 ⭐⭐⭐

**问题**: 多个接口使用 `.all()` 查询所有数据，然后在内存中分页

**影响接口**:
1. `admin_orders_list_api.py` - 订单列表（第76行）
2. `franchisee/frontend.py` - 加盟商订单列表（第341行）
3. 其他可能存在的接口

**优化方案**:
- 使用数据库层面的分页（`paginate()`）
- 在分组前先分页，或使用窗口函数优化

**预计时间**: 2-3小时

---

### 任务2: 导出功能优化 ⭐⭐

**问题**: 导出功能查询所有订单，可能导致内存溢出

**影响接口**:
1. `admin_orders_list_api.py` - 订单导出（第210行、378行）

**优化方案**:
- 使用流式导出（分批查询）
- 添加数据量限制
- 使用后台任务处理大文件导出

**预计时间**: 2-3小时

---

### 任务3: 图片处理优化 ⭐⭐

**问题**: 图片上传后未自动压缩和生成缩略图

**优化方案**:
- 自动压缩大图片
- 生成多尺寸缩略图
- 支持WebP格式

**预计时间**: 1-2天

---

### 任务4: 响应压缩 ⭐

**问题**: API响应未压缩

**优化方案**:
- 启用gzip压缩
- 压缩JSON响应

**预计时间**: 1小时

---

## 📝 优化执行记录

### 已完成
- ✅ 创建性能分析工具
- ✅ 创建备份

### 进行中
- 📋 优化订单列表分页

### 待执行
- ⏳ 优化导出功能
- ⏳ 图片处理优化
- ⏳ 响应压缩

---

**最后更新**: 2026-02-04  
**状态**: 📋 进行中
