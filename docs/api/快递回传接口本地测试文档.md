# å¿«é€’å›ä¼ æ¥å£ - æœ¬åœ°æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æ¥å£ä¿¡æ¯

### ç”Ÿäº§ç¯å¢ƒ
- **æ¥å£åœ°å€**: `https://photogooo/api/logistics/callback`
- **æµ‹è¯•æ¥å£**: `https://photogooo/api/logistics/test`

### æœ¬åœ°æµ‹è¯•ç¯å¢ƒ
- **æ¥å£åœ°å€**: `http://localhost:5000/api/logistics/callback`
- **æµ‹è¯•æ¥å£**: `http://localhost:5000/api/logistics/test`

**æ³¨æ„**: ç¡®ä¿æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œé»˜è®¤ç«¯å£ä¸º5000

---

## ğŸ”— æ¥å£è¯¦æƒ…

### 1. å¿«é€’å›ä¼ æ¥å£

**è¯·æ±‚ä¿¡æ¯ï¼š**
- **æ–¹æ³•**: `POST`
- **åœ°å€**: `/api/logistics/callback`
- **Content-Type**: `application/json`
- **å­—ç¬¦ç¼–ç **: `UTF-8`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| order_number | string | âœ… | è®¢å•å·ï¼ˆç³»ç»Ÿè®¢å•å·ï¼‰ | "PET20250917175858D53F" |
| tracking_number | string | âœ… | ç‰©æµå•å· | "SF1234567890" |
| logistics_company | string | âœ… | ç‰©æµå…¬å¸åç§° | "é¡ºä¸°é€Ÿè¿" |
| estimated_delivery | string | âŒ | é¢„è®¡é€è¾¾æ—¶é—´ | "2025-09-20" |
| status | string | âŒ | ç‰©æµçŠ¶æ€ | "å·²å‘è´§" |
| remark | string | âŒ | å¤‡æ³¨ä¿¡æ¯ | "å‚å®¶å†²å°æµ‹è¯•è®¢å•" |

---

## ğŸ“¤ è¯·æ±‚ç¤ºä¾‹

### 1. å®Œæ•´å‚æ•°ç¤ºä¾‹

```json
{
  "order_number": "PET20250917175858D53F",
  "tracking_number": "SF1234567890",
  "logistics_company": "é¡ºä¸°é€Ÿè¿",
  "estimated_delivery": "2025-09-20",
  "status": "å·²å‘è´§",
  "remark": "å‚å®¶å†²å°æµ‹è¯•è®¢å•"
}
```

### 2. æœ€ç®€å‚æ•°ç¤ºä¾‹ï¼ˆæ¨èï¼‰

```json
{
  "order_number": "PET20250917175858D53F",
  "tracking_number": "SF1234567890",
  "logistics_company": "é¡ºä¸°é€Ÿè¿"
}
```

---

## ğŸ“¥ å“åº”æ ¼å¼

### æˆåŠŸå“åº”

**HTTPçŠ¶æ€ç **: `200 OK`

```json
{
  "success": true,
  "message": "ç‰©æµä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "order_number": "PET20250917175858D53F",
    "status": "processing",
    "tracking_number": "SF1234567890",
    "logistics_company": "é¡ºä¸°é€Ÿè¿",
    "commission": 9.9
  }
}
```

### é”™è¯¯å“åº”

**HTTPçŠ¶æ€ç **: `400 Bad Request`

```json
{
  "success": false,
  "message": "ç¼ºå°‘å¿…è¦å‚æ•°: order_number, tracking_number, logistics_company"
}
```

**HTTPçŠ¶æ€ç **: `404 Not Found`

```json
{
  "success": false,
  "message": "è®¢å• PET20250917175858D53F ä¸å­˜åœ¨"
}
```

**HTTPçŠ¶æ€ç **: `500 Internal Server Error`

```json
{
  "success": false,
  "message": "æ›´æ–°å¤±è´¥: [é”™è¯¯è¯¦æƒ…]"
}
```

---

## ğŸ§ª æœ¬åœ°æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨ cURLï¼ˆWindows PowerShellï¼‰

```powershell
# æµ‹è¯•æ¥å£æ˜¯å¦æ­£å¸¸
curl http://localhost:5000/api/logistics/test

# å‘é€å¿«é€’å›ä¼ è¯·æ±‚
curl -X POST http://localhost:5000/api/logistics/callback `
  -H "Content-Type: application/json" `
  -d '{\"order_number\": \"PET20250917175858D53F\", \"tracking_number\": \"SF1234567890\", \"logistics_company\": \"é¡ºä¸°é€Ÿè¿\"}'
```

### æ–¹æ³•2: ä½¿ç”¨ Python è„šæœ¬

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ `test_logistics_local.py`:

```python
import requests
import json

# æœ¬åœ°æµ‹è¯•åœ°å€
LOCAL_URL = "http://localhost:5000/api/logistics/callback"
TEST_URL = "http://localhost:5000/api/logistics/test"

def test_interface():
    """æµ‹è¯•æ¥å£æ˜¯å¦æ­£å¸¸"""
    print("=" * 50)
    print("æµ‹è¯•æ¥å£è¿æ¥çŠ¶æ€...")
    print("=" * 50)
    
    try:
        response = requests.get(TEST_URL, timeout=5)
        print(f"çŠ¶æ€ç : {response.status_code}")
        print(f"å“åº”: {json.dumps(response.json(), ensure_ascii=False, indent=2)}")
        return True
    except Exception as e:
        print(f"âŒ è¿æ¥å¤±è´¥: {str(e)}")
        print("è¯·ç¡®ä¿æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ 5000")
        return False

def test_logistics_callback(order_number, tracking_number, logistics_company, 
                            estimated_delivery=None, status=None, remark=None):
    """æµ‹è¯•å¿«é€’å›ä¼ æ¥å£"""
    print("\n" + "=" * 50)
    print("æµ‹è¯•å¿«é€’å›ä¼ æ¥å£...")
    print("=" * 50)
    
    # æ„å»ºè¯·æ±‚æ•°æ®
    data = {
        "order_number": order_number,
        "tracking_number": tracking_number,
        "logistics_company": logistics_company
    }
    
    # æ·»åŠ å¯é€‰å‚æ•°
    if estimated_delivery:
        data["estimated_delivery"] = estimated_delivery
    if status:
        data["status"] = status
    if remark:
        data["remark"] = remark
    
    print(f"\nè¯·æ±‚æ•°æ®:")
    print(json.dumps(data, ensure_ascii=False, indent=2))
    print(f"\nè¯·æ±‚URL: {LOCAL_URL}")
    
    try:
        response = requests.post(
            LOCAL_URL,
            json=data,
            headers={"Content-Type": "application/json"},
            timeout=10
        )
        
        print(f"\nå“åº”çŠ¶æ€ç : {response.status_code}")
        print(f"å“åº”å†…å®¹:")
        result = response.json()
        print(json.dumps(result, ensure_ascii=False, indent=2))
        
        if result.get("success"):
            print("\nâœ… æµ‹è¯•æˆåŠŸï¼")
            return True
        else:
            print(f"\nâŒ æµ‹è¯•å¤±è´¥: {result.get('message', 'æœªçŸ¥é”™è¯¯')}")
            return False
            
    except requests.exceptions.ConnectionError:
        print("\nâŒ è¿æ¥å¤±è´¥ï¼è¯·ç¡®ä¿:")
        print("  1. æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨")
        print("  2. æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 5000")
        print("  3. é˜²ç«å¢™å…è®¸è¿æ¥")
        return False
    except Exception as e:
        print(f"\nâŒ è¯·æ±‚å¤±è´¥: {str(e)}")
        return False

if __name__ == "__main__":
    # ç¬¬ä¸€æ­¥ï¼šæµ‹è¯•æ¥å£è¿æ¥
    if not test_interface():
        exit(1)
    
    # ç¬¬äºŒæ­¥ï¼šæµ‹è¯•å¿«é€’å›ä¼ ï¼ˆè¯·æ›¿æ¢ä¸ºçœŸå®çš„è®¢å•å·ï¼‰
    print("\n" + "=" * 50)
    print("è¯·è¾“å…¥æµ‹è¯•å‚æ•°:")
    print("=" * 50)
    
    # è·å–è®¢å•å·ï¼ˆå¯ä»¥ä»æ•°æ®åº“æŸ¥è¯¢ï¼‰
    order_number = input("è®¢å•å· (ä¾‹å¦‚: PET20250917175858D53F): ").strip()
    if not order_number:
        print("âŒ è®¢å•å·ä¸èƒ½ä¸ºç©º")
        exit(1)
    
    tracking_number = input("ç‰©æµå•å· (ä¾‹å¦‚: SF1234567890): ").strip() or "TEST1234567890"
    logistics_company = input("ç‰©æµå…¬å¸ (ä¾‹å¦‚: é¡ºä¸°é€Ÿè¿): ").strip() or "æµ‹è¯•ç‰©æµå…¬å¸"
    
    print("\nå¯é€‰å‚æ•°ï¼ˆç›´æ¥å›è½¦è·³è¿‡ï¼‰:")
    estimated_delivery = input("é¢„è®¡é€è¾¾æ—¶é—´ (ä¾‹å¦‚: 2025-09-20): ").strip() or None
    status = input("ç‰©æµçŠ¶æ€ (ä¾‹å¦‚: å·²å‘è´§): ").strip() or None
    remark = input("å¤‡æ³¨ä¿¡æ¯: ").strip() or None
    
    # æ‰§è¡Œæµ‹è¯•
    test_logistics_callback(
        order_number=order_number,
        tracking_number=tracking_number,
        logistics_company=logistics_company,
        estimated_delivery=estimated_delivery,
        status=status,
        remark=remark
    )
```

### æ–¹æ³•3: ä½¿ç”¨ Postman æˆ–ç±»ä¼¼å·¥å…·

1. **è¯·æ±‚æ–¹æ³•**: POST
2. **URL**: `http://localhost:5000/api/logistics/callback`
3. **Headers**:
   ```
   Content-Type: application/json
   ```
4. **Body** (é€‰æ‹© raw JSON):
   ```json
   {
     "order_number": "PET20250917175858D53F",
     "tracking_number": "SF1234567890",
     "logistics_company": "é¡ºä¸°é€Ÿè¿"
   }
   ```

---

## ğŸ” å¦‚ä½•è·å–æµ‹è¯•è®¢å•å·

### æ–¹æ³•1: ä»æ•°æ®åº“æŸ¥è¯¢

ä½¿ç”¨ Python è„šæœ¬æŸ¥è¯¢ï¼š

```python
import sqlite3

def get_test_orders():
    """è·å–æµ‹è¯•è®¢å•å·"""
    conn = sqlite3.connect('pet_painting.db')  # æ ¹æ®å®é™…æ•°æ®åº“è·¯å¾„è°ƒæ•´
    cursor = conn.cursor()
    
    # æŸ¥è¯¢æœ€è¿‘çš„è®¢å•
    cursor.execute('''
        SELECT order_number, status, created_at 
        FROM "order" 
        ORDER BY id DESC 
        LIMIT 10
    ''')
    
    orders = cursor.fetchall()
    print("æœ€è¿‘çš„è®¢å•:")
    print("-" * 60)
    for order in orders:
        print(f"è®¢å•å·: {order[0]}, çŠ¶æ€: {order[1]}, åˆ›å»ºæ—¶é—´: {order[2]}")
    
    conn.close()
    return orders

if __name__ == "__main__":
    get_test_orders()
```

### æ–¹æ³•2: ä»ç®¡ç†åå°æŸ¥çœ‹

è®¿é—® `http://localhost:5000/admin/orders` æŸ¥çœ‹è®¢å•åˆ—è¡¨

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨ï¼ˆç«¯å£ 5000ï¼‰
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å‡†å¤‡ä¸€ä¸ªæœ‰æ•ˆçš„è®¢å•å·ç”¨äºæµ‹è¯•
- [ ] æµ‹è¯•æ¥å£è¿æ¥ï¼ˆ`/api/logistics/test`ï¼‰
- [ ] æµ‹è¯•å®Œæ•´å‚æ•°è¯·æ±‚
- [ ] æµ‹è¯•æœ€ç®€å‚æ•°è¯·æ±‚
- [ ] æµ‹è¯•é”™è¯¯æƒ…å†µï¼ˆè®¢å•å·ä¸å­˜åœ¨ã€å‚æ•°ç¼ºå¤±ç­‰ï¼‰

---

## ğŸš¨ å¸¸è§é”™è¯¯å¤„ç†

### 1. è¿æ¥å¤±è´¥

**é”™è¯¯**: `ConnectionError` æˆ– `è¿æ¥è¢«æ‹’ç»`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨: `python test_server.py` æˆ– `python start.py`
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤5000ï¼‰
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. è®¢å•ä¸å­˜åœ¨

**é”™è¯¯**: `è®¢å• PET20250917175858D53F ä¸å­˜åœ¨`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤è®¢å•å·æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ä»æ•°æ®åº“æŸ¥è¯¢çœŸå®çš„è®¢å•å·
- æ£€æŸ¥è®¢å•æ˜¯å¦è¢«åˆ é™¤

### 3. å‚æ•°é”™è¯¯

**é”™è¯¯**: `ç¼ºå°‘å¿…è¦å‚æ•°`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤åŒ…å«ä¸‰ä¸ªå¿…è¦å‚æ•°: `order_number`, `tracking_number`, `logistics_company`
- æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤Content-Typeä¸º `application/json`

---

## ğŸ“ æµ‹è¯•ç¤ºä¾‹è¾“å‡º

### æˆåŠŸç¤ºä¾‹

```
==================================================
æµ‹è¯•æ¥å£è¿æ¥çŠ¶æ€...
==================================================
çŠ¶æ€ç : 200
å“åº”: {
  "success": true,
  "message": "ç‰©æµæ¥å£æ­£å¸¸",
  "endpoint": "/api/logistics/callback",
  "method": "POST",
  "required_params": [
    "order_number",
    "tracking_number",
    "logistics_company"
  ],
  "optional_params": [
    "estimated_delivery",
    "status",
    "remark"
  ]
}

==================================================
æµ‹è¯•å¿«é€’å›ä¼ æ¥å£...
==================================================

è¯·æ±‚æ•°æ®:
{
  "order_number": "PET20250917175858D53F",
  "tracking_number": "SF1234567890",
  "logistics_company": "é¡ºä¸°é€Ÿè¿"
}

è¯·æ±‚URL: http://localhost:5000/api/logistics/callback

å“åº”çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "success": true,
  "message": "ç‰©æµä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "order_number": "PET20250917175858D53F",
    "status": "processing",
    "tracking_number": "SF1234567890",
    "logistics_company": "é¡ºä¸°é€Ÿè¿",
    "commission": 9.9
  }
}

âœ… æµ‹è¯•æˆåŠŸï¼
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—**: æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°è¾“å‡º
2. **æ£€æŸ¥æ•°æ®åº“**: ç¡®è®¤è®¢å•æ•°æ®æ˜¯å¦æ­£ç¡®
3. **æ£€æŸ¥ç½‘ç»œ**: ç¡®è®¤æœ¬åœ°æœåŠ¡å™¨å¯è®¿é—®
4. **æŸ¥çœ‹é”™è¯¯ä¿¡æ¯**: æ ¹æ®è¿”å›çš„é”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-20  
**é€‚ç”¨äº**: æœ¬åœ°å¼€å‘æµ‹è¯•ç¯å¢ƒ






