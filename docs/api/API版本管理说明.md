# API 版本管理说明

> 本文档说明 AI-Studio 项目 API 的版本策略、兼容性约定及废弃接口处理流程。

---

## 一、版本号说明

### 1.1 当前版本

| 版本 | 说明 | 状态 |
|------|------|------|
| **v1** | 当前默认版本（无版本前缀） | 稳定维护 |
| **v2** | 预留，未来大版本升级使用 | 规划中 |

### 1.2 版本规则

- **主版本（Major）**：不兼容的 API 变更（如：删除字段、修改参数类型、路径变更）
- **次版本（Minor）**：向后兼容的功能新增（如：新增可选参数、新增接口）
- **修订版本（Patch）**：向后兼容的 bug 修复，不改变 API 契约

### 1.3 版本表达方式

| 方式 | 示例 | 使用场景 |
|------|------|----------|
| URL 路径 | `/api/v1/miniprogram/orders` | 推荐，RESTful 风格 |
| 请求头 | `Accept: application/vnd.api+json;version=1` | 可选，与路径方式并存 |
| 查询参数 | `?version=1` | 不推荐，易混淆 |

**当前实现**：所有接口默认使用 v1 契约，路径无 `v1` 前缀（如 `/api/miniprogram/orders`），等价于 v1。

---

## 二、版本兼容性

### 2.1 兼容性原则

- **向后兼容**：新版本不应破坏旧版本客户端
- **废弃先行**：接口废弃前至少提前 **90 天** 公告
- **过渡期**：废弃接口保留至少 **180 天**，期间返回 `X-API-Deprecated` 响应头

### 2.2 响应头说明

| 响应头 | 含义 |
|--------|------|
| `X-API-Version` | 当前接口版本号（如 `1`） |
| `X-API-Deprecated` | `true` 表示该接口已废弃 |
| `X-API-Sunset` | 废弃接口的最终下线日期（RFC 3339 格式） |

### 2.3 兼容性检查清单

在发布新版本前，确认：

- [ ] 新增字段使用可选参数
- [ ] 不删除已有字段
- [ ] 不修改已有字段类型或语义
- [ ] 不改变已有接口的 HTTP 方法或路径
- [ ] 变更已记录到 `docs/api/API变更日志.md`

---

## 三、废弃接口处理

### 3.1 废弃流程

1. **公告**：在文档和响应头中标注废弃
2. **过渡期**：保持接口可用，建议客户端迁移
3. **下线**：过渡期结束后移除或重定向

### 3.2 废弃接口列表

| 接口路径 | 废弃日期 | 下线日期 | 替代方案 |
|----------|----------|----------|----------|
| （暂无） | - | - | - |

### 3.3 新增废弃接口登记模板

```markdown
| 接口路径 | 废弃日期 | 下线日期 | 替代方案 |
|----------|----------|----------|----------|
| /api/xxx/yyy | 2026-xx-xx | 2026-xx-xx | /api/xxx/yyy-v2 |
```

---

## 四、变更日志

### 4.1 变更记录

重要 API 变更应记录在 `docs/api/API变更日志.md`，格式如下：

```markdown
## [1.1.0] - 2026-02-09

### 新增
- GET /api/miniprogram/xxx - 新增某某接口

### 变更
- POST /api/miniprogram/orders - 请求体新增可选字段 `remark`

### 废弃
- GET /api/old/endpoint - 将于 2026-05-09 下线，请使用 /api/new/endpoint
```

### 4.2 变更日志文件

- 路径：`docs/api/API变更日志.md`
- 约定：每次发版前补充变更说明

---

## 五、相关文档

- **API错误码说明** - `docs/api/API错误码说明.md`
- **API请求响应示例** - `docs/api/API请求响应示例.md`
- **API文档索引** - `docs/api/API文档索引与复用说明.md`

---

**最后更新**: 2026-02-09  
**文档版本**: v1.0
