# 产品详情页面文档

## 页面路径
`pages/product-detail/product-detail`

## 页面说明
产品详情页面是一个独立的页面，用于展示产品详细信息，包括产品图片、特点、尺寸和颜色选择等。用户可以选择规格后点击"选择风格"按钮进入风格选择流程。

## 文件结构
- `product-detail.wxml` - 页面结构
- `product-detail.wxss` - 页面样式
- `product-detail.js` - 页面逻辑
- `product-detail.json` - 页面配置

## 页面结构

### 1. 顶部导航栏
- 返回按钮（左侧）
- 页面标题"产品详情"（居中）
- 右侧占位（预留）

### 2. 产品图片轮播
- 使用 `swiper` 组件展示多张产品图片
- 图片指示器显示当前图片位置（如：1/3）
- 点击图片可全屏预览

### 3. 产品信息
- **产品特点**：显示产品描述
- **选择尺寸**：展示可选的尺寸选项
- **选择颜色**：展示可选的颜色选项（如果有）

### 4. 底部操作栏（固定在底部）
- **返回按钮**：灰色背景，返回上一页
- **选择风格按钮**：渐变背景（红色到青色），跳转到风格选择页面

## 核心方法

### `onLoad(options)`
页面加载时调用，接收产品ID参数。

**参数：**
- `options.productId` 或 `options.id` - 产品ID

**功能：**
- 验证产品ID是否存在
- 调用 `loadProductDetail()` 加载产品详情
- 记录页面访问

### `loadProductDetail()`
加载产品详情数据。

**功能：**
- 请求产品列表API
- 转换图片URL为HTTPS
- 提取尺寸选项和颜色选项
- 更新页面数据

### `selectSize(e)`
选择尺寸规格。

**功能：**
- 从事件数据中获取选中的尺寸
- 更新 `selectedSize` 数据
- 调用 `updateSpec()` 更新规格信息

### `selectColor(e)`
选择颜色选项。

**功能：**
- 从事件数据中获取选中的颜色对象
- 更新 `selectedColor` 数据
- 如果颜色有图片，更新主图显示
- 调用 `updateSpec()` 更新规格信息

### `startCustom(e)`
开始定制流程。

**功能：**
- 验证是否选择了尺寸和颜色（如果有）
- 保存产品信息到全局数据
- 跳转到风格选择页面

**验证：**
- 必须选择尺寸
- 如果有颜色选项，必须选择颜色

### `navigateBack()`
返回上一页。

## 数据字段

### `data` 对象
```javascript
{
  productId: null,           // 产品ID
  currentProduct: {},        // 当前产品信息
  selectedSpec: '',          // 选中的规格名称
  selectedSpecPrice: '',     // 选中的规格价格
  selectedSize: '',          // 选中的尺寸
  selectedColor: {},         // 选中的颜色对象
  sizeOptions: [],           // 尺寸选项列表
  colorOptions: [],         // 颜色选项列表
  loading: true,             // 加载状态
  currentImageIndex: 0,      // 当前图片索引
  showImagePreview: false,   // 是否显示图片预览
  previewImageIndex: 0       // 预览图片索引
}
```

## 样式说明

### 底部操作栏样式
- 使用 `position: fixed` 固定在底部
- 高度：`100rpx`
- 使用 `flex` 布局，两个按钮并排显示
- 返回按钮：固定宽度 `160rpx`，灰色背景
- 选择风格按钮：`flex: 1` 占据剩余空间，渐变背景

### 按钮样式
- 使用 `view` 组件而非 `button` 组件，避免小程序默认样式问题
- 按钮高度：`80rpx`
- 圆角：`40rpx`
- 文字使用 `text` 组件包裹，便于样式控制

## API接口

### 获取产品列表
- **URL**: `/api/miniprogram/products`
- **方法**: `GET`
- **返回**: 产品列表数据，包含尺寸和颜色选项

## 跳转关系

### 进入页面
- 从产品馆页面（`pages/product/product`）点击产品进入

### 离开页面
- 点击"返回"按钮：返回上一页
- 点击"选择风格"按钮：跳转到 `pages/custom/select-style/select-style`

## 注意事项

1. **按钮显示问题**：使用 `view` + `text` 结构而非 `button` 组件，避免小程序默认样式干扰
2. **数据绑定**：使用 `productId || currentProduct.id` 确保按钮能获取到产品ID
3. **颜色选项**：颜色选项可能是对象格式 `{name: "黑色", image_url: "..."}`，需要正确处理
4. **图片URL**：所有图片URL都需要转换为HTTPS协议
5. **规格验证**：跳转到风格选择前，必须验证已选择尺寸和颜色（如果有）

## 常见问题

### Q: 底部按钮不显示？
A: 检查以下几点：
1. 确保使用 `view` 组件而非 `button` 组件
2. 检查CSS样式是否正确，特别是 `flex` 和 `width` 属性
3. 确保数据绑定正确，`currentProduct.id` 或 `productId` 有值
4. 检查是否有其他样式覆盖了按钮样式

### Q: 选择颜色后主图不更新？
A: 检查 `selectColor` 方法中是否正确处理了颜色对象的 `image_url` 字段。

### Q: 跳转到风格选择页面后，风格列表为空？
A: 检查产品是否绑定了风格分类，以及 `startCustom` 方法是否正确保存了产品信息到全局数据。

## 维护建议

1. **保持代码简洁**：避免过度嵌套的组件结构
2. **样式统一**：参考其他正常工作的页面（如 `shop-detail`）的样式实现
3. **数据验证**：在关键操作前进行数据验证
4. **错误处理**：添加适当的错误提示和异常处理
5. **日志记录**：在关键方法中添加 `console.log` 便于调试
