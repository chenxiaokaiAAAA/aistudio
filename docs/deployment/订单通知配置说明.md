# 订单通知系统配置说明

## 📋 功能概述

订单通知系统可以在有新订单时自动提醒，支持以下功能：
- 🖥️ **桌面通知**：在系统托盘显示弹窗通知
- 🔊 **语音播报**：自动播报订单信息
- 🔔 **音效提醒**：播放系统提示音

## 📦 安装依赖

### 1. 安装Python库

```bash
pip install plyer pyttsx3
```

或者使用requirements.txt：

```bash
pip install -r requirements.txt
```

### 2. 语音引擎设置（可选）

#### Windows系统：
- 自带SAPI5语音引擎，无需额外安装
- 默认支持英文语音
- 如需中文语音，可安装中文语音包

#### 安装中文语音包（可选）：
1. 打开 Windows 设置
2. 进入 **时间和语言** > **语言**
3. 点击 **添加语言**
4. 搜索并安装 **中文（简体）** > **语音包**

## ⚙️ 配置方法

### 配置文件：`order_notification_config.py`

编辑此文件可以自定义通知行为：

```python
# 通知总开关
ENABLE_NOTIFICATION = True  # False禁用所有通知

# 桌面通知开关
ENABLE_DESKTOP_NOTIFICATION = True  # False只关闭桌面通知

# 语音播报开关
ENABLE_VOICE_NOTIFICATION = True  # False只关闭语音播报

# 音效提醒开关
ENABLE_SOUND_NOTIFICATION = True  # False只关闭音效

# 语音引擎设置
TTS_RATE = 150  # 语速（50-300，数值越大语速越快）
TTS_VOLUME = 1.0  # 音量（0.0-1.0）

# 通知显示时长
NOTIFICATION_TIMEOUT = 10  # 桌面通知显示时长（秒）
```

### 快速配置示例

#### 只启用桌面通知，关闭语音和音效：
```python
ENABLE_NOTIFICATION = True
ENABLE_DESKTOP_NOTIFICATION = True
ENABLE_VOICE_NOTIFICATION = False
ENABLE_SOUND_NOTIFICATION = False
```

#### 只启用语音播报，关闭桌面通知：
```python
ENABLE_NOTIFICATION = True
ENABLE_DESKTOP_NOTIFICATION = False
ENABLE_VOICE_NOTIFICATION = True
ENABLE_SOUND_NOTIFICATION = False
```

#### 完全关闭通知：
```python
ENABLE_NOTIFICATION = False
```

## 🔧 使用方式

### 自动运行
系统已集成，当有订单时会自动触发通知，无需手动操作。

### 手动测试
可以运行以下命令测试通知功能：

```bash
python order_notification.py
```

## 📝 通知内容

### 新订单通知包含：
- 订单号
- 客户姓名
- 订单金额
- 订单来源（小程序/管理后台）

### 示例：
```
🛒 新订单提醒
订单号: PET20250101001
客户: 张三
金额: ¥99.0
来源: 小程序
```

## ❓ 常见问题

### 1. 没有收到桌面通知？
- 检查是否启用了桌面通知开关
- 检查Windows是否允许应用发送通知
- 在Windows设置中启用通知权限

### 2. 语音播报没有声音？
- 检查是否安装了语音引擎
- 检查系统音量设置
- 检查配置文件中的语音播报开关

### 3. 语音播报是英文？
- Windows默认只有英文语音
- 需要安装中文语音包（见上文）
- 可以在配置文件中调整语言设置

### 4. 通知太频繁？
- 可以在配置文件中关闭不需要的通知类型
- 可以调整通知显示时长
- 可以在代码中调整通知触发条件

### 5. 如何自定义通知音效？
编辑 `order_notification.py` 文件，修改 `_play_notification_sound()` 方法：

```python
def _play_notification_sound(self):
    # 可以添加自定义音频文件
    try:
        winsound.PlaySound("notification.wav", winsound.SND_FILENAME)
    except:
        winsound.MessageBeep(winsound.MB_ICONASTERISK)
```

## 🔍 日志查看

通知系统的日志会记录到控制台和 `app.log` 文件中：

```
2025-01-01 12:00:00 - order_notification - INFO - 📢 新订单通知: PET20250101001 - 张三 - ¥99.0
2025-01-01 12:00:00 - order_notification - INFO - 桌面通知已发送
2025-01-01 12:00:00 - order_notification - INFO - 语音播报完成
```

## 🛠️ 高级定制

### 添加自定义通知逻辑

在 `order_notification.py` 中添加新的通知方法：

```python
def notify_custom_event(self, message):
    """自定义事件通知"""
    if not self.enabled:
        return
    
    # 添加你的通知逻辑
    if self.desktop_notification and PLYER_AVAILABLE:
        notification.notify(
            title="自定义事件",
            message=message,
            app_name="萌宠绘系统",
            timeout=5
        )
```

### 集成到其他功能

可以在系统其他地方调用通知：

```python
from order_notification import notify_new_order, notify_paid_order

# 发送新订单通知
notify_new_order(
    order_number="PET20250101001",
    customer_name="张三",
    total_price=99.0,
    source="小程序"
)

# 发送支付通知
notify_paid_order(
    order_number="PET20250101001",
    customer_name="张三",
    total_price=99.0
)
```

## 📞 技术支持

如遇问题，请查看：
1. 日志文件 `app.log`
2. 控制台输出
3. 配置文件设置

---

**更新日期**: 2025-01-01  
**版本**: 1.0


