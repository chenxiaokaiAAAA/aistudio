# ä½¿ç”¨å®Œæ•´å‹ç¼©åŒ…é‡æ–°éƒ¨ç½²

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

ä½¿ç”¨ä¸Šä¼ çš„å®Œæ•´å‹ç¼©åŒ… `aistudio.zip` é‡æ–°éƒ¨ç½²æ•´ä¸ªé¡¹ç›®ã€‚

---

## ğŸ”§ å®Œæ•´éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šåœæ­¢æœåŠ¡å¹¶å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

```bash
# åœæ­¢æœåŠ¡
systemctl stop aistudio

# å¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ä¿ç•™æ•°æ®åº“ï¼‰
cp -r /root/project_code /root/project_code_old_backup
```

### æ­¥éª¤2ï¼šæ¸…ç†æ—§é¡¹ç›®

```bash
# åˆ é™¤æ—§é¡¹ç›®ï¼ˆä¿ç•™æ•°æ®åº“ï¼‰
rm -rf /root/project_code
mkdir -p /root/project_code
```

### æ­¥éª¤3ï¼šè§£å‹å®Œæ•´å‹ç¼©åŒ…

```bash
# æ‰¾åˆ°å‹ç¼©åŒ…ä½ç½®
find /root -name "aistudio.zip" -type f

# è§£å‹åˆ° project_code ç›®å½•
cd /root/project_code
unzip -o /root/workspace/aistudio.zip -d /root/project_code/

# æˆ–å¦‚æœå‹ç¼©åŒ…åœ¨å…¶ä»–ä½ç½®
# unzip -o /path/to/aistudio.zip -d /root/project_code/
```

### æ­¥éª¤4ï¼šæ¢å¤æ•°æ®åº“ï¼ˆå¦‚æœå¤‡ä»½äº†ï¼‰

```bash
# å¦‚æœå¤‡ä»½ä¸­æœ‰æ•°æ®åº“ï¼Œæ¢å¤å®ƒ
if [ -d /root/project_code_old_backup/instance ]; then
    cp -r /root/project_code_old_backup/instance /root/project_code/
    echo "âœ… æ•°æ®åº“å·²æ¢å¤"
fi
```

### æ­¥éª¤5ï¼šè®¾ç½®æƒé™å’Œé…ç½®

```bash
# è®¾ç½®æ–‡ä»¶æƒé™
chmod +x /root/project_code/start_production.py
chmod -R 755 /root/project_code/static
chmod 755 /root/project_code/instance 2>/dev/null || true
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true

# ç¡®ä¿ .env æ–‡ä»¶å­˜åœ¨
if [ ! -f /root/project_code/.env ]; then
    cat > /root/project_code/.env << 'ENVEOF'
FLASK_ENV=production
SERVER_ENV=production
DATABASE_URL=sqlite:////root/project_code/instance/pet_painting.db
ENVEOF
fi
```

### æ­¥éª¤6ï¼šæ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ

```bash
# å¦‚æœè™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
if [ ! -d /root/project_code/venv ]; then
    cd /root/project_code
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    echo "âœ… è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º"
fi
```

### æ­¥éª¤7ï¼šé‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
systemctl restart aistudio
sleep 3

# æŸ¥çœ‹çŠ¶æ€
systemctl status aistudio --no-pager -l | head -25
```

---

## ğŸ“‹ å®Œæ•´ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
echo "=========================================="
echo "ä½¿ç”¨å®Œæ•´å‹ç¼©åŒ…é‡æ–°éƒ¨ç½²"
echo "=========================================="
echo ""

# 1. åœæ­¢æœåŠ¡
echo "[1/7] åœæ­¢æœåŠ¡..."
systemctl stop aistudio
echo "âœ… æœåŠ¡å·²åœæ­¢"
echo ""

# 2. å¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆä¿ç•™æ•°æ®åº“ï¼‰
echo "[2/7] å¤‡ä»½å½“å‰é¡¹ç›®..."
if [ -d /root/project_code ]; then
    BACKUP_DIR="/root/project_code_backup_$(date +%Y%m%d_%H%M%S)"
    cp -r /root/project_code $BACKUP_DIR
    echo "âœ… å·²å¤‡ä»½åˆ°: $BACKUP_DIR"
else
    echo "âš ï¸  å½“å‰é¡¹ç›®ä¸å­˜åœ¨ï¼Œè·³è¿‡å¤‡ä»½"
fi
echo ""

# 3. æ¸…ç†æ—§é¡¹ç›®
echo "[3/7] æ¸…ç†æ—§é¡¹ç›®..."
rm -rf /root/project_code
mkdir -p /root/project_code
echo "âœ… æ—§é¡¹ç›®å·²æ¸…ç†"
echo ""

# 4. æŸ¥æ‰¾å¹¶è§£å‹å‹ç¼©åŒ…
echo "[4/7] æŸ¥æ‰¾å¹¶è§£å‹å‹ç¼©åŒ…..."
ZIP_FILE=$(find /root -name "aistudio.zip" -type f | head -1)
if [ -z "$ZIP_FILE" ]; then
    echo "âŒ æœªæ‰¾åˆ° aistudio.zipï¼Œè¯·æ£€æŸ¥å‹ç¼©åŒ…ä½ç½®"
    exit 1
fi

echo "æ‰¾åˆ°å‹ç¼©åŒ…: $ZIP_FILE"
cd /root/project_code
unzip -o "$ZIP_FILE"
echo "âœ… è§£å‹å®Œæˆ"
echo ""

# 5. æ¢å¤æ•°æ®åº“
echo "[5/7] æ¢å¤æ•°æ®åº“..."
if [ -d "${BACKUP_DIR}/instance" ]; then
    cp -r ${BACKUP_DIR}/instance /root/project_code/
    echo "âœ… æ•°æ®åº“å·²æ¢å¤"
else
    mkdir -p /root/project_code/instance
    echo "âš ï¸  æœªæ‰¾åˆ°æ•°æ®åº“å¤‡ä»½ï¼Œå°†ä½¿ç”¨æ–°æ•°æ®åº“"
fi
echo ""

# 6. è®¾ç½®æƒé™å’Œé…ç½®
echo "[6/7] è®¾ç½®æƒé™å’Œé…ç½®..."
chmod +x /root/project_code/start_production.py
chmod -R 755 /root/project_code/static 2>/dev/null || true
chmod 755 /root/project_code/instance 2>/dev/null || true
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true

# åˆ›å»º .env æ–‡ä»¶
cat > /root/project_code/.env << 'ENVEOF'
FLASK_ENV=production
SERVER_ENV=production
DATABASE_URL=sqlite:////root/project_code/instance/pet_painting.db
ENVEOF
echo "âœ… æƒé™å’Œé…ç½®å·²è®¾ç½®"
echo ""

# 7. é‡å¯æœåŠ¡
echo "[7/7] é‡å¯æœåŠ¡..."
systemctl restart aistudio
sleep 3

echo ""
echo "=========================================="
echo "éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
echo ""
echo "æœåŠ¡çŠ¶æ€ï¼š"
systemctl status aistudio --no-pager -l | head -20

echo ""
echo "ç«¯å£ç›‘å¬ï¼š"
netstat -tlnp | grep 8000 || echo "âš ï¸ ç«¯å£æœªç›‘å¬"

echo ""
echo "é™æ€æ–‡ä»¶æ£€æŸ¥ï¼š"
ls -la /root/project_code/static/ 2>/dev/null | head -5 || echo "âš ï¸ staticç›®å½•ä¸å­˜åœ¨"

echo ""
echo "æµ‹è¯•è®¿é—®ï¼š"
curl -s -o /dev/null -w "HTTPçŠ¶æ€ç : %{http_code}\n" http://localhost:8000/login
```

---

## ğŸ¯ æ‰§è¡Œéƒ¨ç½²

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸Šé¢çš„**å®Œæ•´ä¸€é”®éƒ¨ç½²è„šæœ¬**ï¼Œå®ƒä¼šï¼š
1. åœæ­¢æœåŠ¡
2. å¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆä¿ç•™æ•°æ®åº“ï¼‰
3. æ¸…ç†æ—§é¡¹ç›®
4. è§£å‹å®Œæ•´å‹ç¼©åŒ…
5. æ¢å¤æ•°æ®åº“
6. è®¾ç½®æƒé™å’Œé…ç½®
7. é‡å¯æœåŠ¡

---

## âœ… éƒ¨ç½²åéªŒè¯

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status aistudio

# 2. æ£€æŸ¥é™æ€æ–‡ä»¶
ls -la /root/project_code/static/css/bootstrap.min.css
ls -la /root/project_code/static/js/bootstrap.bundle.min.js

# 3. æµ‹è¯•è®¿é—®
curl http://121.43.143.59/login

# 4. é‡ç½®å¯†ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
cd /root/project_code
source venv/bin/activate
python << 'EOF'
from test_server import app, db, User
from werkzeug.security import generate_password_hash
with app.app_context():
    admin = User.query.filter_by(username='admin').first()
    if admin:
        admin.password = generate_password_hash('admin123')
        db.session.commit()
        print("âœ… å¯†ç å·²é‡ç½®")
    else:
        admin = User(username='admin', password=generate_password_hash('admin123'), role='admin')
        db.session.add(admin)
        db.session.commit()
        print("âœ… è´¦å·å·²åˆ›å»º")
EOF
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å‹ç¼©åŒ…ä½ç½®**ï¼šè„šæœ¬ä¼šè‡ªåŠ¨æŸ¥æ‰¾ `/root` ç›®å½•ä¸‹çš„ `aistudio.zip`
2. **æ•°æ®åº“ä¿ç•™**ï¼šä¼šè‡ªåŠ¨ä»å¤‡ä»½ä¸­æ¢å¤æ•°æ®åº“
3. **è™šæ‹Ÿç¯å¢ƒ**ï¼šå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º
4. **æƒé™è®¾ç½®**ï¼šä¼šè‡ªåŠ¨è®¾ç½®æ‰€æœ‰å¿…è¦çš„æƒé™

æ‰§è¡Œè„šæœ¬åå‘Šè¯‰æˆ‘ç»“æœï¼
