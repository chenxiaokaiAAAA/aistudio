# 服务器手动修复服务命令

## 如果终端无响应

1. **尝试按 `Ctrl + C` 中断当前命令**
2. **尝试按 `Enter` 键**
3. **如果还是没反应，关闭终端重新连接**

## 直接执行修复命令（复制粘贴）

在服务器终端中，**一行一行复制粘贴执行**：

```bash
# 步骤1：修复服务配置
cat > /etc/systemd/system/aistudio.service << 'EOF'
[Unit]
Description=AI Studio Gunicorn Application Server
After=network.target

[Service]
Type=simple
User=root
Group=root
WorkingDirectory=/root/project_code
Environment="PATH=/root/project_code/venv/bin"
EnvironmentFile=/root/project_code/.env
ExecStart=/root/project_code/venv/bin/python /root/project_code/start_production.py
ExecReload=/bin/kill -s HUP $MAINPID
Restart=always
RestartSec=3
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF
```

```bash
# 步骤2：确保 .env 文件存在
cd /root/project_code
if [ ! -f .env ]; then
    cat > .env << 'ENVEOF'
FLASK_ENV=production
SERVER_ENV=production
ENVEOF
fi
```

```bash
# 步骤3：给启动脚本执行权限
chmod +x /root/project_code/start_production.py
```

```bash
# 步骤4：重新加载 systemd
systemctl daemon-reload
```

```bash
# 步骤5：启动服务
systemctl start aistudio
```

```bash
# 步骤6：查看状态
systemctl status aistudio
```

```bash
# 步骤7：如果失败，查看日志
journalctl -u aistudio -n 50 --no-pager
```

---

## 如果一定要上传脚本

### 上传位置

脚本应该上传到：
```
/root/project_code/scripts/deployment/fix_service_startup.sh
```

### 上传方法

#### 方法1：使用 WinSCP（Windows）

1. 打开 WinSCP
2. 连接到服务器：`121.43.143.59`
3. 导航到：`/root/project_code/scripts/deployment/`
4. 如果 `scripts` 目录不存在，先创建：
   - 右键 → 新建 → 目录 → 输入 `scripts`
   - 进入 `scripts`，再创建 `deployment` 目录
5. 将 `fix_service_startup.sh` 拖拽上传到 `deployment` 目录
6. 右键文件 → 属性 → 设置权限为 `755`（或执行：`chmod +x fix_service_startup.sh`）

#### 方法2：使用 SCP 命令（Windows PowerShell）

在本地 PowerShell 中执行：

```powershell
# 上传脚本到服务器
scp -i "E:\AI-STUDIO\aistudio\aliyun-key" scripts/deployment/fix_service_startup.sh root@121.43.143.59:/root/project_code/scripts/deployment/

# 如果目录不存在，先创建
ssh -i "E:\AI-STUDIO\aistudio\aliyun-key" root@121.43.143.59 "mkdir -p /root/project_code/scripts/deployment"
```

#### 方法3：直接在服务器上创建脚本

如果上传不方便，直接在服务器上创建脚本：

```bash
# 1. 创建目录
mkdir -p /root/project_code/scripts/deployment

# 2. 创建脚本文件
nano /root/project_code/scripts/deployment/fix_service_startup.sh

# 3. 粘贴脚本内容（从本地文件复制）
# 4. 保存：Ctrl+O, Enter
# 5. 退出：Ctrl+X

# 6. 给执行权限
chmod +x /root/project_code/scripts/deployment/fix_service_startup.sh

# 7. 执行脚本
bash /root/project_code/scripts/deployment/fix_service_startup.sh
```

---

## 解决终端无响应问题

### 问题1：命令卡住

**症状**：输入命令后没有反应

**解决**：
1. 按 `Ctrl + C` 中断
2. 按 `Enter` 键
3. 重新输入命令

### 问题2：终端完全无响应

**症状**：输入任何字符都没有反应

**解决**：
1. **关闭当前终端窗口**
2. **重新连接到服务器**
3. 如果使用 SSH，重新执行连接命令

### 问题3：网络延迟

**症状**：命令执行很慢

**解决**：
- 等待几秒钟
- 检查网络连接
- 使用 `ping 121.43.143.59` 测试连接

---

## 快速验证命令

执行完修复后，用这些命令验证：

```bash
# 1. 检查服务状态
systemctl status aistudio

# 2. 检查端口
netstat -tlnp | grep 8000

# 3. 测试访问
curl http://localhost:8000/admin/
```

---

## 推荐方案

**建议直接使用方法1（直接执行命令）**，因为：
- ✅ 不需要上传文件
- ✅ 更快更直接
- ✅ 可以立即看到结果
- ✅ 如果某一步失败，可以单独排查
