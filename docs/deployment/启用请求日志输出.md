# å¯ç”¨è¯·æ±‚æ—¥å¿—è¾“å‡ºï¼ˆåƒæœ¬åœ° Flask ä¸€æ ·ï¼‰

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

1. **åœ¨ `test_server.py` ä¸­æ·»åŠ äº†è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶**
   - `@app.before_request` - è®°å½•æ¯ä¸ªè¯·æ±‚
   - `@app.after_request` - è®°å½•æ¯ä¸ªå“åº”

2. **é…ç½®äº†æ—¥å¿—ç³»ç»Ÿ**
   - åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶ï¼š`logs/app.log`
   - åŒæ—¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆå¯ä»¥é€šè¿‡ `journalctl` æŸ¥çœ‹ï¼‰

3. **æ›´æ–°äº† Gunicorn é…ç½®**
   - å¯ç”¨ `capture_output = True` - æ•èŽ·æ ‡å‡†è¾“å‡º
   - å¯ç”¨ `enable_stdio_inheritance = True` - ç»§æ‰¿æ ‡å‡†è¾“å…¥è¾“å‡º

---

## ðŸ”§ éƒ¨ç½²ä¿®æ”¹

### æ­¥éª¤1ï¼šä¸Šä¼ ä¿®æ”¹åŽçš„æ–‡ä»¶

å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š
- `test_server.py`
- `gunicorn.conf.py`

### æ­¥éª¤2ï¼šç¡®ä¿ logs ç›®å½•å­˜åœ¨

```bash
cd /root/project_code
mkdir -p logs
chmod 755 logs
```

### æ­¥éª¤3ï¼šé‡å¯æœåŠ¡

```bash
systemctl restart aistudio
```

---

## ðŸ“‹ æŸ¥çœ‹å®žæ—¶æ—¥å¿—

### æ–¹æ³•1ï¼šæŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼ˆæŽ¨èï¼Œæœ€æŽ¥è¿‘æœ¬åœ° Flaskï¼‰

```bash
# å®žæ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—è¾“å‡ºï¼ˆåŒ…æ‹¬è¯·æ±‚æ—¥å¿—ï¼‰
journalctl -u aistudio -f
```

è¿™ä¼šæ˜¾ç¤ºï¼š
- æ¯ä¸ªè¯·æ±‚ï¼š`ðŸ“¥ è¯·æ±‚: GET /admin/styles`
- æ¯ä¸ªå“åº”ï¼š`ðŸ“¤ å“åº”: 200 GET /admin/styles`
- Python print è¾“å‡º
- é”™è¯¯ä¿¡æ¯

### æ–¹æ³•2ï¼šæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

```bash
# å®žæ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶
tail -f /root/project_code/logs/app.log

# å®žæ—¶æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f /root/project_code/logs/access.log

# å®žæ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /root/project_code/logs/error.log
```

### æ–¹æ³•3ï¼šåŒæ—¶æŸ¥çœ‹å¤šä¸ªæ—¥å¿—

```bash
# åœ¨ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /root/project_code/logs/app.log

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹ systemd æ—¥å¿—
journalctl -u aistudio -f
```

---

## ðŸŽ¯ åˆ›å»ºä¾¿æ·è„šæœ¬

åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
cat > /root/project_code/view_logs.sh << 'EOF'
#!/bin/bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—çš„ä¾¿æ·è„šæœ¬

case "$1" in
    app)
        echo "æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼ˆå®žæ—¶ï¼‰..."
        tail -f /root/project_code/logs/app.log
        ;;
    access)
        echo "æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼ˆå®žæ—¶ï¼‰..."
        tail -f /root/project_code/logs/access.log
        ;;
    error)
        echo "æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆå®žæ—¶ï¼‰..."
        tail -f /root/project_code/logs/error.log
        ;;
    systemd)
        echo "æŸ¥çœ‹ systemd æ—¥å¿—ï¼ˆå®žæ—¶ï¼Œæœ€æŽ¥è¿‘æœ¬åœ° Flaskï¼‰..."
        journalctl -u aistudio -f
        ;;
    all)
        echo "åŒæ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—..."
        tail -f /root/project_code/logs/app.log /root/project_code/logs/access.log /root/project_code/logs/error.log
        ;;
    recent)
        echo "æŸ¥çœ‹æœ€è¿‘ 50 è¡Œåº”ç”¨æ—¥å¿—..."
        tail -50 /root/project_code/logs/app.log
        ;;
    *)
        echo "ç”¨æ³•: $0 {app|access|error|systemd|all|recent}"
        echo ""
        echo "  app     - å®žæ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼ˆlogs/app.logï¼‰"
        echo "  access  - å®žæ—¶æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼ˆlogs/access.logï¼‰"
        echo "  error   - å®žæ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆlogs/error.logï¼‰"
        echo "  systemd - å®žæ—¶æŸ¥çœ‹ systemd æ—¥å¿—ï¼ˆæœ€æŽ¥è¿‘æœ¬åœ° Flaskï¼ŒæŽ¨èï¼‰"
        echo "  all     - åŒæ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶"
        echo "  recent  - æŸ¥çœ‹æœ€è¿‘ 50 è¡Œåº”ç”¨æ—¥å¿—"
        exit 1
        ;;
esac
EOF

chmod +x /root/project_code/view_logs.sh
```

ä½¿ç”¨ï¼š

```bash
# æŸ¥çœ‹ systemd æ—¥å¿—ï¼ˆæœ€æŽ¥è¿‘æœ¬åœ° Flaskï¼‰
/root/project_code/view_logs.sh systemd

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
/root/project_code/view_logs.sh app

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
/root/project_code/view_logs.sh recent
```

---

## ðŸ“ æ—¥å¿—æ ¼å¼è¯´æ˜Ž

å¯ç”¨åŽï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š

```
2026-01-27 11:20:00 - __main__ - INFO - ðŸ“¥ è¯·æ±‚: GET /admin/styles
2026-01-27 11:20:00 - __main__ - INFO - ðŸ“¤ å“åº”: 200 GET /admin/styles
2026-01-27 11:20:01 - __main__ - INFO - ðŸ“¥ è¯·æ±‚: POST /api/admin/styles/categories
2026-01-27 11:20:01 - __main__ - INFO - ðŸ“¤ å“åº”: 200 POST /api/admin/styles/categories
```

---

## ðŸ” éªŒè¯æ—¥å¿—æ˜¯å¦å¯ç”¨

é‡å¯æœåŠ¡åŽï¼Œæ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
tail -20 /root/project_code/logs/app.log

# æˆ–æŸ¥çœ‹ systemd æ—¥å¿—
journalctl -u aistudio -n 20 --no-pager
```

åº”è¯¥èƒ½çœ‹åˆ°è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ—¥å¿—æ–‡ä»¶ä¼šå¢žé•¿**ï¼Œå®šæœŸæ¸…ç†ï¼š
   ```bash
   # æ¸…ç†æ—§æ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘ 7 å¤©ï¼‰
   find /root/project_code/logs -name "*.log" -mtime +7 -delete
   ```

2. **ç”Ÿäº§çŽ¯å¢ƒå»ºè®®**ï¼š
   - ä½¿ç”¨ `journalctl -u aistudio -f` æŸ¥çœ‹å®žæ—¶æ—¥å¿—
   - å®šæœŸæ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
   - ç›‘æŽ§æ—¥å¿—æ–‡ä»¶å¤§å°

3. **å¦‚æžœçœ‹ä¸åˆ°æ—¥å¿—**ï¼š
   - æ£€æŸ¥ `logs` ç›®å½•æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ç›®å½•æƒé™ï¼š`chmod 755 logs`
   - æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`systemctl status aistudio`
