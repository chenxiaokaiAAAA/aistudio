# 数据库上传后检查剩余错误

## ✅ 数据库已上传

现在需要检查服务状态和剩余错误。

---

## 🔍 立即检查

### 步骤1：查看服务状态

```bash
# 查看服务状态
systemctl status aistudio --no-pager -l | head -30

# 检查端口
netstat -tlnp | grep 8000

# 测试访问
curl http://localhost:8000/admin/
```

### 步骤2：查看最新日志

```bash
# 查看服务日志（最近50行）
journalctl -u aistudio -n 50 --no-pager

# 查看应用错误日志
tail -50 /root/project_code/logs/error.log 2>/dev/null || echo "error.log不存在"
```

### 步骤3：检查进程

```bash
# 查看Gunicorn进程
ps aux | grep gunicorn | grep -v grep

# 查看Python进程
ps aux | grep python | grep start_production
```

---

## 🚨 常见剩余问题

### 问题1：缺少Python模块

**错误信息**：
```
No module named 'xxx'
```

**常见缺失模块**：
- `franchisee_qrcode_generator`
- `pycryptodome` (Crypto模块)
- `douyin_sync_service`

**解决**：
```bash
cd /root/project_code
source venv/bin/activate

# 安装缺失的模块
pip install pycryptodome

# 或者安装所有依赖
pip install -r requirements.txt
```

**注意**：如果某些模块是项目特定的（如 `franchisee_qrcode_generator`），这些是警告，不影响主要功能。

### 问题2：配置文件缺失

**错误信息**：
```
No such file or directory: xxx_config.py
```

**常见缺失文件**：
- `server_config.py`
- `printer_config.py`
- `sync_config_routes.py`

**解决**：这些文件如果不存在，应用会使用默认配置，通常不影响启动。

### 问题3：图片目录权限问题

**错误信息**：
```
Permission denied
```

**解决**：
```bash
# 设置目录权限
chmod -R 755 /root/project_data/user_images/
chown -R root:root /root/project_data/user_images/
```

### 问题4：端口未监听

**如果8000端口仍未监听**：

```bash
# 查看详细错误
journalctl -u aistudio -n 100 --no-pager

# 手动测试启动
systemctl stop aistudio
cd /root/project_code
source venv/bin/activate
python start_production.py
```

---

## 📋 完整诊断命令

```bash
echo "=== 1. 服务状态 ==="
systemctl status aistudio --no-pager -l | head -20

echo ""
echo "=== 2. 端口检查 ==="
netstat -tlnp | grep 8000 || echo "⚠️ 8000端口未监听"

echo ""
echo "=== 3. 进程检查 ==="
ps aux | grep gunicorn | grep -v grep || echo "⚠️ Gunicorn进程未运行"

echo ""
echo "=== 4. 服务日志（最近30行） ==="
journalctl -u aistudio -n 30 --no-pager

echo ""
echo "=== 5. 应用错误日志 ==="
tail -30 /root/project_code/logs/error.log 2>/dev/null || echo "error.log不存在"

echo ""
echo "=== 6. 测试访问 ==="
curl -s -o /dev/null -w "HTTP状态码: %{http_code}\n" http://localhost:8000/admin/
```

---

## 🎯 如果服务已正常启动

如果看到：
- ✅ 端口8000正在监听
- ✅ Gunicorn进程在运行
- ✅ `curl` 返回 HTTP 200

那么服务已经成功启动！一些警告（如缺少可选模块）不影响主要功能。

---

## 📝 请提供具体错误信息

请执行以下命令，把输出发给我：

```bash
# 查看最新错误
journalctl -u aistudio -n 100 --no-pager | grep -i error

# 或查看完整日志
journalctl -u aistudio -n 50 --no-pager
```

这样我可以针对具体错误提供解决方案。
