# 排查静态文件 403 详细步骤

## ✅ 已完成的检查

- ✅ 文件存在：`bootstrap.min.css` 和 `bootstrap.bundle.min.js`
- ✅ 权限已设置：644 (文件) 和 755 (目录)
- ✅ Nginx 配置正确：`location /static/` 存在

---

## 🔍 进一步排查

### 步骤1：检查 Nginx 是否正常运行

```bash
systemctl status nginx
```

### 步骤2：检查 Nginx 错误日志

```bash
tail -20 /var/log/nginx/error.log
```

### 步骤3：测试静态文件访问（在服务器上）

```bash
# 测试本地访问
curl -I http://localhost/static/css/bootstrap.min.css

# 应该返回 200 OK，而不是 403
```

### 步骤4：检查 Nginx 用户权限

```bash
# 查看 Nginx 运行用户
ps aux | grep nginx | head -1

# 检查 /root 目录权限（Nginx 用户需要能访问）
ls -ld /root
ls -ld /root/project_code
```

### 步骤5：检查 SELinux（如果启用）

```bash
# 检查 SELinux 状态
getenforce

# 如果是 Enforcing，可能需要设置上下文
# setsebool -P httpd_read_user_content 1
```

---

## 🔧 可能的解决方案

### 方案1：确保 Nginx 能访问 /root 目录

如果 Nginx 不是以 root 运行，可能需要：

```bash
# 检查 Nginx 用户
NGINX_USER=$(ps aux | grep '[n]ginx: master' | awk '{print $1}')
echo "Nginx 用户: $NGINX_USER"

# 如果 Nginx 用户不是 root，可能需要调整权限
# 但 /root 目录通常不应该给其他用户访问权限
# 更好的方案是移动 static 目录或使用符号链接
```

### 方案2：使用符号链接（推荐）

将 static 目录链接到 Nginx 可以访问的位置：

```bash
# 创建符号链接到 /var/www/
ln -s /root/project_code/static /var/www/static

# 修改 Nginx 配置
sed -i 's|alias /root/project_code/static/;|alias /var/www/static/;|' /etc/nginx/sites-available/aistudio

# 测试并重启
nginx -t && systemctl restart nginx
```

### 方案3：检查 Nginx 配置中的其他问题

```bash
# 查看完整的 Nginx 配置
cat /etc/nginx/sites-available/aistudio

# 检查是否有其他 location 规则覆盖了 /static/
# 确保 /static/ location 在 / 之前
```

---

## 🎯 立即执行的完整检查脚本

```bash
#!/bin/bash
echo "=========================================="
echo "排查静态文件 403 问题"
echo "=========================================="
echo ""

# 1. 检查文件
echo "[1/6] 检查文件..."
ls -la /root/project_code/static/css/bootstrap.min.css
ls -la /root/project_code/static/js/bootstrap.bundle.min.js
echo ""

# 2. 检查权限
echo "[2/6] 检查权限..."
ls -ld /root/project_code/static/
ls -ld /root/project_code/static/css/
echo ""

# 3. 检查 Nginx 状态
echo "[3/6] 检查 Nginx 状态..."
systemctl status nginx --no-pager -l | head -10
echo ""

# 4. 检查 Nginx 用户
echo "[4/6] 检查 Nginx 用户..."
ps aux | grep '[n]ginx: master' | head -1
echo ""

# 5. 测试本地访问
echo "[5/6] 测试本地访问..."
curl -I http://localhost/static/css/bootstrap.min.css 2>&1 | head -5
echo ""

# 6. 检查错误日志
echo "[6/6] 检查 Nginx 错误日志（最近 10 行）..."
tail -10 /var/log/nginx/error.log
echo ""

echo "=========================================="
echo "检查完成"
echo "=========================================="
```
