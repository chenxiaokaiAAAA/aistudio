# 统一配置中心说明

## 📍 配置位置

**只需要修改两个文件即可切换所有地址！**

### 1. 后端配置：`AI-studio/server_config.py`

这是**后端唯一的配置源**，修改这里会影响：
- ✅ 后端API返回的所有URL
- ✅ 管理后台页面显示的地址（通过Flask context注入）
- ✅ 订单信息中的系统地址
- ✅ 二维码中的链接地址
- ✅ 支付回调地址
- ✅ 所有图片URL生成

### 2. 前端配置：`AI-小程序/config.js`

这是**小程序唯一的配置源**，修改这里会影响：
- ✅ 小程序所有API请求
- ✅ 小程序图片加载地址
- ✅ 小程序静态资源地址
- ✅ 所有页面文件的网络请求

## 🔧 如何修改

### 切换到本地环境（开发调试）

**后端：** 修改 `AI-studio/server_config.py`
```python
ENV = 'local'  # 改为 'local'
```

**前端：** 修改 `AI-小程序/config.js`
```javascript
const ENV = 'local';  // 改为 'local'
```

### 切换到生产环境（上线）

**后端：** 修改 `AI-studio/server_config.py`
```python
ENV = 'production'  # 改为 'production'
```

**前端：** 修改 `AI-小程序/config.js`
```javascript
const ENV = 'production';  // 改为 'production'
```

## 📝 配置项说明

### 后端配置（server_config.py）

```python
SERVER_CONFIG = {
    'local': {
        'base_url': 'http://192.168.2.54:8000',      # 基础URL
        'api_base_url': 'http://192.168.2.54:8000/api',  # API基础URL
        'static_url': 'http://192.168.2.54:8000/static',  # 静态资源URL
        'media_url': 'http://192.168.2.54:8000/media',    # 媒体文件URL
        'notify_url': 'http://192.168.2.54:8000/api/payment/notify'  # 支付回调URL
    },
    'production': {
        'base_url': 'https://photogooo',
        'api_base_url': 'https://photogooo/api',
        'static_url': 'https://photogooo/static',
        'media_url': 'https://photogooo/media',
        'notify_url': 'https://photogooo/api/payment/notify'
    }
}
```

### 前端配置（config.js）

```javascript
const SERVER_CONFIG = {
  local: {
    baseUrl: 'http://192.168.2.54:8000',
    apiBaseUrl: 'http://192.168.2.54:8000/api/miniprogram',
    apiUrl: 'http://192.168.2.54:8000/api',
    staticUrl: 'http://192.168.2.54:8000/static',
    mediaUrl: 'http://192.168.2.54:8000/media'
  },
  production: {
    baseUrl: 'https://photogooo',
    apiBaseUrl: 'https://photogooo/api/miniprogram',
    apiUrl: 'https://photogooo/api',
    staticUrl: 'https://photogooo/static',
    mediaUrl: 'https://photogooo/media'
  }
};
```

## 🚀 快速切换脚本

### 后端切换脚本

**切换到本地：**
```bash
cd AI-studio
switch_env_local.bat
```

**切换到生产：**
```bash
cd AI-studio
switch_env_production.bat
```

### 前端切换脚本

**切换到本地：**
```bash
cd AI-小程序
switch_to_local.bat
```

**切换到生产：**
```bash
cd AI-小程序
switch_to_production.bat
```

## ⚠️ 注意事项

1. **修改配置后需要重启服务**
   - 后端：重启 Flask 服务
   - 前端：清除缓存并重新编译小程序

2. **确保两个配置文件的环境一致**
   - 后端和前端应该使用相同的环境（都是 local 或都是 production）

3. **生产环境检查清单**
   - [ ] 后端 ENV = 'production'
   - [ ] 前端 ENV = 'production'
   - [ ] 微信支付回调地址正确
   - [ ] 小程序域名配置正确
   - [ ] SSL证书有效

## 📋 配置影响范围

### 后端配置影响：
- ✅ test_server.py 中所有URL生成
- ✅ 管理后台模板中的地址（通过Flask context processor自动注入）
  - 模板中可以使用：`{{ server_base_url }}`、`{{ server_media_url }}`、`{{ server_static_url }}` 等
- ✅ API返回的图片URL
- ✅ 订单信息中的系统地址
- ✅ 二维码链接
- ✅ 支付回调地址

### 前端配置影响：
- ✅ 所有页面文件的API请求
- ✅ 图片加载地址
- ✅ 静态资源地址
- ✅ 媒体文件地址
