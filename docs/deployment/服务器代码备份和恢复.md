# æœåŠ¡å™¨ä»£ç å¤‡ä»½å’Œæ¢å¤æŒ‡å—

## ğŸ“¦ å¤‡ä»½å½“å‰è¿è¡Œç‰ˆæœ¬

### æ–¹æ³•1ï¼šå®Œæ•´å¤‡ä»½ï¼ˆæ¨èï¼‰

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /root

# åˆ›å»ºå¤‡ä»½ç›®å½•ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
BACKUP_DIR="project_code_backup_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"

# å¤‡ä»½æ•´ä¸ªé¡¹ç›®ç›®å½•
cp -r project_code/* "$BACKUP_DIR/" 2>/dev/null || true

# å¤‡ä»½æ•°æ®åº“ï¼ˆé‡è¦ï¼ï¼‰
mkdir -p "$BACKUP_DIR/instance"
if [ -f "project_code/instance/pet_painting.db" ]; then
    cp project_code/instance/pet_painting.db "$BACKUP_DIR/instance/pet_painting.db"
    echo "âœ… æ•°æ®åº“å·²å¤‡ä»½"
fi

# å¤‡ä»½å›¾ç‰‡ç›®å½•
if [ -d "project_code/uploads" ]; then
    cp -r project_code/uploads "$BACKUP_DIR/" 2>/dev/null || true
fi
if [ -d "project_code/final_works" ]; then
    cp -r project_code/final_works "$BACKUP_DIR/" 2>/dev/null || true
fi
if [ -d "project_code/hd_images" ]; then
    cp -r project_code/hd_images "$BACKUP_DIR/" 2>/dev/null || true
fi

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
du -sh "$BACKUP_DIR"
```

### æ–¹æ³•2ï¼šå¿«é€Ÿå¤‡ä»½ï¼ˆåªå¤‡ä»½å…³é”®æ–‡ä»¶ï¼‰

```bash
cd /root
BACKUP_DIR="project_code_quick_backup_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"

# åªå¤‡ä»½å…³é”®æ–‡ä»¶
cp -r project_code/test_server.py "$BACKUP_DIR/" 2>/dev/null || true
cp -r project_code/start_production.py "$BACKUP_DIR/" 2>/dev/null || true
cp -r project_code/gunicorn.conf.py "$BACKUP_DIR/" 2>/dev/null || true
cp -r project_code/app "$BACKUP_DIR/" 2>/dev/null || true
cp -r project_code/instance "$BACKUP_DIR/" 2>/dev/null || true

echo "âœ… å¿«é€Ÿå¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```

## ğŸ”„ æµ‹è¯•åŒæ­¥

### æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼ˆæ‰§è¡Œä¸Šé¢çš„å¤‡ä»½å‘½ä»¤ï¼‰

### æ­¥éª¤2ï¼šæ‰§è¡ŒåŒæ­¥

åœ¨æœ¬åœ°è¿è¡Œï¼š
```cmd
å¿«é€ŸåŒæ­¥åˆ°é˜¿é‡Œäº‘.bat
```

é€‰æ‹©ï¼š
- `1` - åªåŒæ­¥ä»£ç ï¼ˆæ¨èå…ˆæµ‹è¯•è¿™ä¸ªï¼‰
- `4` - åŒæ­¥æ‰€æœ‰ï¼ˆä»£ç +æ•°æ®åº“+å›¾ç‰‡ï¼‰

### æ­¥éª¤3ï¼šæµ‹è¯•è¿è¡Œ

åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status aistudio

# æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 50

# æµ‹è¯•è®¿é—®
curl http://localhost:8000/admin/login
```

## âª æ¢å¤å¤‡ä»½

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤ï¼š

### æ–¹æ³•1ï¼šå®Œæ•´æ¢å¤

```bash
cd /root

# åœæ­¢æœåŠ¡
systemctl stop aistudio

# æ¢å¤å¤‡ä»½ï¼ˆæ›¿æ¢ BACKUP_DIR ä¸ºå®é™…çš„å¤‡ä»½ç›®å½•åï¼‰
BACKUP_DIR="project_code_backup_20260127_140000"  # ä¿®æ”¹ä¸ºä½ çš„å¤‡ä»½ç›®å½•å
rm -rf project_code/*
cp -r "$BACKUP_DIR"/* project_code/

# æ¢å¤æ•°æ®åº“
if [ -f "$BACKUP_DIR/instance/pet_painting.db" ]; then
    cp "$BACKUP_DIR/instance/pet_painting.db" project_code/instance/pet_painting.db
    chmod 644 project_code/instance/pet_painting.db
fi

# è®¾ç½®æƒé™
chmod -R 755 project_code
find project_code -type f -exec chmod 644 {} \;

# é‡å¯æœåŠ¡
systemctl start aistudio
systemctl status aistudio
```

### æ–¹æ³•2ï¼šåªæ¢å¤å…³é”®æ–‡ä»¶

```bash
cd /root
BACKUP_DIR="project_code_quick_backup_20260127_140000"  # ä¿®æ”¹ä¸ºä½ çš„å¤‡ä»½ç›®å½•å

# æ¢å¤å…³é”®æ–‡ä»¶
cp "$BACKUP_DIR/test_server.py" project_code/
cp "$BACKUP_DIR/start_production.py" project_code/
cp "$BACKUP_DIR/gunicorn.conf.py" project_code/
cp -r "$BACKUP_DIR/app" project_code/
cp -r "$BACKUP_DIR/instance" project_code/

# é‡å¯æœåŠ¡
systemctl restart aistudio
```

## ğŸ“‹ ä¸€é”®å¤‡ä»½è„šæœ¬

åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¤‡ä»½è„šæœ¬ï¼š

```bash
cat > /root/backup_project.sh << 'EOF'
#!/bin/bash
cd /root
BACKUP_DIR="project_code_backup_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"

echo "å¼€å§‹å¤‡ä»½..."
cp -r project_code/* "$BACKUP_DIR/" 2>/dev/null || true

if [ -f "project_code/instance/pet_painting.db" ]; then
    mkdir -p "$BACKUP_DIR/instance"
    cp project_code/instance/pet_painting.db "$BACKUP_DIR/instance/pet_painting.db"
fi

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
du -sh "$BACKUP_DIR"
ls -la | grep project_code_backup
EOF

chmod +x /root/backup_project.sh
```

ä½¿ç”¨ï¼š
```bash
/root/backup_project.sh
```

## ğŸ“‹ ä¸€é”®æ¢å¤è„šæœ¬

```bash
cat > /root/restore_project.sh << 'EOF'
#!/bin/bash
if [ -z "$1" ]; then
    echo "ç”¨æ³•: $0 <å¤‡ä»½ç›®å½•å>"
    echo "ç¤ºä¾‹: $0 project_code_backup_20260127_140000"
    ls -la /root | grep project_code_backup
    exit 1
fi

BACKUP_DIR="/root/$1"
if [ ! -d "$BACKUP_DIR" ]; then
    echo "[é”™è¯¯] å¤‡ä»½ç›®å½•ä¸å­˜åœ¨: $BACKUP_DIR"
    exit 1
fi

echo "åœæ­¢æœåŠ¡..."
systemctl stop aistudio

echo "æ¢å¤å¤‡ä»½..."
rm -rf /root/project_code/*
cp -r "$BACKUP_DIR"/* /root/project_code/

if [ -f "$BACKUP_DIR/instance/pet_painting.db" ]; then
    cp "$BACKUP_DIR/instance/pet_painting.db" /root/project_code/instance/pet_painting.db
    chmod 644 /root/project_code/instance/pet_painting.db
fi

chmod -R 755 /root/project_code
find /root/project_code -type f -exec chmod 644 {} \;

echo "é‡å¯æœåŠ¡..."
systemctl start aistudio
sleep 3
systemctl status aistudio

echo "âœ… æ¢å¤å®Œæˆ"
EOF

chmod +x /root/restore_project.sh
```

ä½¿ç”¨ï¼š
```bash
# å…ˆæŸ¥çœ‹å¯ç”¨çš„å¤‡ä»½
ls -la /root | grep project_code_backup

# æ¢å¤æŒ‡å®šå¤‡ä»½
/root/restore_project.sh project_code_backup_20260127_140000
```

## ğŸ¯ æ¨èæµ‹è¯•æµç¨‹

1. **å¤‡ä»½å½“å‰ç‰ˆæœ¬**
   ```bash
   /root/backup_project.sh
   ```

2. **æµ‹è¯•åŒæ­¥ä»£ç **
   - æœ¬åœ°è¿è¡Œï¼š`å¿«é€ŸåŒæ­¥åˆ°é˜¿é‡Œäº‘.bat` é€‰æ‹© `1`
   - æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸

3. **å¦‚æœå¤±è´¥ï¼Œå¿«é€Ÿæ¢å¤**
   ```bash
   /root/restore_project.sh project_code_backup_20260127_140000
   ```

4. **å¦‚æœæˆåŠŸï¼Œç»§ç»­æµ‹è¯•æ•°æ®åº“å’Œå›¾ç‰‡åŒæ­¥**
