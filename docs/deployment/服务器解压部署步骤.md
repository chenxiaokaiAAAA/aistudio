# æœåŠ¡å™¨è§£å‹éƒ¨ç½²æ­¥éª¤

## ğŸ“ å½“å‰çŠ¶æ€

- âœ… å‹ç¼©åŒ…å·²ä¸Šä¼ ï¼š`/root/aistudio.zip`
- âœ… åŸé¡¹ç›®è·¯å¾„ï¼š`/root/project_code/`

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šåœ¨åŸè·¯å¾„è§£å‹ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… ä¸éœ€è¦ä¿®æ”¹æœåŠ¡é…ç½®
- âœ… è·¯å¾„ä¿æŒä¸€è‡´
- âœ… æ•°æ®åº“å’Œå›¾ç‰‡æ–‡ä»¶å¯ä»¥ä¿ç•™

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆé‡è¦ï¼ï¼‰

```bash
# å¤‡ä»½æ•´ä¸ªé¡¹ç›®ç›®å½•
cd /root
cp -r project_code project_code_backup_$(date +%Y%m%d_%H%M%S)

# æˆ–åªå¤‡ä»½é‡è¦æ–‡ä»¶
mkdir -p /root/project_backup
cp -r /root/project_code/instance /root/project_backup/ 2>/dev/null || true
echo "âœ… å¤‡ä»½å®Œæˆ"
```

### æ­¥éª¤2ï¼šç§»åŠ¨å‹ç¼©åŒ…åˆ°é¡¹ç›®ç›®å½•

```bash
# ç§»åŠ¨å‹ç¼©åŒ…åˆ° project_code ç›®å½•
mv /root/aistudio.zip /root/project_code/
cd /root/project_code
```

### æ­¥éª¤3ï¼šè§£å‹æ–‡ä»¶

```bash
# è§£å‹ï¼ˆè¦†ç›–ç°æœ‰æ–‡ä»¶ï¼‰
unzip -o aistudio.zip

# æˆ–å¦‚æœå‹ç¼©åŒ…åœ¨æ ¹ç›®å½•
cd /root/project_code
unzip -o /root/aistudio.zip
```

### æ­¥éª¤4ï¼šæ¢å¤æ•°æ®åº“å’Œå›¾ç‰‡ï¼ˆé‡è¦ï¼ï¼‰

```bash
# æ¢å¤æ•°æ®åº“æ–‡ä»¶ï¼ˆä»å¤‡ä»½ï¼‰
if [ -d /root/project_code_backup_*/instance ]; then
    cp -r /root/project_code_backup_*/instance /root/project_code/
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å·²æ¢å¤"
fi

# æˆ–å¦‚æœæ•°æ®åº“åœ¨ project_data
if [ -d /root/project_data/user_images ]; then
    echo "âœ… å›¾ç‰‡æ–‡ä»¶å·²å­˜åœ¨"
fi
```

### æ­¥éª¤5ï¼šè®¾ç½®æƒé™

```bash
# è®¾ç½®æ–‡ä»¶æƒé™
chmod +x /root/project_code/start_production.py
chmod 755 /root/project_code/instance 2>/dev/null || true
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true
```

### æ­¥éª¤6ï¼šé‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
systemctl restart aistudio

# ç­‰å¾…å‡ ç§’
sleep 3

# æŸ¥çœ‹çŠ¶æ€
systemctl status aistudio --no-pager -l | head -25

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8000

# æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 30 --no-pager
```

---

## ğŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

```bash
#!/bin/bash
echo "=========================================="
echo "éƒ¨ç½²å®Œæ•´é¡¹ç›®"
echo "=========================================="
echo ""

# 1. å¤‡ä»½
echo "[1/6] å¤‡ä»½å½“å‰é¡¹ç›®..."
BACKUP_DIR="/root/project_code_backup_$(date +%Y%m%d_%H%M%S)"
cp -r /root/project_code $BACKUP_DIR
echo "âœ… å·²å¤‡ä»½åˆ°: $BACKUP_DIR"
echo ""

# 2. ç§»åŠ¨å‹ç¼©åŒ…
echo "[2/6] å‡†å¤‡è§£å‹..."
if [ -f /root/aistudio.zip ]; then
    mv /root/aistudio.zip /root/project_code/
    echo "âœ… å‹ç¼©åŒ…å·²ç§»åŠ¨åˆ° project_code ç›®å½•"
elif [ -f /root/project_code/aistudio.zip ]; then
    echo "âœ… å‹ç¼©åŒ…å·²åœ¨ project_code ç›®å½•"
else
    echo "âŒ æœªæ‰¾åˆ°å‹ç¼©åŒ…ï¼Œè¯·æ£€æŸ¥è·¯å¾„"
    exit 1
fi
echo ""

# 3. è§£å‹
echo "[3/6] è§£å‹æ–‡ä»¶..."
cd /root/project_code
unzip -o aistudio.zip
echo "âœ… è§£å‹å®Œæˆ"
echo ""

# 4. æ¢å¤æ•°æ®åº“
echo "[4/6] æ¢å¤æ•°æ®åº“..."
if [ -d "$BACKUP_DIR/instance" ]; then
    cp -r $BACKUP_DIR/instance /root/project_code/
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å·²æ¢å¤"
else
    echo "âš ï¸  æœªæ‰¾åˆ°æ•°æ®åº“å¤‡ä»½ï¼Œå°†ä½¿ç”¨æ–°æ•°æ®åº“"
    mkdir -p /root/project_code/instance
fi
echo ""

# 5. è®¾ç½®æƒé™
echo "[5/6] è®¾ç½®æƒé™..."
chmod +x /root/project_code/start_production.py
chmod 755 /root/project_code/instance 2>/dev/null || true
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true
echo "âœ… æƒé™å·²è®¾ç½®"
echo ""

# 6. é‡å¯æœåŠ¡
echo "[6/6] é‡å¯æœåŠ¡..."
systemctl restart aistudio
sleep 3

echo ""
echo "=========================================="
echo "éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
echo ""
echo "æœåŠ¡çŠ¶æ€ï¼š"
systemctl status aistudio --no-pager -l | head -20

echo ""
echo "ç«¯å£ç›‘å¬ï¼š"
netstat -tlnp | grep 8000 || echo "âš ï¸ ç«¯å£æœªç›‘å¬"

echo ""
echo "æœ€æ–°æ—¥å¿—ï¼š"
journalctl -u aistudio -n 20 --no-pager | tail -10
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status aistudio

# 2. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8000

# 3. æµ‹è¯•è®¿é—®
curl http://localhost:8000/admin/
curl http://121.43.143.59/admin/

# 4. æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 50 --no-pager
```

---

## âš ï¸ é‡è¦æé†’

1. **å¤‡ä»½é‡è¦**ï¼šè§£å‹å‰ä¸€å®šè¦å¤‡ä»½ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“æ–‡ä»¶
2. **æ•°æ®åº“æ–‡ä»¶**ï¼šç¡®ä¿ `instance/pet_painting.db` åœ¨æ­£ç¡®ä½ç½®
3. **å›¾ç‰‡æ–‡ä»¶**ï¼šå¦‚æœå›¾ç‰‡åœ¨ `project_data`ï¼Œä¸éœ€è¦ç§»åŠ¨
4. **æœåŠ¡é…ç½®**ï¼šå¦‚æœä½¿ç”¨åŸè·¯å¾„ï¼ŒæœåŠ¡é…ç½®ä¸éœ€è¦ä¿®æ”¹

---

## ğŸ¯ æ¨èæ‰§è¡Œ

ç›´æ¥å¤åˆ¶ç²˜è´´ä¸Šé¢çš„**ä¸€é”®éƒ¨ç½²è„šæœ¬**ï¼Œå®ƒä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤ã€‚

æ‰§è¡Œåå‘Šè¯‰æˆ‘ç»“æœï¼
