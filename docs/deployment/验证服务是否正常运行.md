# 验证服务是否正常运行

## 快速验证命令

执行以下命令检查服务状态：

```bash
# 1. 查看服务状态
systemctl status aistudio

# 2. 检查端口是否监听
netstat -tlnp | grep 8000

# 3. 测试本地访问
curl http://localhost:8000/admin/

# 4. 测试通过Nginx访问
curl http://121.43.143.59/admin/
```

---

## 服务状态说明

### ✅ 如果服务正常运行

`systemctl status aistudio` 应该显示：
- `Active: active (running)`
- 有进程ID（PID）
- 没有错误信息

### ❌ 如果服务启动失败

`systemctl status aistudio` 可能显示：
- `Active: failed`
- 有错误信息

**查看详细日志**：
```bash
journalctl -u aistudio -n 100 --no-pager
```

---

## 常见问题排查

### 问题1：端口未监听

**检查**：
```bash
netstat -tlnp | grep 8000
```

**如果没有输出**，说明服务未正常启动。

**解决**：
```bash
# 查看日志
journalctl -u aistudio -n 50 --no-pager

# 手动测试启动
cd /root/project_code
source venv/bin/activate
python start_production.py
```

### 问题2：Gunicorn 未安装

**检查**：
```bash
cd /root/project_code
source venv/bin/activate
pip list | grep gunicorn
```

**如果未安装**：
```bash
pip install gunicorn
systemctl restart aistudio
```

### 问题3：数据库文件不存在

**检查**：
```bash
ls -la /root/project_code/instance/
```

**如果不存在**，应用会自动创建，但需要确保目录存在：
```bash
mkdir -p /root/project_code/instance
systemctl restart aistudio
```

### 问题4：导入模块错误

**如果日志显示 `ModuleNotFoundError`**：

```bash
# 检查虚拟环境
cd /root/project_code
source venv/bin/activate
python -c "import test_server; print('OK')"
```

**如果失败**，检查项目结构：
```bash
ls -la /root/project_code/*.py
```

---

## 完整验证流程

```bash
# 1. 服务状态
echo "=== 服务状态 ==="
systemctl status aistudio --no-pager -l

# 2. 端口监听
echo ""
echo "=== 端口监听 ==="
netstat -tlnp | grep 8000 || echo "8000端口未监听"

# 3. 进程检查
echo ""
echo "=== 进程检查 ==="
ps aux | grep gunicorn | grep -v grep || echo "Gunicorn进程未运行"

# 4. 测试访问
echo ""
echo "=== 测试访问 ==="
curl -s -o /dev/null -w "HTTP状态码: %{http_code}\n" http://localhost:8000/admin/ || echo "访问失败"

# 5. 查看日志（最后10行）
echo ""
echo "=== 最近日志 ==="
journalctl -u aistudio -n 10 --no-pager
```

---

## 如果服务正常运行

恭喜！服务已经启动成功。接下来：

1. **测试访问**：
   - 浏览器访问：`http://121.43.143.59/admin/`
   - 默认账号：`admin` / `admin123`

2. **设置开机自启**（如果还没设置）：
   ```bash
   systemctl enable aistudio
   ```

3. **查看实时日志**（如果需要）：
   ```bash
   journalctl -u aistudio -f
   ```

---

## 如果服务仍然失败

请执行以下命令并发送输出：

```bash
# 完整日志
journalctl -u aistudio --no-pager | tail -50

# 手动测试
cd /root/project_code
source venv/bin/activate
python start_production.py
```

把错误信息发给我，我会继续帮您排查。
