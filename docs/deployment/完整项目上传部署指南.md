# å®Œæ•´é¡¹ç›®ä¸Šä¼ éƒ¨ç½²æŒ‡å—

## ğŸ“¦ ä¸ºä»€ä¹ˆéœ€è¦å®Œæ•´ä¸Šä¼ 

å½“å‰é—®é¢˜ï¼š
- âŒ æ•°æ®åº“è·¯å¾„é…ç½®ä¸åŒ¹é…
- âŒ å¯èƒ½ç¼ºå°‘é…ç½®æ–‡ä»¶
- âŒ è·¯å¾„ä¸ä¸€è‡´å¯¼è‡´å„ç§é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼šå®Œæ•´æ‰“åŒ…ä¸Šä¼ æ•´ä¸ªé¡¹ç›®ï¼Œç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨æ­£ç¡®ä½ç½®ã€‚

---

## ğŸ“¤ æœ¬åœ°æ“ä½œï¼šæ‰“åŒ…é¡¹ç›®

### æ–¹æ³•1ï¼šä½¿ç”¨ PowerShell è„šæœ¬ï¼ˆæ¨èï¼‰

åœ¨æœ¬åœ° PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
cd E:\AI-STUDIO\aistudio
.\scripts\deployment\å®Œæ•´é¡¹ç›®æ‰“åŒ…ä¸Šä¼ .ps1
```

è„šæœ¬ä¼šï¼š
1. æ‰“åŒ…æ‰€æœ‰æ ¸å¿ƒæ–‡ä»¶ï¼ˆæ’é™¤æ•°æ®åº“ã€å›¾ç‰‡ç­‰å¤§æ–‡ä»¶ï¼‰
2. åˆ›å»ºå‹ç¼©åŒ…
3. æä¾›ä¸Šä¼ é€‰é¡¹

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰“åŒ…

```powershell
# åˆ›å»ºå‹ç¼©åŒ…ï¼ˆæ’é™¤å¤§æ–‡ä»¶å’Œæ•æ„Ÿæ–‡ä»¶ï¼‰
Compress-Archive -Path `
    app, templates, static, config, docs, scripts, workflows, `
    *.py, requirements.txt, gunicorn.conf.py, start_production.py, `
    .gitignore, README.md `
    -DestinationPath aistudio_full.zip -Force
```

---

## ğŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨

### æ–¹æ³•1ï¼šä½¿ç”¨ WinSCPï¼ˆæ¨èï¼‰

1. æ‰“å¼€ WinSCP
2. è¿æ¥åˆ°ï¼š`root@121.43.143.59`
3. å¯¼èˆªåˆ°ï¼š`/root/project_code/`
4. ä¸Šä¼ å‹ç¼©åŒ…ï¼š`aistudio_full_*.zip`

### æ–¹æ³•2ï¼šä½¿ç”¨ SCP å‘½ä»¤

```powershell
# åœ¨æœ¬åœ° PowerShell æ‰§è¡Œ
scp -i "E:\AI-STUDIO\aistudio\aliyun-key\your-key.pem" `
    aistudio_full_*.zip `
    root@121.43.143.59:/root/project_code/
```

---

## ğŸ”§ æœåŠ¡å™¨æ“ä½œï¼šè§£å‹å’Œéƒ¨ç½²

### æ­¥éª¤1ï¼šå¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# å¤‡ä»½å½“å‰é¡¹ç›®
cd /root
mv project_code project_code_backup_$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºæ–°ç›®å½•
mkdir -p project_code
cd project_code
```

### æ­¥éª¤2ï¼šè§£å‹æ–°æ–‡ä»¶

```bash
# è§£å‹å‹ç¼©åŒ…
unzip -o /root/project_code/aistudio_full_*.zip

# æˆ–å¦‚æœå‹ç¼©åŒ…åœ¨ project_code ç›®å½•
cd /root/project_code
unzip -o aistudio_full_*.zip
```

### æ­¥éª¤3ï¼šæ¢å¤æ•°æ®åº“å’Œå›¾ç‰‡

```bash
# æ¢å¤æ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœå¤‡ä»½äº†ï¼‰
if [ -d /root/project_code_backup_*/instance ]; then
    cp -r /root/project_code_backup_*/instance /root/project_code/
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å·²æ¢å¤"
fi

# æ¢å¤å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚æœå¤‡ä»½äº†ï¼‰
if [ -d /root/project_data_backup ]; then
    cp -r /root/project_data_backup/* /root/project_data/
    echo "âœ… å›¾ç‰‡æ–‡ä»¶å·²æ¢å¤"
fi
```

### æ­¥éª¤4ï¼šè®¾ç½®æƒé™

```bash
# è®¾ç½®æ–‡ä»¶æƒé™
chmod +x /root/project_code/start_production.py
chmod 755 /root/project_code/instance
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true
```

### æ­¥éª¤5ï¼šæ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ

```bash
# å¦‚æœè™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
if [ ! -d /root/project_code/venv ]; then
    cd /root/project_code
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    echo "âœ… è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º"
else
    echo "âœ… è™šæ‹Ÿç¯å¢ƒå·²å­˜åœ¨"
fi
```

### æ­¥éª¤6ï¼šé‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
systemctl restart aistudio

# æŸ¥çœ‹çŠ¶æ€
systemctl status aistudio --no-pager -l | head -25

# æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 30 --no-pager
```

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²è„šæœ¬ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¹¶æ‰§è¡Œï¼š

```bash
#!/bin/bash
echo "=========================================="
echo "å®Œæ•´é¡¹ç›®éƒ¨ç½²è„šæœ¬"
echo "=========================================="
echo ""

# 1. å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
read -p "æ˜¯å¦å¤‡ä»½å½“å‰é¡¹ç›®ï¼Ÿ(y/n) " backup_choice
if [ "$backup_choice" = "y" ]; then
    BACKUP_DIR="/root/project_code_backup_$(date +%Y%m%d_%H%M%S)"
    cp -r /root/project_code $BACKUP_DIR
    echo "âœ… å·²å¤‡ä»½åˆ°: $BACKUP_DIR"
fi

# 2. è§£å‹
echo ""
echo "[2/5] è§£å‹æ–‡ä»¶..."
cd /root/project_code
ZIP_FILE=$(ls aistudio_full_*.zip | head -1)
if [ -f "$ZIP_FILE" ]; then
    unzip -o "$ZIP_FILE"
    echo "âœ… è§£å‹å®Œæˆ"
else
    echo "âŒ æœªæ‰¾åˆ°å‹ç¼©åŒ…: aistudio_full_*.zip"
    exit 1
fi

# 3. æ¢å¤æ•°æ®
echo ""
echo "[3/5] æ¢å¤æ•°æ®åº“å’Œå›¾ç‰‡..."
if [ -d "/root/project_code_backup_"*"/instance" ]; then
    BACKUP_INSTANCE=$(ls -d /root/project_code_backup_*/instance | head -1)
    cp -r $BACKUP_INSTANCE /root/project_code/
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å·²æ¢å¤"
fi

# 4. è®¾ç½®æƒé™
echo ""
echo "[4/5] è®¾ç½®æƒé™..."
chmod +x /root/project_code/start_production.py
chmod 755 /root/project_code/instance 2>/dev/null || true
chmod 644 /root/project_code/instance/pet_painting.db 2>/dev/null || true

# 5. é‡å¯æœåŠ¡
echo ""
echo "[5/5] é‡å¯æœåŠ¡..."
systemctl restart aistudio
sleep 3

echo ""
echo "=========================================="
echo "éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
echo ""
systemctl status aistudio --no-pager -l | head -20
echo ""
netstat -tlnp | grep 8000 || echo "âš ï¸ ç«¯å£æœªç›‘å¬"
```

---

## âœ… éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status aistudio

# 2. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8000

# 3. æµ‹è¯•è®¿é—®
curl http://localhost:8000/admin/
curl http://121.43.143.59/admin/

# 4. æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 30 --no-pager
```

---

## ğŸ¯ æ¨èæµç¨‹

1. **æœ¬åœ°**ï¼šæ‰§è¡Œæ‰“åŒ…è„šæœ¬
2. **æœ¬åœ°**ï¼šä½¿ç”¨ WinSCP ä¸Šä¼ å‹ç¼©åŒ…
3. **æœåŠ¡å™¨**ï¼šå¤‡ä»½å½“å‰é¡¹ç›®ï¼ˆå¯é€‰ï¼‰
4. **æœåŠ¡å™¨**ï¼šè§£å‹æ–°æ–‡ä»¶
5. **æœåŠ¡å™¨**ï¼šæ¢å¤æ•°æ®åº“å’Œå›¾ç‰‡
6. **æœåŠ¡å™¨**ï¼šé‡å¯æœåŠ¡
7. **æœåŠ¡å™¨**ï¼šéªŒè¯éƒ¨ç½²

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“æ–‡ä»¶**ï¼šç¡®ä¿ `instance/pet_painting.db` åœ¨æ­£ç¡®ä½ç½®
2. **å›¾ç‰‡æ–‡ä»¶**ï¼šç¡®ä¿ `project_data/user_images/` ç›®å½•å­˜åœ¨
3. **é…ç½®æ–‡ä»¶**ï¼šç¡®ä¿ `server_config.py` ç­‰é…ç½®æ–‡ä»¶å­˜åœ¨
4. **è™šæ‹Ÿç¯å¢ƒ**ï¼šå¦‚æœé‡æ–°åˆ›å»ºï¼Œéœ€è¦é‡æ–°å®‰è£…ä¾èµ–

---

## ğŸš¨ å¦‚æœä»ç„¶å¤±è´¥

æ‰§è¡Œå®Œæ•´è¯Šæ–­ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
journalctl -u aistudio -n 100 --no-pager | grep -i error

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
systemctl stop aistudio
cd /root/project_code
source venv/bin/activate
python start_production.py
```

æŠŠé”™è¯¯ä¿¡æ¯å‘ç»™æˆ‘ã€‚
