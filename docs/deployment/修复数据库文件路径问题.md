# ä¿®å¤æ•°æ®åº“æ–‡ä»¶è·¯å¾„é—®é¢˜

## ğŸ” é—®é¢˜

é”™è¯¯ï¼š`unable to open database file`

**å¯èƒ½åŸå› **ï¼š
1. æ•°æ®åº“æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®
2. `instance` ç›®å½•ä¸å­˜åœ¨æˆ–æƒé™ä¸è¶³
3. æ•°æ®åº“æ–‡ä»¶æƒé™é—®é¢˜

---

## ğŸ”§ ç«‹å³ä¿®å¤

### æ­¥éª¤1ï¼šæ£€æŸ¥æ•°æ®åº“æ–‡ä»¶ä½ç½®

```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /root/project_code/instance/pet_painting.db

# æ£€æŸ¥ instance ç›®å½•
ls -la /root/project_code/instance/
```

### æ­¥éª¤2ï¼šæ£€æŸ¥æ•°æ®åº“é…ç½®

```bash
# æŸ¥çœ‹ test_server.py ä¸­çš„æ•°æ®åº“é…ç½®
grep -n "SQLALCHEMY_DATABASE_URI" /root/project_code/test_server.py
```

### æ­¥éª¤3ï¼šä¿®å¤è·¯å¾„å’Œæƒé™

```bash
# ç¡®ä¿ instance ç›®å½•å­˜åœ¨
mkdir -p /root/project_code/instance

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
if [ -f /root/project_code/instance/pet_painting.db ]; then
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å­˜åœ¨"
    ls -lh /root/project_code/instance/pet_painting.db
else
    echo "âŒ æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Œéœ€è¦ä¸Šä¼ "
    echo "   ä½ç½®åº”è¯¥æ˜¯: /root/project_code/instance/pet_painting.db"
fi

# è®¾ç½®æ­£ç¡®çš„æƒé™
chmod 644 /root/project_code/instance/pet_painting.db
chmod 755 /root/project_code/instance

# æ£€æŸ¥æƒé™
ls -la /root/project_code/instance/
```

---

## ğŸš¨ å¦‚æœæ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨

### æ–¹æ³•1ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å…¶ä»–ä½ç½®

```bash
# æœç´¢æ•°æ®åº“æ–‡ä»¶
find /root -name "pet_painting.db" 2>/dev/null

# å¦‚æœåœ¨å…¶ä»–ä½ç½®ï¼Œç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®
# mv /æ‰¾åˆ°çš„è·¯å¾„/pet_painting.db /root/project_code/instance/
```

### æ–¹æ³•2ï¼šé‡æ–°ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶

**åœ¨æœ¬åœ°æ‰§è¡Œ**ï¼š
```powershell
# ä½¿ç”¨ SCP ä¸Šä¼ 
scp -i "E:\AI-STUDIO\aistudio\aliyun-key\your-key.pem" `
    "instance\pet_painting.db" `
    root@121.43.143.59:/root/project_code/instance/pet_painting.db
```

**æˆ–ä½¿ç”¨ WinSCP**ï¼š
1. è¿æ¥åˆ°æœåŠ¡å™¨
2. å¯¼èˆªåˆ° `/root/project_code/instance/`
3. ä¸Šä¼  `pet_painting.db`

---

## ğŸ”§ å®Œæ•´ä¿®å¤å‘½ä»¤ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

```bash
# 1. åˆ›å»º instance ç›®å½•
mkdir -p /root/project_code/instance

# 2. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
if [ -f /root/project_code/instance/pet_painting.db ]; then
    echo "âœ… æ•°æ®åº“æ–‡ä»¶å­˜åœ¨"
    ls -lh /root/project_code/instance/pet_painting.db
else
    echo "âŒ æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨"
    echo "   è¯·ä¸Šä¼ åˆ°: /root/project_code/instance/pet_painting.db"
fi

# 3. è®¾ç½®æƒé™
chmod 755 /root/project_code/instance
if [ -f /root/project_code/instance/pet_painting.db ]; then
    chmod 644 /root/project_code/instance/pet_painting.db
fi

# 4. æ£€æŸ¥æƒé™
echo ""
echo "=== ç›®å½•å’Œæ–‡ä»¶æƒé™ ==="
ls -la /root/project_code/instance/

# 5. æ£€æŸ¥æ•°æ®åº“é…ç½®
echo ""
echo "=== æ•°æ®åº“é…ç½® ==="
grep "SQLALCHEMY_DATABASE_URI" /root/project_code/test_server.py | head -1
```

---

## ğŸ“‹ éªŒè¯æ•°æ®åº“è·¯å¾„é…ç½®

æ£€æŸ¥ `test_server.py` ä¸­çš„æ•°æ®åº“é…ç½®ï¼š

```bash
# æŸ¥çœ‹æ•°æ®åº“é…ç½®
grep -A 2 "SQLALCHEMY_DATABASE_URI" /root/project_code/test_server.py
```

**åº”è¯¥çœ‹åˆ°ç±»ä¼¼**ï¼š
```python
app.config['SQLALCHEMY_DATABASE_URI'] = os.environ.get('DATABASE_URL', 'sqlite:///pet_painting.db')
```

**å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„** `sqlite:///pet_painting.db`ï¼Œæ–‡ä»¶åº”è¯¥åœ¨ï¼š
- `/root/project_code/pet_painting.db`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰

**å¦‚æœæ˜¯ instance è·¯å¾„** `sqlite:///instance/pet_painting.db`ï¼Œæ–‡ä»¶åº”è¯¥åœ¨ï¼š
- `/root/project_code/instance/pet_painting.db`

---

## ğŸ¯ æ ¹æ®é…ç½®è°ƒæ•´

### å¦‚æœé…ç½®æ˜¯ç›¸å¯¹è·¯å¾„ `sqlite:///pet_painting.db`

```bash
# æ–‡ä»¶åº”è¯¥åœ¨é¡¹ç›®æ ¹ç›®å½•
ls -la /root/project_code/pet_painting.db

# å¦‚æœä¸å­˜åœ¨ï¼Œä» instance ç›®å½•ç§»åŠ¨æˆ–å¤åˆ¶
if [ -f /root/project_code/instance/pet_painting.db ]; then
    cp /root/project_code/instance/pet_painting.db /root/project_code/pet_painting.db
    chmod 644 /root/project_code/pet_painting.db
fi
```

### å¦‚æœé…ç½®æ˜¯ instance è·¯å¾„

```bash
# ç¡®ä¿ instance ç›®å½•å­˜åœ¨
mkdir -p /root/project_code/instance

# ç¡®ä¿æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
if [ ! -f /root/project_code/instance/pet_painting.db ]; then
    echo "âŒ æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·ä¸Šä¼ åˆ°: /root/project_code/instance/pet_painting.db"
fi
```

---

## âœ… ä¿®å¤åé‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
systemctl restart aistudio

# æŸ¥çœ‹çŠ¶æ€
systemctl status aistudio --no-pager -l | head -20

# æŸ¥çœ‹æ—¥å¿—
journalctl -u aistudio -n 30 --no-pager
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

ä¿®å¤åï¼Œå¦‚æœè¿˜æœ‰é”™è¯¯ï¼Œè¯·æ‰§è¡Œï¼š

```bash
journalctl -u aistudio -n 50 --no-pager | grep -i error
```

æŠŠæ–°çš„é”™è¯¯ä¿¡æ¯å‘ç»™æˆ‘ã€‚
