# ç”Ÿäº§ç¯å¢ƒåœ°å€é…ç½®æŒ‡å—ï¼ˆæœªæ³¨å†ŒåŸŸåï¼‰

## ğŸ“‹ éœ€è¦é…ç½®çš„åœ°æ–¹

ç”±äºä½ è¿˜æ²¡æœ‰æ³¨å†ŒåŸŸåï¼Œå½“å‰ä½¿ç”¨ IP åœ°å€ `121.43.143.59`ï¼Œéœ€è¦åœ¨ä»¥ä¸‹åœ°æ–¹é…ç½®ï¼š

---

## 1. æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼ˆserver_config.pyï¼‰

**ä½ç½®**ï¼š`/root/project_code/server_config.py`

**éœ€è¦ä¿®æ”¹**ï¼š

```python
# ä¿®æ”¹ç¬¬11è¡Œï¼Œå°† 'local' æ”¹ä¸º 'production'
ENV = os.environ.get('SERVER_ENV', 'production')  # æ”¹ä¸º production

# ä¿®æ”¹ç¬¬22-27è¡Œï¼Œå°†åŸŸåæ”¹ä¸ºIPåœ°å€
'production': {
    'base_url': 'http://121.43.143.59',  # æ”¹ä¸ºä½ çš„IP
    'api_base_url': 'http://121.43.143.59/api',
    'static_url': 'http://121.43.143.59/static',
    'media_url': 'http://121.43.143.59/media',
    'notify_url': 'http://121.43.143.59/api/payment/notify'
}
```

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**ï¼š

```bash
cd /root/project_code

# å¤‡ä»½åŸæ–‡ä»¶
cp server_config.py server_config.py.bak

# ä¿®æ”¹é…ç½®
sed -i "s/ENV = os.environ.get('SERVER_ENV', 'local')/ENV = os.environ.get('SERVER_ENV', 'production')/" server_config.py
sed -i "s|'base_url': 'https://photogooo'|'base_url': 'http://121.43.143.59'|" server_config.py
sed -i "s|'api_base_url': 'https://photogooo/api'|'api_base_url': 'http://121.43.143.59/api'|" server_config.py
sed -i "s|'static_url': 'https://photogooo/static'|'static_url': 'http://121.43.143.59/static'|" server_config.py
sed -i "s|'media_url': 'https://photogooo/media'|'media_url': 'http://121.43.143.59/media'|" server_config.py
sed -i "s|'notify_url': 'https://photogooo/api/payment/notify'|'notify_url': 'http://121.43.143.59/api/payment/notify'|" server_config.py

# éªŒè¯ä¿®æ”¹
grep -A 6 "'production':" server_config.py
```

---

## 2. ç®¡ç†åå°ç³»ç»Ÿé…ç½®ï¼ˆæ•°æ®åº“ï¼‰

**ä½ç½®**ï¼šç®¡ç†åå° â†’ ç³»ç»Ÿé…ç½® â†’ æœåŠ¡å™¨URLé…ç½®

**éœ€è¦ä¿®æ”¹çš„URL**ï¼š
- **æœåŠ¡å™¨åŸºç¡€URL**ï¼š`http://121.43.143.59`
- **APIåŸºç¡€URL**ï¼š`http://121.43.143.59/api`
- **åª’ä½“æ–‡ä»¶URL**ï¼š`http://121.43.143.59/media`
- **é™æ€æ–‡ä»¶URL**ï¼š`http://121.43.143.59/static`

**æ“ä½œæ­¥éª¤**ï¼š
1. ç™»å½•ç®¡ç†åå°ï¼š`http://121.43.143.59/admin/`
2. è¿›å…¥ï¼š**ç³»ç»Ÿé…ç½®** â†’ **æœåŠ¡å™¨URLé…ç½®**
3. ä¿®æ”¹ä¸Šè¿°4ä¸ªURL
4. ç‚¹å‡»ä¿å­˜

---

## 3. Nginxé…ç½®ï¼ˆå¯é€‰ï¼Œå¦‚æœä½¿ç”¨åŸŸåï¼‰

**ä½ç½®**ï¼š`/etc/nginx/sites-available/aistudio`

**å½“å‰é…ç½®**ï¼ˆä½¿ç”¨IPï¼Œæ— éœ€ä¿®æ”¹ï¼‰ï¼š
```nginx
server {
    listen 80;
    server_name 121.43.143.59;  # ä½¿ç”¨IPï¼Œæ— éœ€ä¿®æ”¹
    # ...
}
```

**å¦‚æœå°†æ¥æ³¨å†Œäº†åŸŸå**ï¼Œéœ€è¦ä¿®æ”¹ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;  # æ”¹ä¸ºä½ çš„åŸŸå
    # ...
}
```

---

## 4. ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```bash
cd /root/project_code
echo "SERVER_ENV=production" >> .env
```

---

## ğŸ”§ ä¸€é”®é…ç½®è„šæœ¬

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /root/project_code

# å¤‡ä»½
cp server_config.py server_config.py.bak

# ä¿®æ”¹é…ç½®
python3 << 'PYEOF'
import re

with open('server_config.py', 'r', encoding='utf-8') as f:
    content = f.read()

# ä¿®æ”¹ç¯å¢ƒ
content = re.sub(r"ENV = os\.environ\.get\('SERVER_ENV', 'local'\)", 
                 "ENV = os.environ.get('SERVER_ENV', 'production')", content)

# ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒURL
content = re.sub(r"'base_url': 'https://moeart\.cc'", 
                 "'base_url': 'http://121.43.143.59'", content)
content = re.sub(r"'api_base_url': 'https://moeart\.cc/api'", 
                 "'api_base_url': 'http://121.43.143.59/api'", content)
content = re.sub(r"'static_url': 'https://moeart\.cc/static'", 
                 "'static_url': 'http://121.43.143.59/static'", content)
content = re.sub(r"'media_url': 'https://moeart\.cc/media'", 
                 "'media_url': 'http://121.43.143.59/media'", content)
content = re.sub(r"'notify_url': 'https://moeart\.cc/api/payment/notify'", 
                 "'notify_url': 'http://121.43.143.59/api/payment/notify'", content)

with open('server_config.py', 'w', encoding='utf-8') as f:
    f.write(content)

print("âœ… é…ç½®å·²æ›´æ–°")
PYEOF

# éªŒè¯
echo "éªŒè¯é…ç½®ï¼š"
grep -A 6 "'production':" server_config.py

# é‡å¯æœåŠ¡
systemctl restart aistudio
echo "âœ… æœåŠ¡å·²é‡å¯"
```

---

## ğŸ“ åç»­æ³¨å†ŒåŸŸåå

æ³¨å†ŒåŸŸååï¼Œéœ€è¦ï¼š

1. **ä¿®æ”¹ server_config.py**ï¼šå°† IP æ”¹ä¸ºåŸŸåï¼ˆHTTPSï¼‰
2. **ä¿®æ”¹ç®¡ç†åå°é…ç½®**ï¼šæ›´æ–°æœåŠ¡å™¨URLé…ç½®
3. **ä¿®æ”¹ Nginx é…ç½®**ï¼šæ›´æ–° `server_name` å’Œ SSL è¯ä¹¦
4. **é‡å¯æœåŠ¡**ï¼š`systemctl restart aistudio && systemctl restart nginx`

---

## âœ… éªŒè¯é…ç½®

é…ç½®å®Œæˆåï¼ŒéªŒè¯ï¼š

```bash
# æ£€æŸ¥ server_config.py
python3 << 'PYEOF'
from server_config import get_base_url, get_api_base_url, get_media_url
print(f"åŸºç¡€URL: {get_base_url()}")
print(f"API URL: {get_api_base_url()}")
print(f"åª’ä½“URL: {get_media_url()}")
PYEOF
```

åº”è¯¥è¾“å‡ºï¼š
```
åŸºç¡€URL: http://121.43.143.59
API URL: http://121.43.143.59/api
åª’ä½“URL: http://121.43.143.59/media
```
