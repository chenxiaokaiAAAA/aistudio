# ä»£ç åŒæ­¥å®Œæ•´æŒ‡å—

## ðŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›ä»Žæœ¬åœ°å¼€å‘çŽ¯å¢ƒåŒæ­¥ä»£ç åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨çš„å®Œæ•´æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
1. å®Œæ•´çš„ Git æŽ¨é€æµç¨‹
2. æœåŠ¡å™¨ç«¯è‡ªåŠ¨åŒæ­¥è„šæœ¬
3. å®žæ—¶åŒæ­¥æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰

## ðŸš€ æ–¹æ¡ˆä¸€ï¼šGit åŒæ­¥ï¼ˆæŽ¨èï¼‰

### æœ¬åœ°æ“ä½œï¼ˆWindowsï¼‰

#### æ–¹æ³•1ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

ç›´æŽ¥è¿è¡Œï¼š
```cmd
å®Œæ•´åŒæ­¥åˆ°GitHubå¹¶éƒ¨ç½².bat
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ Git çŠ¶æ€
2. æ£€æŸ¥é‡è¦æ–‡ä»¶æ˜¯å¦è¢«å¿½ç•¥
3. æ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼ˆ.gitignore ä¼šè‡ªåŠ¨è¿‡æ»¤ï¼‰
4. æäº¤æ›´æ”¹
5. æŽ¨é€åˆ° GitHub
6. æç¤ºæœåŠ¡å™¨ç«¯åŒæ­¥å‘½ä»¤

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ“ä½œ

```bash
# 1. æ£€æŸ¥çŠ¶æ€
git status

# 2. æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# 3. æŸ¥çœ‹å°†è¦æäº¤çš„æ–‡ä»¶
git status

# 4. æäº¤
git commit -m "æ›´æ–°ä»£ç ï¼šåŒæ­¥æ‰€æœ‰æ–‡ä»¶"

# 5. æŽ¨é€åˆ° GitHub
git push origin main
# æˆ–
git push origin master
```

### æœåŠ¡å™¨ç«¯æ“ä½œï¼ˆLinuxï¼‰

#### æ–¹æ³•1ï¼šä½¿ç”¨åŒæ­¥è„šæœ¬ï¼ˆæŽ¨èï¼‰

```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x /root/project_code/scripts/deployment/sync_from_github.sh

# 2. è¿è¡ŒåŒæ­¥è„šæœ¬
bash /root/project_code/scripts/deployment/sync_from_github.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ Git çŠ¶æ€
2. èŽ·å–æœ€æ–°ä»£ç 
3. å¤‡ä»½å½“å‰ä»£ç 
4. æ‹‰å–æœ€æ–°ä»£ç 
5. æ£€æŸ¥é‡è¦æ–‡ä»¶
6. æ›´æ–°ä¾èµ–
7. é‡å¯æœåŠ¡

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨åŒæ­¥

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/project_code

# 2. èŽ·å–æœ€æ–°ä»£ç 
git fetch origin

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main
# æˆ–
git pull origin master

# 4. é‡å¯æœåŠ¡
systemctl restart aistudio

# 5. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status aistudio
```

## ðŸ”„ æ–¹æ¡ˆäºŒï¼šå®žæ—¶åŒæ­¥ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰

### ä½¿ç”¨ rsyncï¼ˆæŽ¨èç”¨äºŽå¼€å‘é˜¶æ®µï¼‰

#### æœ¬åœ°åˆ›å»ºåŒæ­¥è„šæœ¬

åˆ›å»º `å®žæ—¶åŒæ­¥åˆ°æœåŠ¡å™¨.bat`ï¼š

```batch
@echo off
chcp 65001 >nul
title å®žæ—¶åŒæ­¥ä»£ç åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨

echo ========================================
echo    å®žæ—¶åŒæ­¥ä»£ç åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
echo ========================================
echo.

set SERVER_IP=121.43.143.59
set SERVER_USER=root
set SERVER_PATH=/root/project_code
set LOCAL_PATH=%~dp0

echo æ­£åœ¨åŒæ­¥ä»£ç åˆ°æœåŠ¡å™¨...
echo æœåŠ¡å™¨: %SERVER_USER%@%SERVER_IP%:%SERVER_PATH%
echo.

REM ä½¿ç”¨ rsync åŒæ­¥ï¼ˆéœ€è¦å®‰è£… Git Bash æˆ– WSLï¼‰
REM æŽ’é™¤ä¸éœ€è¦åŒæ­¥çš„æ–‡ä»¶
rsync -avz --exclude='.git' --exclude='__pycache__' --exclude='*.pyc' --exclude='*.db' --exclude='uploads/' --exclude='final_works/' --exclude='hd_images/' --exclude='logs/*.log' --exclude='.env' --exclude='server_config.py' "%LOCAL_PATH%" %SERVER_USER%@%SERVER_IP%:%SERVER_PATH%/

if %errorlevel% == 0 (
    echo.
    echo âœ… åŒæ­¥å®Œæˆ
    echo.
    echo è¯·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š
    echo   systemctl restart aistudio
) else (
    echo.
    echo [é”™è¯¯] åŒæ­¥å¤±è´¥
    echo æç¤ºï¼šéœ€è¦å®‰è£… rsync æˆ–ä½¿ç”¨ Git Bash
)

pause
```

### ä½¿ç”¨ Git Hookï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰

#### æœåŠ¡å™¨ç«¯è®¾ç½® Git Hook

```bash
# 1. åˆ›å»º post-receive hook
cat > /root/project_code/.git/hooks/post-receive << 'EOF'
#!/bin/bash
cd /root/project_code
git pull origin main
systemctl restart aistudio
echo "ä»£ç å·²è‡ªåŠ¨åŒæ­¥å¹¶é‡å¯æœåŠ¡"
EOF

# 2. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x /root/project_code/.git/hooks/post-receive
```

## ðŸ“ é‡è¦æ–‡ä»¶æ£€æŸ¥æ¸…å•

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å·²æäº¤åˆ° Gitï¼š

### æ ¸å¿ƒåº”ç”¨æ–‡ä»¶
- âœ… `test_server.py` - ä¸»åº”ç”¨æ–‡ä»¶
- âœ… `start_production.py` - ç”Ÿäº§çŽ¯å¢ƒå¯åŠ¨è„šæœ¬
- âœ… `gunicorn.conf.py` - Gunicorn é…ç½®
- âœ… `requirements.txt` - Python ä¾èµ–

### é…ç½®æ–‡ä»¶
- âœ… `config/nginx_linux.conf` - Nginx é…ç½®
- âœ… `config/nginx_linux_site.conf` - Nginx ç«™ç‚¹é…ç½®

### åº”ç”¨ä»£ç 
- âœ… `app/` - åº”ç”¨ä¸»ç›®å½•
  - âœ… `app/routes/` - è·¯ç”±
  - âœ… `app/services/` - æœåŠ¡
  - âœ… `app/utils/` - å·¥å…·å‡½æ•°
  - âœ… `app/models.py` - æ•°æ®æ¨¡åž‹

### æ¨¡æ¿å’Œé™æ€æ–‡ä»¶
- âœ… `templates/` - HTML æ¨¡æ¿
- âœ… `static/css/` - CSS æ–‡ä»¶
- âœ… `static/js/` - JavaScript æ–‡ä»¶

### è„šæœ¬å’Œæ–‡æ¡£
- âœ… `scripts/` - è„šæœ¬æ–‡ä»¶
- âœ… `docs/` - æ–‡æ¡£

### ä¸ä¼šè¢«åŒæ­¥çš„æ–‡ä»¶ï¼ˆæ­£å¸¸ï¼‰
- âŒ `*.db` - æ•°æ®åº“æ–‡ä»¶ï¼ˆéœ€è¦å•ç‹¬å¤‡ä»½ï¼‰
- âŒ `uploads/` - ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
- âŒ `final_works/` - AI ç”Ÿæˆçš„æ•ˆæžœå›¾
- âŒ `hd_images/` - é«˜æ¸…å›¾ç‰‡
- âŒ `.env` - çŽ¯å¢ƒå˜é‡
- âŒ `server_config.py` - æœåŠ¡å™¨é…ç½®ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
- âŒ `instance/*.db` - å®žä¾‹æ•°æ®åº“

## ðŸ” éªŒè¯åŒæ­¥ç»“æžœ

### æœ¬åœ°éªŒè¯

```bash
# æŸ¥çœ‹å°†è¦æäº¤çš„æ–‡ä»¶
git status

# æŸ¥çœ‹å·²è·Ÿè¸ªçš„æ–‡ä»¶
git ls-files

# éªŒè¯ç‰¹å®šæ–‡ä»¶æ˜¯å¦è¢«å¿½ç•¥
git check-ignore -v test_server.py
```

### æœåŠ¡å™¨ç«¯éªŒè¯

```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /root/project_code/test_server.py
ls -la /root/project_code/start_production.py
ls -la /root/project_code/gunicorn.conf.py

# 2. æ£€æŸ¥ Git çŠ¶æ€
cd /root/project_code
git status
git log -1

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status aistudio

# 4. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tuln | grep 8000
```

## ðŸš¨ å¸¸è§é—®é¢˜

### Q1: æŸäº›æ–‡ä»¶æ²¡æœ‰è¢«åŒæ­¥

**åŽŸå› **ï¼šæ–‡ä»¶è¢« `.gitignore` å¿½ç•¥äº†

**è§£å†³**ï¼š
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦çœŸçš„éœ€è¦åŒæ­¥
2. å¦‚æžœç¡®å®žéœ€è¦ï¼Œä¿®æ”¹ `.gitignore` æˆ–ä½¿ç”¨ `git add -f æ–‡ä»¶è·¯å¾„`

### Q2: æœåŠ¡å™¨ç«¯æ‹‰å–å¤±è´¥

**åŽŸå› **ï¼šå¯èƒ½æœ‰æœ¬åœ°ä¿®æ”¹æœªæäº¤

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹æœ¬åœ°ä¿®æ”¹
git status

# å¤‡ä»½æœ¬åœ°ä¿®æ”¹
git stash

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æ¢å¤æœ¬åœ°ä¿®æ”¹ï¼ˆå¦‚æžœéœ€è¦ï¼‰
git stash pop
```

### Q3: æ•°æ®åº“æ–‡ä»¶ä¸åŒæ­¥

**åŽŸå› **ï¼šæ•°æ®åº“æ–‡ä»¶è¢« `.gitignore` å¿½ç•¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰

**è§£å†³**ï¼š
1. æ•°æ®åº“æ–‡ä»¶éœ€è¦å•ç‹¬å¤‡ä»½å’Œæ¢å¤
2. ä½¿ç”¨ `scp` æˆ– `rsync` æ‰‹åŠ¨åŒæ­¥æ•°æ®åº“æ–‡ä»¶

### Q4: åŒæ­¥åŽæœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³**ï¼š
```bash
# 1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u aistudio -n 100

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /root/project_code/test_server.py

# 3. æ£€æŸ¥è™šæ‹ŸçŽ¯å¢ƒ
source /root/project_code/venv/bin/activate
python --version
pip list

# 4. æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
cd /root/project_code
python start_production.py
```

## ðŸ“‹ å®Œæ•´å·¥ä½œæµç¨‹

### æ—¥å¸¸å¼€å‘æµç¨‹

1. **æœ¬åœ°å¼€å‘**
   - ä¿®æ”¹ä»£ç 
   - æµ‹è¯•åŠŸèƒ½

2. **æäº¤åˆ° Git**
   ```bash
   git add .
   git commit -m "åŠŸèƒ½æè¿°"
   git push origin main
   ```

3. **æœåŠ¡å™¨ç«¯åŒæ­¥**
   ```bash
   cd /root/project_code
   bash scripts/deployment/sync_from_github.sh
   ```

4. **éªŒè¯éƒ¨ç½²**
   ```bash
   systemctl status aistudio
   curl http://localhost:8000/health
   ```

### ç´§æ€¥ä¿®å¤æµç¨‹

1. **æœ¬åœ°å¿«é€Ÿä¿®å¤**
2. **ç«‹å³æŽ¨é€**
   ```bash
   git add .
   git commit -m "ç´§æ€¥ä¿®å¤ï¼šé—®é¢˜æè¿°"
   git push origin main
   ```
3. **æœåŠ¡å™¨ç«¯å¿«é€ŸåŒæ­¥**
   ```bash
   cd /root/project_code && git pull && systemctl restart aistudio
   ```

## ðŸ’¡ æœ€ä½³å®žè·µ

1. **æäº¤å‰æ£€æŸ¥**
   - è¿è¡Œ `git status` æŸ¥çœ‹å°†è¦æäº¤çš„æ–‡ä»¶
   - ç¡®è®¤æ²¡æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆAPI å¯†é’¥ã€å¯†ç ç­‰ï¼‰

2. **æäº¤ä¿¡æ¯è§„èŒƒ**
   - ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
   - ä¾‹å¦‚ï¼š`åŠŸèƒ½ï¼šæ·»åŠ æ–°åŠŸèƒ½`ã€`ä¿®å¤ï¼šè§£å†³ç™»å½•é—®é¢˜`

3. **å®šæœŸåŒæ­¥**
   - æ¯å¤©è‡³å°‘åŒæ­¥ä¸€æ¬¡
   - é‡è¦åŠŸèƒ½å®ŒæˆåŽç«‹å³åŒæ­¥

4. **å¤‡ä»½æ•°æ®åº“**
   - æ•°æ®åº“æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åŒæ­¥
   - å®šæœŸæ‰‹åŠ¨å¤‡ä»½æ•°æ®åº“æ–‡ä»¶

5. **æµ‹è¯•åŽå†éƒ¨ç½²**
   - æœ¬åœ°æµ‹è¯•é€šè¿‡åŽå†æŽ¨é€åˆ°æœåŠ¡å™¨
   - æœåŠ¡å™¨ç«¯åŒæ­¥åŽç«‹å³éªŒè¯åŠŸèƒ½

## ðŸ”— ç›¸å…³æ–‡æ¡£

- [LinuxæœåŠ¡å™¨å¸¸ç”¨å‘½ä»¤](./LinuxæœåŠ¡å™¨å¸¸ç”¨å‘½ä»¤.md)
- [æœåŠ¡å¯åŠ¨è¯´æ˜Ž](./æœåŠ¡å¯åŠ¨è¯´æ˜Ž.md)
- [GitHubä¸Šä¼ æŒ‡å—](./GitHubä¸Šä¼ æŒ‡å—.md)
