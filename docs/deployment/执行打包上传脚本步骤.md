# 执行打包上传脚本步骤

## 📋 快速步骤

### 步骤1：打开 PowerShell

1. 按 `Win + X`
2. 选择 **"Windows PowerShell"** 或 **"终端"**
3. 或按 `Win + R`，输入 `powershell`，按回车

### 步骤2：进入项目目录

```powershell
cd E:\AI-STUDIO\aistudio
```

### 步骤3：执行打包脚本

```powershell
.\scripts\deployment\完整项目打包上传.ps1
```

---

## 🔧 详细步骤

### 方法1：直接执行（推荐）

1. **打开 PowerShell**
   - 在项目文件夹 `E:\AI-STUDIO\aistudio` 中
   - 按住 `Shift`，右键点击空白处
   - 选择 **"在此处打开 PowerShell 窗口"**

2. **执行脚本**
   ```powershell
   .\scripts\deployment\完整项目打包上传.ps1
   ```

3. **如果提示执行策略错误**
   ```powershell
   # 临时允许执行脚本
   Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
   
   # 然后再次执行
   .\scripts\deployment\完整项目打包上传.ps1
   ```

### 方法2：使用完整路径

```powershell
# 在任意 PowerShell 窗口执行
cd E:\AI-STUDIO\aistudio
& "E:\AI-STUDIO\aistudio\scripts\deployment\完整项目打包上传.ps1"
```

---

## ⚠️ 如果遇到执行策略错误

如果看到错误：`无法加载文件，因为在此系统上禁止运行脚本`

**解决方法1：临时允许（推荐）**
```powershell
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
.\scripts\deployment\完整项目打包上传.ps1
```

**解决方法2：永久允许（需要管理员权限）**
```powershell
# 以管理员身份运行 PowerShell，然后执行：
Set-ExecutionPolicy RemoteSigned
```

---

## 📤 脚本执行后的操作

脚本会提示您选择上传方式：

1. **选项1：使用SCP命令上传**
   - 需要SSH密钥文件在 `aliyun-key` 目录
   - 脚本会自动查找 `.pem` 或 `.key` 文件

2. **选项2：使用WinSCP手动上传（推荐）**
   - 脚本会显示上传说明
   - 使用 WinSCP 图形界面上传

3. **选项3：稍后手动上传**
   - 脚本会显示压缩包位置
   - 稍后手动上传

---

## 🎯 完整操作流程

### 本地操作

```powershell
# 1. 打开 PowerShell
# 2. 进入项目目录
cd E:\AI-STUDIO\aistudio

# 3. 如果遇到执行策略问题
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

# 4. 执行打包脚本
.\scripts\deployment\完整项目打包上传.ps1

# 5. 选择上传方式（推荐选择 2，使用 WinSCP）
```

### 上传到服务器

**如果选择 WinSCP 上传：**
1. 打开 WinSCP
2. 连接到：`root@121.43.143.59`
3. 导航到：`/root/project_code/`
4. 上传压缩包：`aistudio_full_*.zip`

### 服务器操作

```bash
# 1. 备份当前项目
cd /root
mv project_code project_code_backup_$(date +%Y%m%d_%H%M%S)
mkdir -p project_code
cd project_code

# 2. 解压新文件（如果已上传）
unzip -o aistudio_full_*.zip

# 3. 恢复数据库
if [ -d /root/project_code_backup_*/instance ]; then
    cp -r /root/project_code_backup_*/instance /root/project_code/
fi

# 4. 设置权限
chmod +x /root/project_code/start_production.py
chmod 755 /root/project_code/instance 2>/dev/null || true

# 5. 重启服务
systemctl restart aistudio
systemctl status aistudio
```

---

## 📝 注意事项

1. **执行策略**：如果遇到权限问题，使用 `Bypass` 临时允许
2. **压缩包位置**：脚本会在项目根目录创建压缩包
3. **文件大小**：压缩包通常几十MB，上传需要一些时间
4. **备份重要**：服务器上解压前建议先备份

---

## 🚨 常见问题

### Q1: 提示"无法加载文件"
**A**: 执行 `Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process`

### Q2: 找不到脚本文件
**A**: 确保在项目根目录 `E:\AI-STUDIO\aistudio` 执行

### Q3: 压缩包在哪里
**A**: 在项目根目录，文件名类似 `aistudio_full_20260126_234500.zip`

### Q4: 上传失败
**A**: 使用 WinSCP 手动上传更可靠
