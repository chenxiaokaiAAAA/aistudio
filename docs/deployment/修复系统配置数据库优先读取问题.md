# ä¿®å¤ç³»ç»Ÿé…ç½®æ•°æ®åº“ä¼˜å…ˆè¯»å–é—®é¢˜

## ğŸ” é—®é¢˜æè¿°

åœ¨ç³»ç»Ÿé…ç½®é¡µé¢ï¼ˆ`/admin/system-config`ï¼‰ä¸­è®¾ç½®äº†æœåŠ¡å™¨URLé…ç½®ï¼ˆå¦‚ `http://121.43.143.59`ï¼‰ï¼Œä½†æ˜¯å°ç¨‹åºé£æ ¼åº“çš„å›¾ç‰‡URLä»ç„¶æ˜¾ç¤ºæ—§çš„åŸŸåï¼ˆå¦‚ `photogooo`ï¼‰ï¼Œè¯´æ˜æ•°æ®åº“é…ç½®æ²¡æœ‰ç”Ÿæ•ˆã€‚

## ğŸ”§ é—®é¢˜åŸå› 

`test_server.py` ä¸­çš„ `get_base_url()` ç­‰å‡½æ•°ç›´æ¥ä½¿ç”¨ `server_config.py` ä¸­çš„é…ç½®ï¼Œæ²¡æœ‰ä¼˜å…ˆä»æ•°æ®åº“è¯»å–é…ç½®ã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶ï¼š`test_server.py`

**ä½ç½®**ï¼šçº¦ç¬¬67-140è¡Œ

**ä¿®æ”¹å†…å®¹**ï¼š

1. **å¯¼å…¥æ—¶ä½¿ç”¨åˆ«å**ï¼šå°† `server_config` ä¸­çš„å‡½æ•°å¯¼å…¥ä¸ºå¸¦ `_server_config_` å‰ç¼€çš„åˆ«å
2. **é‡æ–°å®šä¹‰å…¨å±€å‡½æ•°**ï¼šå®šä¹‰æ–°çš„ `get_base_url()` ç­‰å‡½æ•°ï¼Œä¼˜å…ˆä»æ•°æ®åº“è¯»å–é…ç½®

**å…³é”®ä»£ç **ï¼š

```python
# å¯¼å…¥æœåŠ¡å™¨é…ç½®ï¼ˆä½¿ç”¨åˆ«åï¼‰
try:
    from server_config import get_base_url as _server_config_get_base_url, \
                             get_media_url as _server_config_get_media_url, \
                             get_static_url as _server_config_get_static_url, \
                             get_notify_url as _server_config_get_notify_url, \
                             get_api_base_url as _server_config_get_api_base_url
    SERVER_CONFIG_AVAILABLE = True
except ImportError:
    # ... é»˜è®¤å€¼å¤„ç† ...

# é‡æ–°å®šä¹‰å…¨å±€å‡½æ•°ï¼ˆä¼˜å…ˆä»æ•°æ®åº“è¯»å–ï¼‰
def get_base_url():
    """è·å–æœåŠ¡å™¨åŸºç¡€URLï¼ˆä¼˜å…ˆä»æ•°æ®åº“è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨server_configï¼‰"""
    try:
        import sys
        if 'test_server' in sys.modules:
            test_server_module = sys.modules['test_server']
            if hasattr(test_server_module, 'MODELS_AVAILABLE') and test_server_module.MODELS_AVAILABLE:
                if hasattr(test_server_module, 'AIConfig'):
                    AIConfig = test_server_module.AIConfig
                    if hasattr(AIConfig, 'query'):
                        config = AIConfig.query.filter_by(config_key='server_base_url').first()
                        if config and config.config_value:
                            return config.config_value
    except:
        pass
    return _server_config_get_base_url()
```

**åŒæ ·çš„é€»è¾‘åº”ç”¨äº**ï¼š
- `get_media_url()` - è¯»å– `server_media_url`
- `get_static_url()` - è¯»å– `server_static_url`
- `get_api_base_url()` - è¯»å– `server_api_url`
- `get_notify_url()` - ä¿æŒä½¿ç”¨ `server_config`ï¼ˆé€šçŸ¥URLé€šå¸¸ä¸éœ€è¦ä»æ•°æ®åº“è¯»å–ï¼‰

---

## ğŸ“‹ é…ç½®ä¼˜å…ˆçº§

ä¿®å¤åçš„é…ç½®è¯»å–ä¼˜å…ˆçº§ï¼š

1. **æ•°æ®åº“é…ç½®**ï¼ˆ`AIConfig` è¡¨ä¸­çš„é…ç½®ï¼‰
   - `server_base_url`
   - `server_media_url`
   - `server_static_url`
   - `server_api_url`

2. **æ–‡ä»¶é…ç½®**ï¼ˆ`server_config.py` ä¸­çš„é…ç½®ï¼‰
   - å¦‚æœæ•°æ®åº“æ²¡æœ‰é…ç½®ï¼Œåˆ™ä½¿ç”¨æ–‡ä»¶é…ç½®

3. **é»˜è®¤å€¼**
   - å¦‚æœæ–‡ä»¶é…ç½®ä¹Ÿä¸å¯ç”¨ï¼Œä½¿ç”¨ç¡¬ç¼–ç çš„é»˜è®¤å€¼

---

## ğŸš€ éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥æ•°æ®åº“é…ç½®

åœ¨ç³»ç»Ÿé…ç½®é¡µé¢ï¼ˆ`/admin/system-config`ï¼‰ç¡®è®¤ï¼š
- æœåŠ¡å™¨åŸºç¡€URLï¼š`http://121.43.143.59`
- APIåŸºç¡€URLï¼š`http://121.43.143.59/api`
- åª’ä½“æ–‡ä»¶URLï¼š`http://121.43.143.59/media`
- é™æ€æ–‡ä»¶URLï¼š`http://121.43.143.59/static`

### 2. é‡å¯æœåŠ¡

```bash
systemctl restart aistudio
```

### 3. æµ‹è¯•å°ç¨‹åº

- æ‰“å¼€å°ç¨‹åºé£æ ¼åº“é¡µé¢
- æ£€æŸ¥å›¾ç‰‡URLæ˜¯å¦å·²æ›´æ–°ä¸º `http://121.43.143.59`
- æ£€æŸ¥å›¾ç‰‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
journalctl -u aistudio -f
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“é…ç½®ä¼˜å…ˆ**ï¼šç³»ç»Ÿé…ç½®é¡µé¢ä¸­ä¿å­˜çš„é…ç½®ä¼šç«‹å³ç”Ÿæ•ˆï¼ˆéœ€è¦é‡å¯æœåŠ¡ï¼‰
2. **æ–‡ä»¶é…ç½®ä½œä¸ºåå¤‡**ï¼šå¦‚æœæ•°æ®åº“æ²¡æœ‰é…ç½®ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ `server_config.py` ä¸­çš„é…ç½®
3. **åŠ¨æ€è¯»å–**ï¼šæ¯æ¬¡è°ƒç”¨ `get_base_url()` ç­‰å‡½æ•°æ—¶ï¼Œéƒ½ä¼šé‡æ–°ä»æ•°æ®åº“è¯»å–ï¼Œç¡®ä¿é…ç½®å®æ—¶æ›´æ–°

---

## ğŸ”„ ç›¸å…³æ–‡ä»¶

- `test_server.py` - ä¸»æœåŠ¡å™¨æ–‡ä»¶ï¼ˆå·²ä¿®å¤ï¼‰
- `server_config.py` - æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼ˆä½œä¸ºåå¤‡ï¼‰
- `app/routes/miniprogram/catalog.py` - å°ç¨‹åºé£æ ¼åˆ†ç±»APIï¼ˆå·²ä¿®å¤ `photogooo` åŸŸåæ›¿æ¢ï¼‰
- `app/routes/admin_system_api.py` - ç³»ç»Ÿé…ç½®APIï¼ˆå·²æ”¯æŒæ•°æ®åº“é…ç½®ï¼‰

---

## âœ… ä¿®å¤æ•ˆæœ

ä¿®å¤åï¼š
- âœ… ç³»ç»Ÿé…ç½®é¡µé¢ä¸­ä¿å­˜çš„URLé…ç½®ä¼šç«‹å³ç”Ÿæ•ˆ
- âœ… å°ç¨‹åºé£æ ¼åº“å›¾ç‰‡URLä¼šè‡ªåŠ¨ä½¿ç”¨æ•°æ®åº“é…ç½®
- âœ… æ‰€æœ‰ä½¿ç”¨ `get_base_url()` ç­‰å‡½æ•°çš„åœ°æ–¹éƒ½ä¼šä¼˜å…ˆä½¿ç”¨æ•°æ®åº“é…ç½®
- âœ… å¦‚æœæ•°æ®åº“æ²¡æœ‰é…ç½®ï¼Œä¼šè‡ªåŠ¨å›é€€åˆ°æ–‡ä»¶é…ç½®
