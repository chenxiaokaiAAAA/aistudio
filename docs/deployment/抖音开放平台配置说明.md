# 抖音开放平台集成配置说明

## 🚀 快速开始

### 1. 注册抖音开放平台
1. 访问 [抖音开放平台](https://developer.open-douyin.com/)
2. 注册开发者账号
3. 创建应用，选择"小店"类型
4. 获取 `App ID` 和 `App Secret`

### 2. 配置应用信息
编辑 `douyin_config.py` 文件：

```python
DOUYIN_OPEN_CONFIG = {
    'app_id': 'your_app_id',                    # 替换为您的App ID
    'app_secret': 'your_app_secret',            # 替换为您的App Secret
    'shop_id': 'your_shop_id',                  # 替换为您的店铺ID
    'webhook_secret': 'your_webhook_secret',    # 设置Webhook签名密钥
}
```

### 3. 配置Webhook
1. 在抖音开放平台配置Webhook URL：
   ```
   https://yourdomain.com/api/douyin/webhook
   ```
2. 选择需要监听的事件：
   - 订单创建
   - 订单支付
   - 订单发货
   - 订单完成
   - 订单取消

### 4. 启动同步功能
访问后台管理页面：
```
https://yourdomain.com/admin/douyin
```

## 📋 功能说明

### 同步方式
1. **API定时同步** - 每5分钟自动同步
2. **Webhook实时同步** - 订单状态变化时实时推送
3. **手动同步** - 后台管理页面手动触发

### 支持的操作
- ✅ 订单创建同步
- ✅ 订单状态更新
- ✅ 订单取消处理
- ✅ 重复订单检测
- ✅ 错误重试机制

## 🔧 配置项说明

### API配置
- `app_id`: 抖音开放平台应用ID
- `app_secret`: 抖音开放平台应用密钥
- `shop_id`: 抖音小店店铺ID
- `base_url`: API基础URL（默认：https://open.douyin.com）

### Webhook配置
- `webhook_secret`: Webhook签名验证密钥
- `webhook_url`: Webhook回调URL

### 同步配置
- `sync_interval`: 定时同步间隔（分钟）
- `retry_times`: 失败重试次数
- `timeout`: API请求超时时间

## 🚨 注意事项

### 1. 权限申请
- 需要申请"小店订单管理"权限
- 需要申请"Webhook回调"权限
- 权限审核可能需要1-3个工作日

### 2. API限制
- 每个应用每天有API调用次数限制
- 建议使用Webhook方式减少API调用
- 实现请求频率控制

### 3. 数据安全
- 确保Webhook签名验证正确
- 使用HTTPS协议
- 定期更新访问令牌

## 🐛 故障排查

### 常见问题
1. **API调用失败**
   - 检查App ID和App Secret是否正确
   - 确认应用权限是否已申请
   - 检查网络连接

2. **Webhook不工作**
   - 确认Webhook URL可访问
   - 检查签名验证逻辑
   - 查看服务器日志

3. **订单同步失败**
   - 检查数据库连接
   - 确认订单数据格式
   - 查看错误日志

### 调试方法
1. 使用测试接口验证API连接
2. 查看同步日志了解详细错误
3. 检查数据库中的订单记录

## 📞 技术支持

如遇到问题，请：
1. 查看服务器日志
2. 检查配置文件
3. 联系技术支持

---
**最后更新**: 2025-09-19  
**版本**: v1.0




