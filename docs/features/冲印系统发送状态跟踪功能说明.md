# 冲印系统发送状态跟踪功能使用说明

## 功能概述

新增的冲印系统发送状态跟踪功能，让您能够实时监控高清图片是否成功发送给厂家，以及查看发送失败的具体原因。

## 新增功能

### 1. 发送状态跟踪
- **未发送** (`not_sent`): 订单尚未尝试发送到冲印系统
- **发送中** (`sending`): 正在发送到冲印系统
- **发送成功** (`sent_success`): 成功发送到冲印系统
- **发送失败** (`sent_failed`): 发送失败，可查看具体错误信息

### 2. 详细日志记录
- **发送时间**: 记录每次发送尝试的时间
- **错误信息**: 如果发送失败，记录具体的错误原因
- **响应数据**: 冲印系统返回的完整响应数据

## 如何查看发送状态

### 在订单详情页面查看

1. 进入管理后台：`http://photogooo/admin/`
2. 点击任意订单的"查看详情"按钮
3. 在订单信息区域，您会看到"冲印系统发送状态"部分

### 状态显示说明

- **绿色"发送成功"**: 高清图片已成功发送给厂家
- **红色"发送失败"**: 发送失败，点击查看具体错误信息
- **黄色"发送中"**: 正在发送，请稍等
- **灰色"未发送"**: 尚未尝试发送

### 查看详细响应数据

如果发送成功，您可以点击"查看冲印系统响应"按钮，查看厂家系统返回的完整响应数据。

## 发送流程

1. **上传高清图片**: 在订单状态为"待发货"时上传高清放大图
2. **状态自动变更**: 上传后订单状态自动变为"高清放大"
3. **自动发送**: 系统自动尝试发送高清图片到冲印系统
4. **状态更新**: 发送完成后，订单状态变为"已发货"

## 常见问题排查

### 发送失败的可能原因

1. **图片文件不存在**: 高清图片文件丢失或路径错误
2. **网络连接问题**: 无法连接到冲印系统API
3. **API配置错误**: 冲印系统配置信息不正确
4. **权限问题**: API认证失败或权限不足
5. **数据格式错误**: 发送的数据格式不符合冲印系统要求

### 如何重新发送

如果发送失败，您可以：
1. 检查错误信息，修复问题
2. 重新上传高清图片
3. 系统会自动重新尝试发送

## 技术实现

### 数据库字段
- `printer_send_status`: 发送状态
- `printer_send_time`: 发送时间
- `printer_error_message`: 错误信息
- `printer_response_data`: 响应数据

### 日志记录
所有发送操作都会记录详细的日志，包括：
- 发送开始时间
- 图片文件路径
- API请求数据
- 响应结果
- 错误信息

## 配置说明

确保 `printer_config.py` 中的配置正确：
- `enabled`: 设置为 `True` 启用冲印系统集成
- `api_base_url`: 冲印系统API地址
- `source_app_id`: 您的系统标识
- `shop_id`: 影楼编号
- `shop_name`: 影楼名称

## 注意事项

1. **文件访问**: 确保冲印系统能够访问您的高清图片文件
2. **网络连接**: 确保服务器能够访问冲印系统API
3. **数据备份**: 系统会自动备份数据库，但建议定期手动备份
4. **监控日志**: 定期检查发送日志，及时发现问题

通过这个功能，您可以完全掌控订单的发送状态，确保每个订单都能顺利到达厂家！

