# ç¼“å­˜ç³»ç»Ÿä½¿ç”¨æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2026-02-04  
**çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ“‹ æ¦‚è¿°

ç¼“å­˜ç³»ç»Ÿä½¿ç”¨Redisæ¥ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚

**é¢„æœŸæ•ˆæœ**:
- APIå“åº”æ—¶é—´å‡å°‘ 50-70%
- æ•°æ®åº“æŸ¥è¯¢å‹åŠ›å‡å°‘ 60-80%
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…Redis

**Windows:**
```bash
# ä½¿ç”¨Chocolatey
choco install redis-64

# æˆ–ä¸‹è½½å®‰è£…åŒ…
# https://github.com/microsoftarchive/redis/releases
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get update
sudo apt-get install redis-server
sudo systemctl start redis
sudo systemctl enable redis
```

**Linux (CentOS/RHEL):**
```bash
sudo yum install redis
sudo systemctl start redis
sudo systemctl enable redis
```

**Mac:**
```bash
brew install redis
brew services start redis
```

### 2. å®‰è£…Pythonä¾èµ–

```bash
pip install redis>=5.0.0
```

æˆ–ä½¿ç”¨requirements.txt:
```bash
pip install -r requirements.txt
```

### 3. é…ç½®Redisè¿æ¥

**æ–¹æ³•1: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ :
```bash
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=  # å¦‚æœæœ‰å¯†ç ï¼Œå¡«å†™å¯†ç 
```

**æ–¹æ³•2: ä½¿ç”¨é»˜è®¤é…ç½®**

å¦‚æœä¸é…ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼:
- Host: localhost
- Port: 6379
- DB: 0
- Password: None

---

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨ï¼ˆæ¨èï¼‰â­

æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€æ·»åŠ è£…é¥°å™¨ï¼š

```python
from app.services.cache_service import cached, CACHE_PREFIXES

@bp.route('/products', methods=['GET'])
@cached(timeout=1800, key_prefix=CACHE_PREFIXES['PRODUCTS'])  # ç¼“å­˜30åˆ†é’Ÿ
def get_products():
    """è·å–äº§å“åˆ—è¡¨ï¼ˆè‡ªåŠ¨ç¼“å­˜ï¼‰"""
    products = Product.query.filter_by(is_active=True).all()
    return jsonify([p.to_dict() for p in products])
```

**ä¼˜ç‚¹**:
- ä»£ç ç®€æ´
- è‡ªåŠ¨å¤„ç†ç¼“å­˜é”®ç”Ÿæˆ
- è‡ªåŠ¨å¤„ç†åºåˆ—åŒ–/ååºåˆ—åŒ–

### æ–¹æ³•2: æ‰‹åŠ¨ç¼“å­˜æ“ä½œ

```python
from app.services.cache_service import (
    get_cache, set_cache, cache_key, 
    CACHE_PREFIXES, invalidate_cache
)

@bp.route('/products', methods=['GET'])
def get_products():
    """è·å–äº§å“åˆ—è¡¨ï¼ˆæ‰‹åŠ¨ç¼“å­˜ï¼‰"""
    # ç”Ÿæˆç¼“å­˜é”®
    key = cache_key(CACHE_PREFIXES['PRODUCTS'])
    
    # å°è¯•ä»ç¼“å­˜è·å–
    cached_data = get_cache(key)
    if cached_data is not None:
        return jsonify(cached_data)
    
    # ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    products = Product.query.filter_by(is_active=True).all()
    result = [p.to_dict() for p in products]
    
    # å­˜å…¥ç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
    set_cache(key, result, timeout=1800)
    
    return jsonify(result)
```

### æ–¹æ³•3: ç¼“å­˜å¤±æ•ˆ

å½“æ•°æ®æ›´æ–°æ—¶ï¼Œéœ€è¦ä½¿ç¼“å­˜å¤±æ•ˆï¼š

```python
from app.services.cache_service import invalidate_cache, invalidate_cache_pattern

@bp.route('/products/<int:product_id>', methods=['PUT'])
def update_product(product_id):
    """æ›´æ–°äº§å“ï¼ˆä½¿ç¼“å­˜å¤±æ•ˆï¼‰"""
    # æ›´æ–°äº§å“
    product = Product.query.get(product_id)
    product.name = request.json['name']
    db.session.commit()
    
    # ä½¿äº§å“åˆ—è¡¨ç¼“å­˜å¤±æ•ˆ
    invalidate_cache(CACHE_PREFIXES['PRODUCTS'])
    
    # æˆ–ä½¿ç”¨æ¨¡å¼åˆ é™¤æ‰€æœ‰äº§å“ç›¸å…³ç¼“å­˜
    invalidate_cache_pattern('cache:products:*')
    
    return jsonify({'success': True})
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: äº§å“åˆ—è¡¨ç¼“å­˜

```python
from app.services.cache_service import cached, CACHE_PREFIXES

@bp.route('/api/products', methods=['GET'])
@cached(timeout=1800, key_prefix=CACHE_PREFIXES['PRODUCTS'])
def get_products():
    """è·å–äº§å“åˆ—è¡¨ï¼ˆç¼“å­˜30åˆ†é’Ÿï¼‰"""
    products = Product.query.filter_by(is_active=True).all()
    return jsonify([p.to_dict() for p in products])
```

### ç¤ºä¾‹2: äº§å“åˆ†ç±»ç¼“å­˜

```python
@bp.route('/api/product-categories', methods=['GET'])
@cached(timeout=3600, key_prefix=CACHE_PREFIXES['PRODUCT_CATEGORIES'])
def get_product_categories():
    """è·å–äº§å“åˆ†ç±»ï¼ˆç¼“å­˜1å°æ—¶ï¼‰"""
    categories = ProductCategory.query.filter_by(is_active=True).all()
    return jsonify([c.to_dict() for c in categories])
```

### ç¤ºä¾‹3: ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ç¼“å­˜

```python
@bp.route('/api/admin/dashboard/stats', methods=['GET'])
@cached(timeout=300, key_prefix=CACHE_PREFIXES['DASHBOARD'])
def get_dashboard_stats():
    """è·å–ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ï¼ˆç¼“å­˜5åˆ†é’Ÿï¼‰"""
    stats = {
        'total_orders': Order.query.count(),
        'today_orders': Order.query.filter(
            func.date(Order.created_at) == func.current_date()
        ).count(),
        # ... å…¶ä»–ç»Ÿè®¡
    }
    return jsonify(stats)
```

### ç¤ºä¾‹4: å¸¦å‚æ•°çš„ç¼“å­˜

```python
@bp.route('/api/products', methods=['GET'])
def get_products():
    """è·å–äº§å“åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†ç±»è¿‡æ»¤ï¼‰"""
    category_id = request.args.get('category_id')
    
    # ç¼“å­˜é”®åŒ…å«å‚æ•°
    key = cache_key(CACHE_PREFIXES['PRODUCTS'], category_id=category_id)
    
    # å°è¯•ä»ç¼“å­˜è·å–
    cached_data = get_cache(key)
    if cached_data is not None:
        return jsonify(cached_data)
    
    # æŸ¥è¯¢æ•°æ®åº“
    query = Product.query.filter_by(is_active=True)
    if category_id:
        query = query.filter_by(category_id=category_id)
    products = query.all()
    
    result = [p.to_dict() for p in products]
    set_cache(key, result, timeout=1800)
    
    return jsonify(result)
```

---

## âš™ï¸ ç¼“å­˜ç­–ç•¥å»ºè®®

### ç¼“å­˜æ—¶é—´ï¼ˆTTLï¼‰å»ºè®®

| æ•°æ®ç±»å‹ | å»ºè®®ç¼“å­˜æ—¶é—´ | è¯´æ˜ |
|---------|------------|------|
| äº§å“åˆ—è¡¨ | 30åˆ†é’Ÿ (1800ç§’) | äº§å“æ›´æ–°é¢‘ç‡è¾ƒä½ |
| äº§å“åˆ†ç±» | 1å°æ—¶ (3600ç§’) | åˆ†ç±»å¾ˆå°‘å˜åŒ– |
| é£æ ¼åˆ†ç±» | 1å°æ—¶ (3600ç§’) | é£æ ¼åˆ†ç±»å¾ˆå°‘å˜åŒ– |
| ç³»ç»Ÿé…ç½® | 1å°æ—¶ (3600ç§’) | é…ç½®å˜åŒ–è¾ƒå°‘ |
| ç»Ÿè®¡æ•°æ® | 5åˆ†é’Ÿ (300ç§’) | éœ€è¦ç›¸å¯¹å®æ—¶ |
| è®¢å•åˆ—è¡¨ | ä¸ç¼“å­˜ | æ•°æ®å˜åŒ–é¢‘ç¹ |

### ç¼“å­˜å¤±æ•ˆç­–ç•¥

**1. æ•°æ®æ›´æ–°æ—¶å¤±æ•ˆ**
```python
# æ›´æ–°äº§å“åï¼Œä½¿äº§å“åˆ—è¡¨ç¼“å­˜å¤±æ•ˆ
invalidate_cache(CACHE_PREFIXES['PRODUCTS'])
```

**2. æ‰¹é‡å¤±æ•ˆ**
```python
# åˆ é™¤æ‰€æœ‰äº§å“ç›¸å…³ç¼“å­˜
invalidate_cache_pattern('cache:products:*')
```

**3. å®šæ—¶å¤±æ•ˆ**
```python
# ä½¿ç”¨å®šæ—¶ä»»åŠ¡å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
# Redisä¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„é”®
```

---

## ğŸ” ç¼“å­˜ç›‘æ§

### æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```python
from app.services.cache_service import get_cache_stats

# è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
stats = get_cache_stats()
print(stats)
# {
#     'available': True,
#     'used_memory': '2.5M',
#     'connected_clients': 1,
#     'total_keys': 150,
#     'keyspace': {...}
# }
```

### æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¯ç”¨

```python
from app.services.cache_service import is_cache_available

if is_cache_available():
    print("âœ… ç¼“å­˜å¯ç”¨")
else:
    print("âš ï¸  ç¼“å­˜ä¸å¯ç”¨ï¼ˆRedisæœªå®‰è£…æˆ–è¿æ¥å¤±è´¥ï¼‰")
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç¼“å­˜ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥é¡¹**:
1. RedisæœåŠ¡æ˜¯å¦è¿è¡Œ
   ```bash
   # Windows
   services.msc  # æŸ¥çœ‹RedisæœåŠ¡
   
   # Linux
   sudo systemctl status redis
   ```

2. Redisè¿æ¥æ˜¯å¦æ­£å¸¸
   ```python
   from app.services.cache_service import is_cache_available
   print(is_cache_available())  # åº”è¯¥è¿”å›True
   ```

3. æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
   ```bash
   # æ£€æŸ¥.envæ–‡ä»¶
   cat .env | grep REDIS
   ```

### é—®é¢˜2: ç¼“å­˜æ•°æ®è¿‡æœŸ

**åŸå› **: ç¼“å­˜æ—¶é—´ï¼ˆTTLï¼‰è®¾ç½®è¿‡çŸ­

**è§£å†³**: å¢åŠ ç¼“å­˜æ—¶é—´
```python
@cached(timeout=3600)  # ä»1800ç§’å¢åŠ åˆ°3600ç§’
```

### é—®é¢˜3: ç¼“å­˜æ•°æ®ä¸ä¸€è‡´

**åŸå› **: æ•°æ®æ›´æ–°åæœªä½¿ç¼“å­˜å¤±æ•ˆ

**è§£å†³**: åœ¨æ•°æ®æ›´æ–°æ—¶ä½¿ç¼“å­˜å¤±æ•ˆ
```python
# æ›´æ–°æ•°æ®å
invalidate_cache(CACHE_PREFIXES['PRODUCTS'])
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜çƒ­ç‚¹æ•°æ®

ä¼˜å…ˆç¼“å­˜ï¼š
- âœ… äº§å“åˆ—è¡¨ï¼ˆè®¿é—®é¢‘ç¹ï¼‰
- âœ… äº§å“åˆ†ç±»ï¼ˆå˜åŒ–å°‘ï¼‰
- âœ… é£æ ¼åˆ†ç±»ï¼ˆå˜åŒ–å°‘ï¼‰
- âœ… ç³»ç»Ÿé…ç½®ï¼ˆå˜åŒ–å°‘ï¼‰
- âœ… ç»Ÿè®¡æ•°æ®ï¼ˆè®¡ç®—è€—æ—¶ï¼‰

ä¸ç¼“å­˜ï¼š
- âŒ è®¢å•åˆ—è¡¨ï¼ˆå˜åŒ–é¢‘ç¹ï¼‰
- âŒ ç”¨æˆ·ä¸ªäººä¿¡æ¯ï¼ˆæ•æ„Ÿæ•°æ®ï¼‰
- âŒ å®æ—¶æ•°æ®ï¼ˆéœ€è¦å³æ—¶æ€§ï¼‰

### 2. åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´

- å˜åŒ–å°‘çš„æ•°æ®ï¼š1å°æ—¶æˆ–æ›´é•¿
- å˜åŒ–è¾ƒå¤šçš„æ•°æ®ï¼š5-30åˆ†é’Ÿ
- å®æ—¶æ•°æ®ï¼šä¸ç¼“å­˜æˆ–å¾ˆçŸ­æ—¶é—´ï¼ˆ1-5åˆ†é’Ÿï¼‰

### 3. ç¼“å­˜é¢„çƒ­

åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®ï¼š
```python
def warmup_cache():
    """ç¼“å­˜é¢„çƒ­"""
    # é¢„åŠ è½½äº§å“åˆ—è¡¨
    get_products()
    # é¢„åŠ è½½åˆ†ç±»
    get_product_categories()
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¼˜åŒ–å®æ–½è¿›åº¦](../ä¼˜åŒ–å®æ–½è¿›åº¦.md) - ä¼˜åŒ–è¿›åº¦è·Ÿè¸ª
- [åç»­ä¼˜åŒ–å»ºè®®](../åç»­ä¼˜åŒ–å»ºè®®.md) - å®Œæ•´ä¼˜åŒ–è®¡åˆ’
- [Rediså®˜æ–¹æ–‡æ¡£](https://redis.io/docs/) - Redisä½¿ç”¨æ–‡æ¡£

---

## âœ… å®æ–½æ¸…å•

- [x] åˆ›å»ºç¼“å­˜æœåŠ¡æ¨¡å—
- [x] æ·»åŠ Redisä¾èµ–
- [x] å®ç°ç¼“å­˜è£…é¥°å™¨
- [x] å®ç°ç¼“å­˜å¤±æ•ˆæœºåˆ¶
- [ ] åœ¨äº§å“åˆ—è¡¨æ¥å£åº”ç”¨ç¼“å­˜
- [ ] åœ¨äº§å“åˆ†ç±»æ¥å£åº”ç”¨ç¼“å­˜
- [ ] åœ¨é£æ ¼åˆ†ç±»æ¥å£åº”ç”¨ç¼“å­˜
- [ ] åœ¨ä»ªè¡¨æ¿ç»Ÿè®¡æ¥å£åº”ç”¨ç¼“å­˜
- [ ] æ·»åŠ ç¼“å­˜ç›‘æ§æ¥å£
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

---

**æœ€åæ›´æ–°**: 2026-02-04  
**çŠ¶æ€**: âœ… ç¼“å­˜ç³»ç»Ÿå·²å®ç°ï¼Œå¾…åº”ç”¨åˆ°å…·ä½“æ¥å£
