# ä»£ç é‡æ„æ‰§è¡Œè®¡åˆ’

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•é€æ­¥å°† `test_server.py`ï¼ˆ12601è¡Œï¼‰æ‹†åˆ†ä¸ºæ¨¡å—åŒ–ç»“æ„ï¼Œç¡®ä¿æ¯ä¸€æ­¥éƒ½å¯ä»¥æµ‹è¯•ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ã€‚

## ğŸ¯ æ‹†åˆ†ç›®æ ‡

å°† `test_server.py` æ‹†åˆ†ä¸º **10ä¸ªæ¨¡å—**ï¼š
1. `app/models.py` - æ•°æ®åº“æ¨¡å‹ï¼ˆ25ä¸ªç±»ï¼‰
2. `app/routes/admin.py` - ç®¡ç†åå°è·¯ç”±
3. `app/routes/miniprogram.py` - å°ç¨‹åºAPIè·¯ç”±
4. `app/routes/order.py` - è®¢å•è·¯ç”±
5. `app/routes/payment.py` - æ”¯ä»˜è·¯ç”±
6. `app/services/order_service.py` - è®¢å•ä¸šåŠ¡é€»è¾‘
7. `app/services/payment_service.py` - æ”¯ä»˜ä¸šåŠ¡é€»è¾‘
8. `app/utils/helpers.py` - é€šç”¨å·¥å…·å‡½æ•°
9. `app/utils/image_utils.py` - å›¾ç‰‡å¤„ç†å·¥å…·
10. `app/__init__.py` - åº”ç”¨åˆå§‹åŒ–

## ğŸ“… æ‰§è¡Œæ­¥éª¤

### âœ… é˜¶æ®µ1ï¼šæ–‡æ¡£å’Œè„šæœ¬æ•´ç†ï¼ˆä¸å½±å“è¿è¡Œï¼‰

**ç›®æ ‡**ï¼šæ•´ç†æ•£è½çš„æ–‡æ¡£å’Œè„šæœ¬ï¼Œæé«˜é¡¹ç›®å¯ç»´æŠ¤æ€§

**æ­¥éª¤**ï¼š
1. è¿è¡Œ `python æ•´ç†æ–‡æ¡£å’Œè„šæœ¬.py`
2. æ£€æŸ¥æ•´ç†ç»“æœ
3. æŸ¥çœ‹ `docs/README.md` æ–‡æ¡£ç´¢å¼•

**é¢„æœŸç»“æœ**ï¼š
- æ‰€æœ‰ `.md` æ–‡ä»¶æ•´ç†åˆ° `docs/` ç›®å½•
- æ‰€æœ‰ `.py` è„šæœ¬æ•´ç†åˆ° `scripts/` ç›®å½•
- æ‰€æœ‰ `.bat` æ–‡ä»¶æ•´ç†åˆ° `batch/` ç›®å½•
- é¡¹ç›®æ ¹ç›®å½•æ›´æ•´æ´

**æµ‹è¯•**ï¼šæ— éœ€æµ‹è¯•ï¼Œä¸å½±å“è¿è¡Œ

---

### âœ… é˜¶æ®µ2ï¼šåˆ›å»ºä»£ç æ¨¡å—ç»“æ„ï¼ˆä¸å½±å“è¿è¡Œï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºæ¨¡å—åŒ–ç›®å½•ç»“æ„ï¼Œä¸ºä»£ç è¿ç§»åšå‡†å¤‡

**æ­¥éª¤**ï¼š
1. è¿è¡Œ `python åˆ›å»ºä»£ç æ¨¡å—ç»“æ„.py`
2. æ£€æŸ¥ `app/` ç›®å½•ç»“æ„
3. æŸ¥çœ‹åˆ›å»ºçš„æ–‡ä»¶æ¨¡æ¿

**é¢„æœŸç»“æœ**ï¼š
```
app/
â”œâ”€â”€ __init__.py          # Flaskåº”ç”¨åˆå§‹åŒ–ï¼ˆæ¨¡æ¿ï¼‰
â”œâ”€â”€ models.py            # æ•°æ®åº“æ¨¡å‹ï¼ˆæ¨¡æ¿ï¼‰
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ admin.py         # ç®¡ç†åå°è·¯ç”±ï¼ˆæ¨¡æ¿ï¼‰
â”‚   â”œâ”€â”€ miniprogram.py   # å°ç¨‹åºAPIè·¯ç”±ï¼ˆæ¨¡æ¿ï¼‰
â”‚   â”œâ”€â”€ order.py         # è®¢å•è·¯ç”±ï¼ˆæ¨¡æ¿ï¼‰
â”‚   â””â”€â”€ payment.py       # æ”¯ä»˜è·¯ç”±ï¼ˆæ¨¡æ¿ï¼‰
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ order_service.py    # è®¢å•æœåŠ¡ï¼ˆæ¨¡æ¿ï¼‰
â”‚   â””â”€â”€ payment_service.py  # æ”¯ä»˜æœåŠ¡ï¼ˆæ¨¡æ¿ï¼‰
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ helpers.py       # å·¥å…·å‡½æ•°ï¼ˆæ¨¡æ¿ï¼‰
    â””â”€â”€ image_utils.py   # å›¾ç‰‡å¤„ç†ï¼ˆæ¨¡æ¿ï¼‰
```

**æµ‹è¯•**ï¼šæ— éœ€æµ‹è¯•ï¼Œåªæ˜¯åˆ›å»ºç©ºæ–‡ä»¶

---

### ğŸ”„ é˜¶æ®µ3ï¼šæ‹†åˆ†æ•°æ®åº“æ¨¡å‹ï¼ˆç¬¬1æ­¥ï¼Œéœ€è¦æµ‹è¯•ï¼‰

**ç›®æ ‡**ï¼šå°†æ‰€æœ‰æ•°æ®åº“æ¨¡å‹ç±»è¿ç§»åˆ° `app/models.py`

**æ­¥éª¤**ï¼š
1. æ‰“å¼€ `test_server.py`ï¼Œæ‰¾åˆ°æ‰€æœ‰ `class Xxx(db.Model):` å®šä¹‰ï¼ˆçº¦ç¬¬617-1220è¡Œï¼‰
2. å¤åˆ¶æ‰€æœ‰æ¨¡å‹ç±»åˆ° `app/models.py`
3. åœ¨ `app/models.py` é¡¶éƒ¨æ·»åŠ ï¼š
   ```python
   from app import db
   ```
4. åœ¨ `test_server.py` ä¸­åˆ é™¤æ¨¡å‹ç±»å®šä¹‰
5. åœ¨ `test_server.py` é¡¶éƒ¨æ·»åŠ ï¼š
   ```python
   from app.models import *
   ```

**éœ€è¦è¿ç§»çš„æ¨¡å‹ç±»**ï¼ˆ25ä¸ªï¼‰ï¼š
- Product, ProductSize, ProductSizePetOption, ProductImage, ProductStyleCategory, ProductCustomField
- StyleCategory, StyleImage
- HomepageBanner, WorksGallery, HomepageConfig
- User, UserVisit
- Order, OrderImage
- PhotoSignup
- PromotionUser, Commission, Withdrawal, PromotionTrack
- Coupon, UserCoupon
- FranchiseeAccount, FranchiseeRecharge, SelfieMachine

**æµ‹è¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨ï¼ˆ`python start.py`ï¼‰
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç®¡ç†åå°èƒ½æ­£å¸¸è®¿é—®
- [ ] å°ç¨‹åºAPIèƒ½æ­£å¸¸è°ƒç”¨
- [ ] æ•°æ®åº“æŸ¥è¯¢æ­£å¸¸

**å¦‚æœæµ‹è¯•å¤±è´¥**ï¼š
- æ£€æŸ¥å¯¼å…¥è¯­å¥æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ¨¡å‹ç±»æ˜¯å¦å®Œæ•´è¿ç§»
- æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯å¯¼å…¥é—®é¢˜

---

### ğŸ”„ é˜¶æ®µ4ï¼šæ‹†åˆ†å·¥å…·å‡½æ•°ï¼ˆç¬¬2æ­¥ï¼Œéœ€è¦æµ‹è¯•ï¼‰

**ç›®æ ‡**ï¼šå°†å·¥å…·å‡½æ•°è¿ç§»åˆ° `app/utils/` ç›®å½•

**æ­¥éª¤**ï¼š
1. è¯†åˆ« `test_server.py` ä¸­çš„å·¥å…·å‡½æ•°ï¼ˆéè·¯ç”±å‡½æ•°ï¼‰
2. é€šç”¨å·¥å…·å‡½æ•° â†’ `app/utils/helpers.py`
   - `_parse_shipping_info`
   - `_get_product_id_from_size`
   - `generate_nonce_str`
   - å…¶ä»–è¾…åŠ©å‡½æ•°
3. å›¾ç‰‡å¤„ç†å‡½æ•° â†’ `app/utils/image_utils.py`
   - å›¾ç‰‡ä¸Šä¼ å¤„ç†
   - å›¾ç‰‡å‹ç¼©
   - æ°´å°æ·»åŠ 
4. åœ¨ `test_server.py` ä¸­æ·»åŠ å¯¼å…¥ï¼š
   ```python
   from app.utils.helpers import *
   from app.utils.image_utils import *
   ```

**æµ‹è¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] å·¥å…·å‡½æ•°èƒ½æ­£å¸¸è°ƒç”¨
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] å›¾ç‰‡å¤„ç†åŠŸèƒ½æ­£å¸¸

---

### ğŸ”„ é˜¶æ®µ5ï¼šæ‹†åˆ†æœåŠ¡å±‚ï¼ˆç¬¬3æ­¥ï¼Œéœ€è¦æµ‹è¯•ï¼‰

**ç›®æ ‡**ï¼šå°†ä¸šåŠ¡é€»è¾‘è¿ç§»åˆ° `app/services/` ç›®å½•

**æ­¥éª¤**ï¼š
1. è¯†åˆ«è®¢å•ç›¸å…³ä¸šåŠ¡é€»è¾‘
2. è¿ç§»åˆ° `app/services/order_service.py`
   - è®¢å•åˆ›å»ºé€»è¾‘
   - è®¢å•çŠ¶æ€æ›´æ–°é€»è¾‘
   - è®¢å•æŸ¥è¯¢é€»è¾‘
   - è®¢å•å…³è”åŠ ç›Ÿå•†é€»è¾‘
3. è¯†åˆ«æ”¯ä»˜ç›¸å…³ä¸šåŠ¡é€»è¾‘
4. è¿ç§»åˆ° `app/services/payment_service.py`
   - å¾®ä¿¡æ”¯ä»˜ç­¾åç”Ÿæˆ
   - æ”¯ä»˜è®¢å•åˆ›å»º
   - æ”¯ä»˜å›è°ƒå¤„ç†
5. åœ¨ `test_server.py` ä¸­æ·»åŠ å¯¼å…¥ï¼š
   ```python
   from app.services.order_service import *
   from app.services.payment_service import *
   ```

**æµ‹è¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] è®¢å•åˆ›å»ºåŠŸèƒ½æ­£å¸¸
- [ ] è®¢å•æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] æ”¯ä»˜åŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœå¯ç”¨ï¼‰

---

### ğŸ”„ é˜¶æ®µ6ï¼šæ‹†åˆ†è·¯ç”±ï¼ˆç¬¬4-8æ­¥ï¼Œéœ€è¦æµ‹è¯•ï¼‰

**ç›®æ ‡**ï¼šå°†è·¯ç”±å‡½æ•°è¿ç§»åˆ° `app/routes/` ç›®å½•ï¼Œä½¿ç”¨Blueprint

**æ­¥éª¤**ï¼š

#### 6.1 æ‹†åˆ†ç®¡ç†åå°è·¯ç”±
1. åˆ›å»º `app/routes/admin.py`
2. è¿ç§»ç®¡ç†åå°ç›¸å…³è·¯ç”±ï¼š
   - `/admin/dashboard`
   - `/admin/order/<id>`
   - `/admin/styles`
   - `/admin/sizes`
   - `/admin/homepage`
   - `/admin/works-gallery`
   - `/admin/photo-signups`
   - `/admin/merchants`
   - `/admin/orders/export`
3. ä½¿ç”¨Blueprintæ³¨å†Œè·¯ç”±

#### 6.2 æ‹†åˆ†å°ç¨‹åºAPIè·¯ç”±
1. åˆ›å»º `app/routes/miniprogram.py`
2. è¿ç§»å°ç¨‹åºç›¸å…³APIï¼š
   - `/api/miniprogram/products`
   - `/api/miniprogram/styles`
   - `/api/miniprogram/banners`
   - `/api/miniprogram/orders` (POST/GET)
   - `/api/miniprogram/order/<order_number>`
   - `/api/miniprogram/order/qrcode`
   - `/api/miniprogram/order/check`
   - `/api/miniprogram/order/upload`
   - `/api/miniprogram/upload`
   - `/api/user/openid`

#### 6.3 æ‹†åˆ†è®¢å•è·¯ç”±
1. åˆ›å»º `app/routes/order.py`
2. è¿ç§»è®¢å•ç›¸å…³è·¯ç”±ï¼š
   - `/order`
   - `/order/<order_id>`
   - `/api/order/<order_id>/logistics`

#### 6.4 æ‹†åˆ†æ”¯ä»˜è·¯ç”±
1. åˆ›å»º `app/routes/payment.py`
2. è¿ç§»æ”¯ä»˜ç›¸å…³è·¯ç”±ï¼š
   - `/api/payment/create`
   - `/api/payment/notify`

#### 6.5 åˆ›å»ºåº”ç”¨åˆå§‹åŒ–
1. å®Œå–„ `app/__init__.py`
2. æ³¨å†Œæ‰€æœ‰Blueprintï¼š
   ```python
   from app.routes import admin_bp, miniprogram_bp, order_bp, payment_bp
   app.register_blueprint(admin_bp)
   app.register_blueprint(miniprogram_bp)
   app.register_blueprint(order_bp)
   app.register_blueprint(payment_bp)
   ```

**æµ‹è¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] ç®¡ç†åå°æ‰€æœ‰é¡µé¢æ­£å¸¸è®¿é—®
- [ ] å°ç¨‹åºæ‰€æœ‰APIæ­£å¸¸è°ƒç”¨
- [ ] Android Appæ¥å£æ­£å¸¸è°ƒç”¨
- [ ] è®¢å•ç›¸å…³åŠŸèƒ½æ­£å¸¸
- [ ] æ”¯ä»˜ç›¸å…³åŠŸèƒ½æ­£å¸¸ï¼ˆå¦‚æœå¯ç”¨ï¼‰

---

### ğŸ”„ é˜¶æ®µ7ï¼šæ¸…ç†å’Œä¼˜åŒ–ï¼ˆç¬¬9æ­¥ï¼Œéœ€è¦æµ‹è¯•ï¼‰

**ç›®æ ‡**ï¼šæ¸…ç† `test_server.py`ï¼Œä¿ç•™å‘åå…¼å®¹

**æ­¥éª¤**ï¼š
1. åˆ é™¤ `test_server.py` ä¸­å·²è¿ç§»çš„ä»£ç 
2. ä¿ç•™ `test_server.py` ä½œä¸ºå‘åå…¼å®¹å…¥å£ï¼š
   ```python
   # test_server.py (ç®€åŒ–ç‰ˆ)
   from app import create_app
   
   app = create_app()
   
   if __name__ == '__main__':
       app.run(host='0.0.0.0', port=8000, debug=True)
   ```
3. æ›´æ–° `start.py` æŒ‡å‘æ–°ç»“æ„ï¼š
   ```python
   from app import create_app
   
   app = create_app()
   
   if __name__ == '__main__':
       app.run(host='0.0.0.0', port=8000, debug=True)
   ```

**æµ‹è¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨ï¼ˆä½¿ç”¨ `start.py`ï¼‰
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨ï¼ˆä½¿ç”¨ `test_server.py`ï¼‰
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- [ ] å®Œæ•´åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é€æ­¥è¿ç§»**ï¼šæ¯æ¬¡åªè¿ç§»ä¸€ä¸ªæ¨¡å—ï¼Œç¡®ä¿æµ‹è¯•é€šè¿‡åå†ç»§ç»­
2. **ä¿ç•™å¤‡ä»½**ï¼šè¿ç§»å‰å¤‡ä»½ `test_server.py`
3. **æµ‹è¯•å……åˆ†**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½è¦å……åˆ†æµ‹è¯•
4. **æ›´æ–°å¯¼å…¥**ï¼šç¡®ä¿æ‰€æœ‰å¯¼å…¥è¯­å¥æ­£ç¡®
5. **æ–‡æ¡£åŒæ­¥**ï¼šåŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

ä½¿ç”¨ TODO åˆ—è¡¨è·Ÿè¸ªæ¯ä¸ªé˜¶æ®µçš„è¿›åº¦ï¼š
- âœ… å·²å®Œæˆ
- ğŸ”„ è¿›è¡Œä¸­
- â³ å¾…å¼€å§‹

## ğŸ¯ é¢„æœŸæ—¶é—´

- é˜¶æ®µ1-2ï¼š1å°æ—¶ï¼ˆæ–‡æ¡£å’Œç»“æ„åˆ›å»ºï¼‰
- é˜¶æ®µ3ï¼š2-3å°æ—¶ï¼ˆæ•°æ®åº“æ¨¡å‹æ‹†åˆ†ï¼‰
- é˜¶æ®µ4ï¼š1-2å°æ—¶ï¼ˆå·¥å…·å‡½æ•°æ‹†åˆ†ï¼‰
- é˜¶æ®µ5ï¼š2-3å°æ—¶ï¼ˆæœåŠ¡å±‚æ‹†åˆ†ï¼‰
- é˜¶æ®µ6ï¼š4-6å°æ—¶ï¼ˆè·¯ç”±æ‹†åˆ†ï¼‰
- é˜¶æ®µ7ï¼š1-2å°æ—¶ï¼ˆæ¸…ç†ä¼˜åŒ–ï¼‰

**æ€»è®¡**ï¼šçº¦11-17å°æ—¶ï¼ˆåˆ†å¤šå¤©å®Œæˆï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¶é—´**ï¼š2026-01-14  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ
