# AI拍照机系统 - 图片路径说明文档

## 目录结构

```
pet-painting-system/
├── uploads/                    # 用户上传原图
├── final_works/               # 完成效果图（有水印）
├── hd_images/                 # 高清放大图
├── static/images/             # 静态图片资源
│   ├── products/              # 产品库图片
│   └── banners/               # 轮播图
└── static/js/                 # JavaScript文件
```

## 1. 用户上传图片

### 存储路径
- **物理路径**: `uploads/`
- **数据库字段**: `Order.original_image`
- **访问路由**: `/media/original/<filename>`
- **下载路由**: `/download/original/<filename>`

### 用途
- 用户上传的宠物原图
- 订单创建时的原始图片

### 示例
```
文件名: mp_15768312_8Ah5BpEsxVfyc8368c7c4d3d0de10ff1721a0ff87868.jpg
访问URL: https://moeart.cc/media/original/mp_15768312_8Ah5BpEsxVfyc8368c7c4d3d0de10ff1721a0ff87868.jpg
```

## 2. 完成效果图

### 存储路径
- **物理路径**: `final_works/`
- **数据库字段**: `Order.final_image`
- **访问路由**: `/media/final/<filename>`
- **下载路由**: `/download/final/<filename>`

### 无水印版本
- **文件名格式**: `clean_<原文件名>`
- **数据库字段**: `Order.final_image_clean`
- **访问路由**: `/media/final/clean/<filename>`
- **下载路由**: `/download/final/clean/<filename>`

### 用途
- 完成后的油画效果图
- 有水印版本用于预览
- 无水印版本用于制作

### 示例
```
有水印: final_e2326b68-bcd8-4e38-a1b4-c5d235f44ac3_ComfyUI_temp_rxjtz_00001_.jpg
无水印: clean_final_e2326b68-bcd8-4e38-a1b4-c5d235f44ac3_ComfyUI_temp_rxjtz_00001_.jpg
访问URL: https://moeart.cc/media/final/final_e2326b68-bcd8-4e38-a1b4-c5d235f44ac3_ComfyUI_temp_rxjtz_00001_.jpg
```

## 3. 高清放大图

### 存储路径
- **物理路径**: `hd_images/`
- **数据库字段**: `Order.hd_image`
- **访问路由**: `/media/hd/<filename>`
- **下载路由**: `/download/hd/<filename>`

### 无水印版本
- **文件名格式**: `clean_<原文件名>`
- **数据库字段**: `Order.hd_image_clean`
- **访问路由**: `/media/hd/clean/<filename>`

### 用途
- 高清放大版本的效果图
- 用于打印制作

### 示例
```
文件名: hd_03168991-8b72-4134-8ac1-25e30b28a993_ComfyUI_temp_rxjtz_00001_.jpg
访问URL: https://moeart.cc/media/hd/hd_03168991-8b72-4134-8ac1-25e30b28a993_ComfyUI_temp_rxjtz_00001_.jpg
```

## 4. 产品库图片

### 存储路径
- **物理路径**: `static/images/products/`
- **数据库字段**: `Product.image_url`, `ProductImage.image_url`
- **访问路由**: `/static/images/products/<filename>`

### 用途
- 产品展示图片
- 尺寸规格图片

### 示例
```
文件名: 2c3ecab1a980475d8da1cc3356964cfb_png
访问URL: https://moeart.cc/static/images/products/2c3ecab1a980475d8da1cc3356964cfb_png
```

## 5. 风格模板图片

### 存储路径
- **物理路径**: `static/images/`
- **数据库字段**: `StyleImage.image_url`
- **访问路由**: `/static/images/<filename>`

### 用途
- 油画风格模板
- 转绘风格模板
- 风格选择展示

### 示例
```
油画风格: 油画风格-梵高.jpg
转绘风格: 转绘风格-水彩.png
访问URL: https://moeart.cc/static/images/油画风格-梵高.jpg
```

## 6. 轮播图

### 存储路径
- **物理路径**: `static/images/banners/`
- **访问路由**: `/static/images/banners/<filename>`

### 用途
- 首页轮播图
- 活动宣传图

## 7. 小程序专用路由

### 路由列表
- **原图**: `/api/miniprogram/media/original/<filename>`
- **效果图**: `/api/miniprogram/media/final/<filename>`
- **静态图片**: `/api/miniprogram/static/images/<path:filename>`

### 用途
- 微信小程序专用访问接口
- 避免跨域问题

## 8. 下载路由

### 下载接口
- **原图下载**: `/download/original/<filename>`
- **效果图下载**: `/download/final/<filename>`
- **无水印下载**: `/download/final/clean/<filename>`
- **高清图下载**: `/download/hd/<filename>`

### 权限控制
- 需要登录验证
- 订单状态检查
- 文件存在性验证

## 9. 数据库字段映射

### Order表
```sql
original_image     → uploads/
final_image        → final_works/
final_image_clean  → final_works/clean_*
hd_image          → hd_images/
hd_image_clean    → hd_images/clean_*
```

### Product表
```sql
image_url → static/images/products/
```

### ProductImage表
```sql
image_url → static/images/products/
```

### StyleImage表
```sql
image_url → static/images/
```

## 10. 配置文件

### Flask配置
```python
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['FINAL_FOLDER'] = 'final_works'
app.config['HD_FOLDER'] = 'hd_images'
```

### 环境变量
```bash
UPLOAD_FOLDER=uploads
FINAL_FOLDER=final_works
HD_FOLDER=hd_images
```

## 11. 文件命名规则

### 用户上传
- 格式: `mp_<用户ID>_<随机字符串>.jpg`
- 示例: `mp_15768312_8Ah5BpEsxVfyc8368c7c4d3d0de10ff1721a0ff87868.jpg`

### 效果图
- 格式: `final_<UUID>_<时间戳>.jpg`
- 示例: `final_e2326b68-bcd8-4e38-a1b4-c5d235f44ac3_ComfyUI_temp_rxjtz_00001_.jpg`

### 高清图
- 格式: `hd_<UUID>_<时间戳>.jpg`
- 示例: `hd_03168991-8b72-4134-8ac1-25e30b28a993_ComfyUI_temp_rxjtz_00001_.jpg`

### 产品图
- 格式: `<MD5哈希>_<序号>.<扩展名>`
- 示例: `2c3ecab1a980475d8da1cc3356964cfb_png`

## 12. 权限控制

### 公开访问
- 静态图片: `/static/images/`
- 风格模板: `/static/images/`
- 产品图片: `/static/images/products/`

### 需要登录
- 用户原图: `/media/original/`
- 效果图: `/media/final/`
- 高清图: `/media/hd/`
- 所有下载路由: `/download/`

### 订单状态检查
- 无水印版本需要订单状态为 `manufacturing` 或更高
- 确认制作后才能访问无水印版本

## 13. 常见问题

### Q: 为什么预览显示404？
A: 检查文件是否存在，路径是否正确，权限是否足够

### Q: 无水印版本无法访问？
A: 确认订单状态，检查 `clean_` 前缀文件是否存在

### Q: 小程序图片加载失败？
A: 使用小程序专用路由 `/api/miniprogram/`

### Q: 下载按钮无响应？
A: 检查登录状态和订单权限

## 14. 维护建议

### 定期清理
- 删除过期的临时文件
- 清理无效的订单图片
- 压缩大尺寸图片

### 备份策略
- 定期备份 `final_works/` 和 `hd_images/`
- 保留用户原图备份
- 监控磁盘空间使用

### 性能优化
- 使用CDN加速静态图片
- 启用图片缓存
- 压缩图片文件大小

---

**最后更新**: 2025-09-29  
**版本**: 1.0  
**维护者**: 系统管理员

