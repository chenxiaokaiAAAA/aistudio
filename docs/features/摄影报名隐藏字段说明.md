# 摄影报名字段隐藏说明

## 📋 修改概述

在小程序前端摄影报名页面，隐藏了宠物的 **年龄** 和 **体重** 字段。

### ✅ 后端修改

1. **数据库模型修改** (`test_server.py`)
   - 将 `pet_weight` 字段从 `nullable=False` 改为 `nullable=True`
   - 将 `pet_age` 字段从 `nullable=False` 改为 `nullable=True`

2. **API接口修改** (`test_server.py`)
   - 从必填字段列表中移除了 `petWeight` 和 `petAge`
   - 创建报名记录时，这两个字段使用 `.get()` 方法获取，允许为空

3. **数据库迁移脚本**
   - 创建了 `migrate_photo_signup_fields.py` 脚本
   - 用于将现有数据库表中的字段修改为允许 NULL

## 🔧 数据库迁移步骤

### 方法 1：运行迁移脚本（推荐）

```bash
python migrate_photo_signup_fields.py
```

脚本会自动：
- 备份现有的 photo_signup 表
- 创建新表（pet_weight 和 pet_age 允许为 NULL）
- 恢复现有数据

### 方法 2：手动修改数据库

如果需要手动修改数据库，可以参考以下 SQL 语句：

```sql
-- SQLite 不支持直接修改列的 nullable 属性
-- 需要重建表
-- 1. 备份数据
CREATE TABLE photo_signup_backup AS SELECT * FROM photo_signup;

-- 2. 删除旧表
DROP TABLE photo_signup;

-- 3. 创建新表（pet_weight 和 pet_age 允许为 NULL）
CREATE TABLE photo_signup (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    pet_breed VARCHAR(50) NOT NULL,
    pet_weight VARCHAR(50),           -- 允许为 NULL
    pet_age VARCHAR(50),              -- 允许为 NULL
    pet_character VARCHAR(500),
    available_date VARCHAR(50),
    additional_notes VARCHAR(500),
    pet_images TEXT,
    user_id VARCHAR(100),
    referrer_user_id VARCHAR(100),
    referrer_promotion_code VARCHAR(50),
    source VARCHAR(50) DEFAULT 'miniprogram_carousel',
    status VARCHAR(20) DEFAULT 'pending',
    notes VARCHAR(1000),
    contact_no_answer BOOLEAN DEFAULT 0,
    contact_success BOOLEAN DEFAULT 0,
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    contact_time DATETIME,
    schedule_time DATETIME,
    store_visit_time VARCHAR(50),
    complete_time DATETIME
);

-- 4. 恢复数据
INSERT INTO photo_signup SELECT * FROM photo_signup_backup;
```

## 🎯 前端修改建议

在小程序的前端摄影报名表单中：

1. **隐藏输入框**
   - 移除或隐藏 "宠物体重" 输入框
   - 移除或隐藏 "宠物年龄" 输入框

2. **修改表单数据结构**
   ```javascript
   data: {
     formData: {
       name: '',
       phone: '',
       petBreed: '',
       petWeight: '',  // 可选，可以留空
       petAge: '',     // 可选，可以留空
       petCharacter: '',
       availableDate: ''
     }
   }
   ```

3. **提交时处理**
   - 即使隐藏了这两个字段，提交时可以发送空字符串 ''
   - 后端会自动处理，不会报错

## 📝 示例代码

### 隐藏字段的 WXML 代码

```xml
<!-- 原来的代码 -->
<!-- <view class="form-item">
  <text>宠物体重</text>
  <input type="text" bindinput="onInput" data-field="petWeight" value="{{formData.petWeight}}" />
</view> -->

<!-- <view class="form-item">
  <text>宠物年龄</text>
  <input type="text" bindinput="onInput" data-field="petAge" value="{{formData.petAge}}" />
</view> -->

<!-- 现在这两个字段已被隐藏，或者可以使用 wx:if="{{false}}" 来隐藏 -->
```

## ⚠️ 注意事项

1. **数据兼容性**
   - 现有的已提交数据不受影响
   - 新的报名提交可以不填写这两个字段

2. **管理后台显示**
   - 后台管理页面需要处理这两个字段可能为 NULL 的情况
   - 显示时使用空字符串或 "未填写"

3. **重启服务**
   - 修改代码后需要重启后端服务
   - 数据库迁移需要先运行迁移脚本

## 🚀 部署步骤

1. **停止后端服务**
   ```bash
   # 停止当前运行的服务
   ```

2. **备份数据库**
   ```bash
   cp instance/pet_painting.db instance/pet_painting.db.backup
   ```

3. **运行数据库迁移**
   ```bash
   python migrate_photo_signup_fields.py
   ```

4. **重启后端服务**
   ```bash
   python test_server.py
   ```

5. **测试验证**
   - 提交新的报名数据
   - 验证不填写体重和年龄字段不会报错
   - 验证数据可以正常保存

## 📞 联系方式

如有问题，请查看服务器日志或联系开发人员。



