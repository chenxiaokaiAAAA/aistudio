# 订单导出功能优化说明

## ✅ 已完成的优化

### 1. 订单状态显示中文

**修改前**：状态显示为英文（pending, completed等）
**修改后**：状态显示为中文（待制作, 已完成等）

### 2. 商家字段显示名称

**修改前**：加盟商显示为 `加盟商ID:123`
**修改后**：加盟商显示为 `加盟商:北京宠物公司`

## 📊 状态映射表

| 英文状态 | 中文显示 |
|---------|---------|
| unpaid | 未支付 |
| pending | 待制作 |
| processing | 处理中 |
| manufacturing | 制作中 |
| completed | 已完成 |
| shipped | 已发货 |
| delivered | 已送达 |
| cancelled | 已取消 |
| refunded | 已退款 |
| hd_ready | 高清放大 |

## 🎯 优化内容

### 1. 状态中文映射

```python
status_map = {
    'unpaid': '未支付',
    'pending': '待制作',
    'processing': '处理中',
    'manufacturing': '制作中',
    'completed': '已完成',
    'shipped': '已发货',
    'delivered': '已送达',
    'cancelled': '已取消',
    'refunded': '已退款',
    'hd_ready': '高清放大'
}
status_display = status_map.get(order.status, order.status or '未知')
```

### 2. 加盟商名称显示

```python
# 如果是加盟商订单
if order.franchisee_id:
    franchisee_account = FranchiseeAccount.query.get(order.franchisee_id)
    if franchisee_account:
        merchant_name = f"加盟商:{franchisee_account.company_name}"
    else:
        merchant_name = f"加盟商ID:{order.franchisee_id}"
```

## 📋 导出示例

### 修改前

```csv
订单号,客户姓名,订单状态,商家
PET20250101001,张三,completed,加盟商ID:1
```

### 修改后

```csv
订单号,客户姓名,订单状态,商家
PET20250101001,张三,已完成,加盟商:北京宠物公司
```

## 🚀 使用方法

1. **访问订单导出**
   - 登录管理后台
   - 进入订单管理页面
   - 点击"导出数据"按钮

2. **查看导出文件**
   - 下载CSV文件
   - 用Excel打开
   - 订单状态和商家字段已显示为中文

## ⚠️ 注意事项

1. **重启服务器**：修改代码后需要重启服务器才能生效
2. **字段兼容**：如果状态不存在于映射表中，会显示原值
3. **加盟商信息**：如果加盟商账户不存在，会回退显示ID

## 📝 技术细节

### 修改位置

**文件**: `test_server.py`  
**函数**: `export_orders()`  
**行数**: 1989-2014行

### 修改内容

1. 添加状态中文映射字典
2. 使用映射字典转换状态
3. 查询加盟商账户获取公司名称
4. 优化商家字段显示

---

**更新日期**: 2025-01-20  
**版本**: 1.0



