# 微信通知功能使用说明

## 📋 功能概述

当有新订单时，系统会自动发送通知到你的微信，无论你在哪里都能及时收到订单提醒！

## 🚀 快速配置（3步完成）

### 步骤1：选择通知方式

推荐使用**企业微信机器人**（最简单），或者使用**微信公众号模板消息**。

### 步骤2：配置微信通知

编辑文件 `wechat_notification_config.py`：

#### 方式A：企业微信机器人（推荐）

1. 打开企业微信（没有的话可以先注册企业微信）
2. 在企业微信中创建一个群聊
3. 在群聊中点击右上角"..." → 添加群机器人
4. 复制机器人的 webhook 地址
5. 粘贴到配置文件中：

```python
# 启用微信通知
WECHAT_NOTIFICATION_ENABLED = True

# 使用企业微信
WECHAT_TYPE = 'enterprise'

# 粘贴你的webhook地址
ENTERPRISE_WEBHOOK_URL = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=你的key'
```

#### 方式B：微信公众号（需开发权限）

```python
WECHAT_NOTIFICATION_ENABLED = True
WECHAT_TYPE = 'mp'
MP_APP_ID = '你的AppID'
MP_APP_SECRET = '你的AppSecret'
MP_TOKEN = '你的Token'
MP_TEMPLATE_ID = '模板ID'
```

### 步骤3：重启服务器

```bash
python start.py
```

## 📱 通知效果

当有新订单时，你会收到：

```
🛒 新订单提醒
订单号: PET20250101001
客户姓名: 张三
订单金额: ¥99.00
订单来源: 小程序
时间: 2025-01-01 12:00:00
```

## 🔧 常见问题

### Q1: 企业微信机器人如何获取？

1. 下载并注册企业微信APP
2. 创建一个群聊（至少需要2个人）
3. 群聊 → 右上角"..." → 添加群机器人
4. 给机器人起个名字（如"订单通知"）
5. 复制 webhook 地址

**企业微信官方网址**: https://work.weixin.qq.com/

### Q2: 可以用微信群吗？

可以！但需要：
- 先注册企业微信
- 在企业微信中建群
- 将普通微信拉入企业微信群

### Q3: 可以发送到多个群吗？

可以！只需要：
1. 在配置文件中添加多个 webhook（修改代码）
2. 或者创建多个群机器人并转发消息

### Q4: 通知格式可以自定义吗？

可以！编辑 `wechat_notification.py` 文件中的消息模板。

### Q5: 如何关闭微信通知？

编辑 `wechat_notification_config.py`：
```python
WECHAT_NOTIFICATION_ENABLED = False
```

## 🎨 自定义通知格式

编辑 `wechat_notification.py`，找到 `_send_enterprise_notification` 方法：

```python
message = {
    "msgtype": "markdown",
    "markdown": {
        "content": f"""
## 🛒 新订单提醒
**订单号**: {order_number}
**客户姓名**: {customer_name}
**订单金额**: ¥{total_price}
**订单来源**: {source}
**时间**: {self._get_current_time()}

💡 请及时处理订单！
        """
    }
}
```

## 📊 多端通知对比

| 通知方式 | 适用场景 | 优点 | 缺点 |
|---------|---------|------|------|
| 浏览器通知 | 在电脑上打开管理后台 | 实时提醒 | 需要打开网页 |
| 桌面通知 | 服务器本地 | 立即显示 | 只在服务器电脑 |
| 微信通知 | 手机/远程 | 随时随地 | 需要配置webhook |

**推荐组合**：
- ✅ 微信通知（手机端）
- ✅ 浏览器通知（电脑端）

## 🛠️ 高级配置

### 添加@提醒

在消息中加入@所有人：

```python
message = {
    "msgtype": "text",
    "text": {
        "content": "🛒 新订单提醒\\n订单号: {order_number}\\n@all"
    }
}
```

### 添加图片通知

可以发送订单截图等：

```python
message = {
    "msgtype": "image",
    "image": {
        "base64": "图片的base64编码",
        "md5": "图片的md5值"
    }
}
```

## 📞 技术支持

如遇问题：
1. 检查配置文件是否正确
2. 检查网络连接
3. 查看日志文件 `app.log`
4. 测试webhook地址是否有效

---

**更新日期**: 2025-01-01  
**版本**: 1.0


