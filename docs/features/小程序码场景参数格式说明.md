# 小程序码场景参数格式说明

## 问题分析

### 微信限制
- 微信小程序码API的scene参数限制为32个字符
- 超过限制会导致API调用失败

### 格式对比

**您期望的格式：**
```
promotion=PETT9WMPW&userId=USER1758618072318
长度: 44字符 ❌ 超过32字符限制
```

**当前实现的格式：**
```
p=PETT9WMPW&u=18072318
长度: 22字符 ✅ 符合32字符限制
```

## 解决方案

### 方案1：使用短格式（推荐）
- **后端生成**：`p=PETT9WMPW&u=18072318`
- **前端解析**：需要调整解析逻辑
- **优点**：符合微信限制，稳定可靠
- **缺点**：需要前端配合修改

### 方案2：使用标准格式但缩短用户ID
- **后端生成**：`promotion=PETT9WMPW&userId=18072318`
- **前端解析**：保持现有逻辑
- **优点**：前端无需修改
- **缺点**：用户ID被截断，可能影响唯一性

### 方案3：使用Base64编码
- **后端生成**：`data=UEVUVDlXTVBXfFVTRVIxNzU4NjE4MDcyMzE4`
- **前端解析**：需要解码逻辑
- **优点**：可以包含完整信息
- **缺点**：前端需要解码，增加复杂度

## 建议

推荐使用**方案1**（短格式），因为：
1. 符合微信API限制
2. 参数清晰明确
3. 前端只需要简单调整解析逻辑

## 前端解析示例

```javascript
// 解析短格式
function parseScene(scene) {
    const params = new URLSearchParams(scene);
    return {
        promotionCode: params.get('p'),
        userId: params.get('u')
    };
}

// 解析标准格式
function parseSceneStandard(scene) {
    const params = new URLSearchParams(scene);
    return {
        promotionCode: params.get('promotion'),
        userId: params.get('userId')
    };
}
```


