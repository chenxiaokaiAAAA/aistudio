# 充值赠送功能使用说明

## ✅ 修复完成

**问题**：加载充值页面报错  
**原因**：新增字段未添加到数据库  
**解决**：已手动添加字段到数据库  

## 🚀 使用步骤

### 1. 重启服务器

```bash
python start.py
```

### 2. 使用充值功能

1. 登录管理员后台
2. 进入 **加盟商管理**
3. 选择要充值的加盟商
4. 点击 **充值** 按钮
5. 填写信息：
   - **充值金额**（必填）：加盟商看到的金额
   - **赠送金额**（可选）：额外赠送的金额，默认为0
   - **充值类型**：选择充值类型
   - **说明**：填写充值说明
6. 查看预览并确认充值

### 3. 示例

**充值场景**：
- 充值金额：¥1000
- 赠送金额：¥200
- 实际到账：¥1200

**结果**：
- 加盟商看到：充值了 ¥1000
- 后台记录显示：充值 ¥1000（含赠送¥200）
- 实际余额增加：¥1200

## 📊 数据说明

### 数据库字段

- `amount`: 充值金额（加盟商看到的金额）
- `bonus_amount`: 赠送金额（内部记录，默认0）
- `total_amount`: 实际充值总额（= amount + bonus_amount）

### 兼容性

✅ 旧的充值记录：
- `bonus_amount` = 0
- `total_amount` = `amount`
- 加盟商看到的数据完全不变

✅ 新的充值记录：
- `bonus_amount` 可以设置
- `total_amount` = amount + bonus_amount
- 加盟商只看到 `amount`

## ⚠️ 注意事项

1. 赠送金额不显示给加盟商
2. 赠送金额会计入账户余额
3. 充值记录中会显示完整的充值信息（仅管理员可见）
4. 旧数据不受影响，完全兼容

---

**更新日期**: 2025-01-20  
**状态**: ✅ 已完成，可正常使用



